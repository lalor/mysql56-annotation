<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: table_def Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">table_def Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="table_def" -->
<p><code>#include &lt;<a class="el" href="rpl__utility_8h_source.html">rpl_utility.h</a>&gt;</code></p>

<p><a href="classtable__def-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtable__def.html#a659c3d889db3ab3c2cc3f3cb591587e5">table_def</a> (unsigned char *types, ulong <a class="el" href="classtable__def.html#a58ad38a4b3a4b780db140b4dd2c63e08">size</a>, uchar *field_metadata, int metadata_size, uchar *null_bitmap, uint16 flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ulong&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtable__def.html#a58ad38a4b3a4b780db140b4dd2c63e08">size</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3b5f00e970877b152341fabeeece3524"></a><!-- doxytag: member="table_def::binlog_type" ref="a3b5f00e970877b152341fabeeece3524" args="(ulong index) const " -->
enum_field_types&#160;</td><td class="memItemRight" valign="bottom"><b>binlog_type</b> (ulong index) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a892bbb5029fc4a001050b94b5b224f29"></a><!-- doxytag: member="table_def::type" ref="a892bbb5029fc4a001050b94b5b224f29" args="(ulong index) const " -->
enum_field_types&#160;</td><td class="memItemRight" valign="bottom"><b>type</b> (ulong index) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7c59c57910b220617c78fb6d2b6e8541"></a><!-- doxytag: member="table_def::field_metadata" ref="a7c59c57910b220617c78fb6d2b6e8541" args="(uint index) const " -->
uint16&#160;</td><td class="memItemRight" valign="bottom"><b>field_metadata</b> (uint index) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a43f28572ccc15c79b2623fa9296987ad"></a><!-- doxytag: member="table_def::maybe_null" ref="a43f28572ccc15c79b2623fa9296987ad" args="(uint index) const " -->
my_bool&#160;</td><td class="memItemRight" valign="bottom"><b>maybe_null</b> (uint index) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a265623c807007e3417b43a804e39cf97"></a><!-- doxytag: member="table_def::calc_field_size" ref="a265623c807007e3417b43a804e39cf97" args="(uint col, uchar *master_data) const " -->
uint32&#160;</td><td class="memItemRight" valign="bottom"><b>calc_field_size</b> (uint col, uchar *master_data) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtable__def.html#a9e5652b6fe3661b755eed7f5c4513440">compatible_with</a> (THD *thd, <a class="el" href="classRelay__log__info.html">Relay_log_info</a> *rli, <a class="el" href="structTABLE.html">TABLE</a> *table, <a class="el" href="structTABLE.html">TABLE</a> **conv_table_var) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structTABLE.html">TABLE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtable__def.html#a25fc6befec7a33a17c4fd8dabe35378a">create_conversion_table</a> (THD *thd, <a class="el" href="classRelay__log__info.html">Relay_log_info</a> *rli, <a class="el" href="structTABLE.html">TABLE</a> *target_table) const </td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>A table definition from the master.</p>
<p>The responsibilities of this class is:</p>
<ul>
<li>Extract and decode table definition data from the table map event</li>
<li>Check if table definition in table map is compatible with table definition on slave </li>
</ul>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a659c3d889db3ab3c2cc3f3cb591587e5"></a><!-- doxytag: member="table_def::table_def" ref="a659c3d889db3ab3c2cc3f3cb591587e5" args="(unsigned char *types, ulong size, uchar *field_metadata, int metadata_size, uchar *null_bitmap, uint16 flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtable__def.html#a659c3d889db3ab3c2cc3f3cb591587e5">table_def::table_def</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>types</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulong&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uchar *&#160;</td>
          <td class="paramname"><em>field_metadata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>metadata_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uchar *&#160;</td>
          <td class="paramname"><em>null_bitmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Constructor.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">types</td><td>Array of types, each stored as a byte </td></tr>
    <tr><td class="paramname">size</td><td>Number of elements in array 'types' </td></tr>
    <tr><td class="paramname">field_metadata</td><td>Array of extra information about fields </td></tr>
    <tr><td class="paramname">metadata_size</td><td>Size of the field_metadata array </td></tr>
    <tr><td class="paramname">null_bitmap</td><td>The bitmap of fields that can be null </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a9e5652b6fe3661b755eed7f5c4513440"></a><!-- doxytag: member="table_def::compatible_with" ref="a9e5652b6fe3661b755eed7f5c4513440" args="(THD *thd, Relay_log_info *rli, TABLE *table, TABLE **conv_table_var) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classtable__def.html#a9e5652b6fe3661b755eed7f5c4513440">table_def::compatible_with</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRelay__log__info.html">Relay_log_info</a> *&#160;</td>
          <td class="paramname"><em>rli</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTABLE.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTABLE.html">TABLE</a> **&#160;</td>
          <td class="paramname"><em>conv_table_var</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Decide if the table definition is compatible with a table.</p>
<p>Compare the definition with a table to see if it is compatible with it.</p>
<p>A table definition is compatible with a table if:</p>
<ul>
<li>The columns types of the table definition is a (not necessarily proper) prefix of the column type of the table.</li>
</ul>
<ul>
<li>The other way around.</li>
</ul>
<ul>
<li>Each column on the master that also exists on the slave can be converted according to the current settings of <code>SLAVE_TYPE_CONVERSIONS</code>.</li>
</ul>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">thd</td><td></td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rli</td><td>Pointer to relay log info </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">table</td><td>Pointer to table to compare with.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tmp_table_var</td><td>Pointer to temporary table for holding conversion table.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt><b>Return values:</b></dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>if the table definition is not compatible with <code>table</code> </td></tr>
    <tr><td class="paramname">0</td><td>if the table definition is compatible with <code>table</code> </td></tr>
  </table>
  </dd>
</dl>
<p>Is the definition compatible with a table?</p>
<p>This function will compare the master table with an existing table on the slave and see if they are compatible with respect to the current settings of <code>SLAVE_TYPE_CONVERSIONS</code>.</p>
<p>If the tables are compatible and conversions are required, <code>tmp_table_var</code> will be set to a virtual temporary table with field pointers for the fields that require conversions. This allow simple checking of whether a conversion are to be applied or not.</p>
<p>If tables are compatible, but no conversions are necessary, <code>tmp_table_var</code> will be set to NULL.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">rli_arg[in]</td><td>Relay log info, for error reporting.</td></tr>
    <tr><td class="paramname">table[in]</td><td>Table to compare with</td></tr>
    <tr><td class="paramname">tmp_table_var[out]</td><td>Virtual temporary table for performing conversions, if necessary.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt><b>Return values:</b></dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Master table is compatible with slave table. </td></tr>
    <tr><td class="paramname">false</td><td>Master table is not compatible with slave table. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a25fc6befec7a33a17c4fd8dabe35378a"></a><!-- doxytag: member="table_def::create_conversion_table" ref="a25fc6befec7a33a17c4fd8dabe35378a" args="(THD *thd, Relay_log_info *rli, TABLE *target_table) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structTABLE.html">TABLE</a> * <a class="el" href="classtable__def.html#a25fc6befec7a33a17c4fd8dabe35378a">table_def::create_conversion_table</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRelay__log__info.html">Relay_log_info</a> *&#160;</td>
          <td class="paramname"><em>rli</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTABLE.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>target_table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Create a virtual in-memory temporary table structure.</p>
<p>The table structure has records and field array so that a row can be unpacked into the record for further processing.</p>
<p>In the virtual table, each field that requires conversion will have a non-NULL value, while fields that do not require conversion will have a NULL value.</p>
<p>Some information that is missing in the events, such as the character set for string types, are taken from the table that the field is going to be pushed into, so the target table that the data eventually need to be pushed into need to be supplied.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread to allocate memory from. </td></tr>
    <tr><td class="paramname">rli</td><td>Relay log info structure, for error reporting. </td></tr>
    <tr><td class="paramname">target_table</td><td>Target table for fields.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to a temporary table with memory allocated in the thread's memroot, NULL if the table could not be created</dd></dl>
<p>Create a conversion table.</p>
<p>If the function is unable to create the conversion table, an error will be printed and NULL will be returned.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Pointer to conversion table, or NULL if unable to create conversion table. </dd></dl>

</div>
</div>
<a class="anchor" id="a58ad38a4b3a4b780db140b4dd2c63e08"></a><!-- doxytag: member="table_def::size" ref="a58ad38a4b3a4b780db140b4dd2c63e08" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ulong <a class="el" href="classtable__def.html#a58ad38a4b3a4b780db140b4dd2c63e08">table_def::size</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return the number of fields there is type data for.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of fields that there is type data for. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="rpl__utility_8h_source.html">rpl_utility.h</a></li>
<li>rpl_utility.cc</li>
</ul>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 16 2015 12:37:36 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
