<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: MDL_lock Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<div class="title">MDL_lock Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="MDL_lock" --><div class="dynheader">
Inheritance diagram for MDL_lock:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classMDL__lock.png" usemap="#MDL_lock_map" alt=""/>
  <map id="MDL_lock_map" name="MDL_lock_map">
<area href="classMDL__object__lock.html" alt="MDL_object_lock" shape="rect" coords="0,56,117,80"/>
<area href="classMDL__scoped__lock.html" alt="MDL_scoped_lock" shape="rect" coords="127,56,244,80"/>
</map>
 </div></div>

<p><a href="classMDL__lock-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock_1_1Ticket__list.html">Ticket_list</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af49d3a2db62c2c6dda844e0d4531ab12"></a><!-- doxytag: member="MDL_lock::bitmap_t" ref="af49d3a2db62c2c6dda844e0d4531ab12" args="" -->
typedef unsigned short&#160;</td><td class="memItemRight" valign="bottom"><b>bitmap_t</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a32cdf73e78c2f3288e20676e9ec19ea5"></a><!-- doxytag: member="MDL_lock::Ticket_iterator" ref="a32cdf73e78c2f3288e20676e9ec19ea5" args="" -->
typedef <a class="el" href="classI__P__List__iterator.html">Ticket_list::List::Iterator</a>&#160;</td><td class="memItemRight" valign="bottom"><b>Ticket_iterator</b></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a528f0c4598cc1d46233e909c66b790dc"></a><!-- doxytag: member="MDL_lock::is_empty" ref="a528f0c4598cc1d46233e909c66b790dc" args="() const " -->
bool&#160;</td><td class="memItemRight" valign="bottom"><b>is_empty</b> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8993c86b210f7cb61c80220329e6e02a"></a><!-- doxytag: member="MDL_lock::incompatible_granted_types_bitmap" ref="a8993c86b210f7cb61c80220329e6e02a" args="() const =0" -->
virtual const bitmap_t *&#160;</td><td class="memItemRight" valign="bottom"><b>incompatible_granted_types_bitmap</b> () const =0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad3c904f6afb66ebb7e8db07134fe323b"></a><!-- doxytag: member="MDL_lock::incompatible_waiting_types_bitmap" ref="ad3c904f6afb66ebb7e8db07134fe323b" args="() const =0" -->
virtual const bitmap_t *&#160;</td><td class="memItemRight" valign="bottom"><b>incompatible_waiting_types_bitmap</b> () const =0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a7707e02d9695b5694336787a622b0060">has_pending_conflicting_lock</a> (enum_mdl_type type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a1b17fbe1439018ef4e65a689f5673345">can_grant_lock</a> (enum_mdl_type type, <a class="el" href="classMDL__context.html">MDL_context</a> *requstor_ctx, bool ignore_lock_priority) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a07003cc6619a99b6cc36f564c62e4e94">reschedule_waiters</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a6c7adbc9462b159451a388353ca59df8">remove_ticket</a> (<a class="el" href="classMDL__lock_1_1Ticket__list.html">Ticket_list</a> MDL_lock::*queue, <a class="el" href="classMDL__ticket.html">MDL_ticket</a> *ticket)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a56e5025d3f3cff97923bc283c715566d">visit_subgraph</a> (<a class="el" href="classMDL__ticket.html">MDL_ticket</a> *waiting_ticket, <a class="el" href="classMDL__wait__for__graph__visitor.html">MDL_wait_for_graph_visitor</a> *gvisitor)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac381385a3fe30868791370db3e1c94ad"></a><!-- doxytag: member="MDL_lock::needs_notification" ref="ac381385a3fe30868791370db3e1c94ad" args="(const MDL_ticket *ticket) const =0" -->
virtual bool&#160;</td><td class="memItemRight" valign="bottom"><b>needs_notification</b> (const <a class="el" href="classMDL__ticket.html">MDL_ticket</a> *ticket) const =0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0e7cbf9885b20cf2416ce625a2715531"></a><!-- doxytag: member="MDL_lock::notify_conflicting_locks" ref="a0e7cbf9885b20cf2416ce625a2715531" args="(MDL_context *ctx)=0" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><b>notify_conflicting_locks</b> (<a class="el" href="classMDL__context.html">MDL_context</a> *ctx)=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a859c4eb6f130447d4b94c125c232ceca"></a><!-- doxytag: member="MDL_lock::hog_lock_types_bitmap" ref="a859c4eb6f130447d4b94c125c232ceca" args="() const =0" -->
virtual bitmap_t&#160;</td><td class="memItemRight" valign="bottom"><b>hog_lock_types_bitmap</b> () const =0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aba4612530248e072e71efd50e2304b82"></a><!-- doxytag: member="MDL_lock::MDL_lock" ref="aba4612530248e072e71efd50e2304b82" args="(const MDL_key *key_arg, MDL_map_partition *map_part)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>MDL_lock</b> (const <a class="el" href="classMDL__key.html">MDL_key</a> *key_arg, <a class="el" href="classMDL__map__partition.html">MDL_map_partition</a> *map_part)</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classMDL__lock.html">MDL_lock</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a2465460ca8b04f73d2381043a997dfed">create</a> (const <a class="el" href="classMDL__key.html">MDL_key</a> *<a class="el" href="classMDL__lock.html#aefb48179bc3f6ef64c213b253c379da4">key</a>, <a class="el" href="classMDL__map__partition.html">MDL_map_partition</a> *map_part)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0b25c48d98250c1603a5c55eeace3986"></a><!-- doxytag: member="MDL_lock::destroy" ref="a0b25c48d98250c1603a5c55eeace3986" args="(MDL_lock *lock)" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>destroy</b> (<a class="el" href="classMDL__lock.html">MDL_lock</a> *lock)</td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classMDL__key.html">MDL_key</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#aefb48179bc3f6ef64c213b253c379da4">key</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">mysql_prlock_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">m_rwlock</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classMDL__lock_1_1Ticket__list.html">Ticket_list</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a188dd53561f6cf6148277512b706ea74">m_granted</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classMDL__lock_1_1Ticket__list.html">Ticket_list</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a4443cad6b484e2af5c816949ddb209dc">m_waiting</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ulong&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#ab173b2eb68fdd6de02d9e4e8a0c94405">m_hog_lock_count</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a5a5656ede3fc7772e612f6ae5c9a32a7">m_ref_usage</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a36ae1fe3de8bd7d46cdd8e8428d2e8b8"></a><!-- doxytag: member="MDL_lock::m_ref_release" ref="a36ae1fe3de8bd7d46cdd8e8428d2e8b8" args="" -->
uint&#160;</td><td class="memItemRight" valign="bottom"><b>m_ref_release</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af53b8e719370bc438e91bbb09549ec5b"></a><!-- doxytag: member="MDL_lock::m_is_destroyed" ref="af53b8e719370bc438e91bbb09549ec5b" args="" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><b>m_is_destroyed</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ulonglong&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#a6c2e5e43c2e415d9205e7fdc227ceb2e">m_version</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classMDL__map__partition.html">MDL_map_partition</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMDL__lock.html#aa1abde8ba2ec734301891301ff8d99ff">m_map_part</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>The lock context. Created internally for an acquired lock. For a given name, there exists only one <a class="el" href="classMDL__lock.html">MDL_lock</a> instance, and it exists only when the lock has been granted. Can be seen as an MDL subsystem's version of <a class="el" href="structTABLE__SHARE.html">TABLE_SHARE</a>.</p>
<p>This is an abstract class which lacks information about compatibility rules for lock types. They should be specified in its descendants. </p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a1b17fbe1439018ef4e65a689f5673345"></a><!-- doxytag: member="MDL_lock::can_grant_lock" ref="a1b17fbe1439018ef4e65a689f5673345" args="(enum_mdl_type type, MDL_context *requstor_ctx, bool ignore_lock_priority) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classMDL__lock.html#a1b17fbe1439018ef4e65a689f5673345">MDL_lock::can_grant_lock</a> </td>
          <td>(</td>
          <td class="paramtype">enum_mdl_type&#160;</td>
          <td class="paramname"><em>type_arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMDL__context.html">MDL_context</a> *&#160;</td>
          <td class="paramname"><em>requestor_ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>ignore_lock_priority</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check if request for the metadata lock can be satisfied given its current state.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">type_arg</td><td>The requested lock type. </td></tr>
    <tr><td class="paramname">requestor_ctx</td><td>The MDL context of the requestor. </td></tr>
    <tr><td class="paramname">ignore_lock_priority</td><td>Ignore lock priority.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt><b>Return values:</b></dt><dd>
  <table class="retval">
    <tr><td class="paramname">TRUE</td><td>Lock request can be satisfied </td></tr>
    <tr><td class="paramname">FALSE</td><td>There is some conflicting lock.</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>In cases then current context already has "stronger" type of lock on the object it will be automatically granted thanks to usage of the MDL_context::find_ticket() method. </dd></dl>

</div>
</div>
<a class="anchor" id="a2465460ca8b04f73d2381043a997dfed"></a><!-- doxytag: member="MDL_lock::create" ref="a2465460ca8b04f73d2381043a997dfed" args="(const MDL_key *key, MDL_map_partition *map_part)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMDL__lock.html">MDL_lock</a> * <a class="el" href="classMDL__lock.html#a2465460ca8b04f73d2381043a997dfed">MDL_lock::create</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classMDL__key.html">MDL_key</a> *&#160;</td>
          <td class="paramname"><em>mdl_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMDL__map__partition.html">MDL_map_partition</a> *&#160;</td>
          <td class="paramname"><em>map_part</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Auxiliary functions needed for creation/destruction of <a class="el" href="classMDL__lock.html">MDL_lock</a> objects.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Also chooses an <a class="el" href="classMDL__lock.html">MDL_lock</a> descendant appropriate for object namespace. </dd></dl>

</div>
</div>
<a class="anchor" id="a7707e02d9695b5694336787a622b0060"></a><!-- doxytag: member="MDL_lock::has_pending_conflicting_lock" ref="a7707e02d9695b5694336787a622b0060" args="(enum_mdl_type type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classMDL__lock.html#a7707e02d9695b5694336787a622b0060">MDL_lock::has_pending_conflicting_lock</a> </td>
          <td>(</td>
          <td class="paramtype">enum_mdl_type&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check if we have any pending locks which conflict with existing shared lock.</p>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>The ticket must match an acquired lock.</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>TRUE if there is a conflicting lock request, FALSE otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="a6c7adbc9462b159451a388353ca59df8"></a><!-- doxytag: member="MDL_lock::remove_ticket" ref="a6c7adbc9462b159451a388353ca59df8" args="(Ticket_list MDL_lock::*queue, MDL_ticket *ticket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classMDL__lock.html#a6c7adbc9462b159451a388353ca59df8">MDL_lock::remove_ticket</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMDL__lock_1_1Ticket__list.html">Ticket_list</a> MDL_lock::*&#160;</td>
          <td class="paramname"><em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMDL__ticket.html">MDL_ticket</a> *&#160;</td>
          <td class="paramname"><em>ticket</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Remove a ticket from waiting or pending queue and wakeup up waiters. </p>

</div>
</div>
<a class="anchor" id="a07003cc6619a99b6cc36f564c62e4e94"></a><!-- doxytag: member="MDL_lock::reschedule_waiters" ref="a07003cc6619a99b6cc36f564c62e4e94" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classMDL__lock.html#a07003cc6619a99b6cc36f564c62e4e94">MDL_lock::reschedule_waiters</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Determine waiting contexts which requests for the lock can be satisfied, grant lock to them and wake them up.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Together with MDL_lock::add_ticket() this method implements fair scheduling among requests with the same priority. It tries to grant lock from the head of waiters list, while add_ticket() adds new requests to the back of this list. </dd></dl>

</div>
</div>
<a class="anchor" id="a56e5025d3f3cff97923bc283c715566d"></a><!-- doxytag: member="MDL_lock::visit_subgraph" ref="a56e5025d3f3cff97923bc283c715566d" args="(MDL_ticket *waiting_ticket, MDL_wait_for_graph_visitor *gvisitor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classMDL__lock.html#a56e5025d3f3cff97923bc283c715566d">MDL_lock::visit_subgraph</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMDL__ticket.html">MDL_ticket</a> *&#160;</td>
          <td class="paramname"><em>waiting_ticket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMDL__wait__for__graph__visitor.html">MDL_wait_for_graph_visitor</a> *&#160;</td>
          <td class="paramname"><em>gvisitor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A fragment of recursive traversal of the wait-for graph in search for deadlocks. Direct the deadlock visitor to all contexts that own the lock the current node in the wait-for graph is waiting for. As long as the initial node is remembered in the visitor, a deadlock is found when the same node is seen twice. </p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aefb48179bc3f6ef64c213b253c379da4"></a><!-- doxytag: member="MDL_lock::key" ref="aefb48179bc3f6ef64c213b253c379da4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMDL__key.html">MDL_key</a> <a class="el" href="classMDL__lock.html#aefb48179bc3f6ef64c213b253c379da4">MDL_lock::key</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The key of the object (data) being protected. </p>

</div>
</div>
<a class="anchor" id="a188dd53561f6cf6148277512b706ea74"></a><!-- doxytag: member="MDL_lock::m_granted" ref="a188dd53561f6cf6148277512b706ea74" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMDL__lock_1_1Ticket__list.html">Ticket_list</a> <a class="el" href="classMDL__lock.html#a188dd53561f6cf6148277512b706ea74">MDL_lock::m_granted</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classList.html">List</a> of granted tickets for this lock. </p>

</div>
</div>
<a class="anchor" id="ab173b2eb68fdd6de02d9e4e8a0c94405"></a><!-- doxytag: member="MDL_lock::m_hog_lock_count" ref="ab173b2eb68fdd6de02d9e4e8a0c94405" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ulong <a class="el" href="classMDL__lock.html#ab173b2eb68fdd6de02d9e4e8a0c94405">MDL_lock::m_hog_lock_count</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of times high priority lock requests have been granted while low priority lock requests were waiting. </p>

</div>
</div>
<a class="anchor" id="aa1abde8ba2ec734301891301ff8d99ff"></a><!-- doxytag: member="MDL_lock::m_map_part" ref="aa1abde8ba2ec734301891301ff8d99ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMDL__map__partition.html">MDL_map_partition</a>* <a class="el" href="classMDL__lock.html#aa1abde8ba2ec734301891301ff8d99ff">MDL_lock::m_map_part</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Partition of <a class="el" href="classMDL__map.html">MDL_map</a> where the lock is stored. </p>

</div>
</div>
<a class="anchor" id="a5a5656ede3fc7772e612f6ae5c9a32a7"></a><!-- doxytag: member="MDL_lock::m_ref_usage" ref="a5a5656ede3fc7772e612f6ae5c9a32a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint <a class="el" href="classMDL__lock.html#a5a5656ede3fc7772e612f6ae5c9a32a7">MDL_lock::m_ref_usage</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>These three members are used to make it possible to separate the MDL_map_partition::m_mutex mutex and <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a> in <a class="el" href="classMDL__map.html#a9a1b825896ad4b0a5d04a9cff8bfcaf5">MDL_map::find_or_insert()</a> for increased scalability. The 'm_is_destroyed' member is only set by destroyers that have both the MDL_map_partition::m_mutex and <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a>, thus holding any of the mutexes is sufficient to read it. The 'm_ref_usage; is incremented under protection by MDL_map_partition::m_mutex, but when 'm_is_destroyed' is set to TRUE, this member is moved to be protected by the <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a>. This means that the <a class="el" href="classMDL__map.html#a9a1b825896ad4b0a5d04a9cff8bfcaf5">MDL_map::find_or_insert()</a> which only holds the <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a> can compare it to 'm_ref_release' without acquiring MDL_map_partition::m_mutex again and if equal it can also destroy the lock object safely. The 'm_ref_release' is incremented under protection by <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a>. Note since we are only interested in equality of these two counters we don't have to worry about overflows as long as their size is big enough to hold maximum number of concurrent threads on the system. </p>

</div>
</div>
<a class="anchor" id="a1308b4506d8cb6d754b4f173e3aa4962"></a><!-- doxytag: member="MDL_lock::m_rwlock" ref="a1308b4506d8cb6d754b4f173e3aa4962" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mysql_prlock_t <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read-write lock protecting this lock context.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The fact that we use read-write lock prefers readers here is important as deadlock detector won't work correctly otherwise.</dd></dl>
<p>For example, imagine that we have following waiters graph:</p>
<p>ctxA -&gt; obj1 -&gt; ctxB -&gt; obj1 -| ^ | |----------------------------|</p>
<p>and both ctxA and ctxB start deadlock detection process:</p>
<p>ctxA read-locks obj1 ctxB read-locks obj2 ctxA goes deeper ctxB goes deeper</p>
<p>Now ctxC comes in who wants to start waiting on obj1, also ctxD comes in who wants to start waiting on obj2.</p>
<p>ctxC tries to write-lock obj1 ctxD tries to write-lock obj2 ctxC is blocked ctxD is blocked</p>
<p>Now ctxA and ctxB resume their search:</p>
<p>ctxA tries to read-lock obj2 ctxB tries to read-lock obj1</p>
<p>If m_rwlock prefers writes (or fair) both ctxA and ctxB would be blocked because of pending write locks from ctxD and ctxC correspondingly. Thus we will get a deadlock in deadlock detector. If m_wrlock prefers readers (actually ignoring pending writers is enough) ctxA and ctxB will continue and no deadlock will occur. </p>

</div>
</div>
<a class="anchor" id="a6c2e5e43c2e415d9205e7fdc227ceb2e"></a><!-- doxytag: member="MDL_lock::m_version" ref="a6c2e5e43c2e415d9205e7fdc227ceb2e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ulonglong <a class="el" href="classMDL__lock.html#a6c2e5e43c2e415d9205e7fdc227ceb2e">MDL_lock::m_version</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>We use the same idea and an additional version counter to support caching of unused <a class="el" href="classMDL__lock.html">MDL_lock</a> object for further re-use. This counter is incremented while holding both MDL_map_partition::m_mutex and <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a> locks each time when a <a class="el" href="classMDL__lock.html">MDL_lock</a> is moved from the partitioned hash to the paritioned unused objects list (or destroyed). A thread, which has found a <a class="el" href="classMDL__lock.html">MDL_lock</a> object for the key in the hash and then released the MDL_map_partition::m_mutex before acquiring the <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a>, can determine that this object was moved to the unused objects list (or destroyed) while it held no locks by comparing the version value which it read while holding the MDL_map_partition::m_mutex with the value read after acquiring the <a class="el" href="classMDL__lock.html#a1308b4506d8cb6d754b4f173e3aa4962">MDL_lock::m_rwlock</a>. Note that since it takes several years to overflow this counter such theoretically possible overflows should not have any practical effects. </p>

</div>
</div>
<a class="anchor" id="a4443cad6b484e2af5c816949ddb209dc"></a><!-- doxytag: member="MDL_lock::m_waiting" ref="a4443cad6b484e2af5c816949ddb209dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMDL__lock_1_1Ticket__list.html">Ticket_list</a> <a class="el" href="classMDL__lock.html#a4443cad6b484e2af5c816949ddb209dc">MDL_lock::m_waiting</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Tickets for contexts waiting to acquire a lock. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>mdl.cc</li>
</ul>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 16 2015 12:37:02 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
