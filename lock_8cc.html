<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: lock.cc File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">lock.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="sql__priv_8h_source.html">sql_priv.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="debug__sync_8h_source.html">debug_sync.h</a>&quot;</code><br/>
<code>#include &quot;unireg.h&quot;</code><br/>
<code>#include &quot;lock.h&quot;</code><br/>
<code>#include &quot;sql_base.h&quot;</code><br/>
<code>#include &quot;sql_parse.h&quot;</code><br/>
<code>#include &quot;sql_acl.h&quot;</code><br/>
<code>#include &lt;hash.h&gt;</code><br/>
<code>#include &lt;assert.h&gt;</code><br/>
<code>#include &quot;my_atomic.h&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga65cffe586bef8fdfb5334d343c069df6"></a><!-- doxytag: member="lock.cc::GET_LOCK_UNLOCK" ref="ga65cffe586bef8fdfb5334d343c069df6" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GET_LOCK_UNLOCK</b>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga1bef164e121fc9d85a6e19eae9625365"></a><!-- doxytag: member="lock.cc::GET_LOCK_STORE_LOCKS" ref="ga1bef164e121fc9d85a6e19eae9625365" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GET_LOCK_STORE_LOCKS</b>&#160;&#160;&#160;2</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Locking.html#ga3a5f18c7a05b36a6e93c1d8e33cece78">mysql_lock_tables</a> (THD *thd, <a class="el" href="structTABLE.html">TABLE</a> **tables, uint count, uint flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2bff80304c9d27f634976ac8fe60cd38"></a><!-- doxytag: member="lock.cc::mysql_unlock_tables" ref="ga2bff80304c9d27f634976ac8fe60cd38" args="(THD *thd, MYSQL_LOCK *sql_lock)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>mysql_unlock_tables</b> (THD *thd, <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *sql_lock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Locking.html#gafad092ec9a399db99abd75b57a9ee679">mysql_unlock_some_tables</a> (THD *thd, <a class="el" href="structTABLE.html">TABLE</a> **table, uint count)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Locking.html#ga1e24a131cbe030c49d953669f804877d">mysql_unlock_read_tables</a> (THD *thd, <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *sql_lock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Locking.html#gad40fe56766e1b54e2fed60814aec1e58">mysql_lock_remove</a> (THD *thd, <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *locked, <a class="el" href="structTABLE.html">TABLE</a> *table)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Locking.html#ga07896e99c9c248c6441be5c13c484303">mysql_lock_abort</a> (THD *thd, <a class="el" href="structTABLE.html">TABLE</a> *table, bool upgrade_lock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Locking.html#ga321511c56502643e5aecbe6ed3e43b58">mysql_lock_abort_for_thread</a> (THD *thd, <a class="el" href="structTABLE.html">TABLE</a> *table)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gae8e0ecd1f7872040079f5319aacd93a2"></a><!-- doxytag: member="lock.cc::mysql_lock_merge" ref="gae8e0ecd1f7872040079f5319aacd93a2" args="(MYSQL_LOCK *a, MYSQL_LOCK *b)" -->
<a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>mysql_lock_merge</b> (<a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *a, <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Locking.html#gac67865dd0ef1b003fdee2182aba9a049">lock_schema_name</a> (THD *thd, const char *db)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Locking.html#gab03d9cc9ff9682e9f2a961685fd90cb3">lock_object_name</a> (THD *thd, <a class="el" href="classMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">MDL_key::enum_mdl_namespace</a> mdl_type, const char *db, const char *name)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gadb186a1125c10d63d0217bc321a4c95a"></a><!-- doxytag: member="lock.cc::open_cache" ref="gadb186a1125c10d63d0217bc321a4c95a" args="" -->
HASH&#160;</td><td class="memItemRight" valign="bottom"><b>open_cache</b></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Locking functions for mysql.</p>
<p>Because of the new concurrent inserts, we must first get external locks before getting internal locks. If we do it in the other order, the status information is not up to date when called from the lock handler.</p>
<p>GENERAL DESCRIPTION OF LOCKING</p>
<p>When not using LOCK TABLES:</p>
<ul>
<li>For each SQL statement <a class="el" href="group__Locking.html#ga3a5f18c7a05b36a6e93c1d8e33cece78">mysql_lock_tables()</a> is called for all involved tables.<ul>
<li><a class="el" href="group__Locking.html#ga3a5f18c7a05b36a6e93c1d8e33cece78">mysql_lock_tables()</a> will call table_handler-&gt;external_lock(thd,locktype) for each table. This is followed by a call to thr_multi_lock() for all tables.</li>
</ul>
</li>
</ul>
<ul>
<li>When statement is done, we call mysql_unlock_tables(). This will call thr_multi_unlock() followed by table_handler-&gt;external_lock(thd, F_UNLCK) for each table.</li>
</ul>
<ul>
<li>Note that mysql_unlock_tables() may be called several times as MySQL in some cases can free some tables earlier than others.</li>
</ul>
<ul>
<li>The above is true both for normal and temporary tables.</li>
</ul>
<ul>
<li>Temporary non transactional tables are never passed to thr_multi_lock() and we never call external_lock(thd, F_UNLOCK) on these.</li>
</ul>
<p>When using LOCK TABLES:</p>
<ul>
<li>LOCK <a class="el" href="structTABLE.html">TABLE</a> will call <a class="el" href="group__Locking.html#ga3a5f18c7a05b36a6e93c1d8e33cece78">mysql_lock_tables()</a> for all tables. <a class="el" href="group__Locking.html#ga3a5f18c7a05b36a6e93c1d8e33cece78">mysql_lock_tables()</a> will call table_handler-&gt;external_lock(thd,locktype) for each table. This is followed by a call to thr_multi_lock() for all tables.</li>
</ul>
<ul>
<li>For each statement, we will call table_handler-&gt;start_stmt(THD) to inform the table handler that we are using the table.</li>
</ul>
<p>The tables used can only be tables used in LOCK TABLES or a temporary table.</p>
<ul>
<li>When statement is done, we will call ha_commit_stmt(thd);</li>
</ul>
<ul>
<li>When calling UNLOCK TABLES we call mysql_unlock_tables() for all tables used in LOCK TABLES</li>
</ul>
<p>If table_handler-&gt;external_lock(thd, locktype) fails, we call table_handler-&gt;external_lock(thd, F_UNLCK) for each table that was locked, excluding one that caused failure. That means handler must cleanup itself in case external_lock() fails.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000042">Todo:</a></b></dt><dd>Change to use my_malloc() ONLY when using LOCK TABLES command or when we are forced to use mysql_lock_merge. </dd></dl>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 16 2015 12:34:46 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
