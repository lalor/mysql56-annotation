<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: sql_prepare.cc File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sql_prepare.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;my_global.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="sql__priv_8h_source.html">sql_priv.h</a>&quot;</code><br/>
<code>#include &quot;unireg.h&quot;</code><br/>
<code>#include &quot;sql_class.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="set__var_8h_source.html">set_var.h</a>&quot;</code><br/>
<code>#include &quot;sql_prepare.h&quot;</code><br/>
<code>#include &quot;sql_parse.h&quot;</code><br/>
<code>#include &quot;sql_base.h&quot;</code><br/>
<code>#include &quot;sql_cache.h&quot;</code><br/>
<code>#include &quot;sql_view.h&quot;</code><br/>
<code>#include &quot;sql_delete.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="sql__select_8h_source.html">sql_select.h</a>&quot;</code><br/>
<code>#include &quot;sql_insert.h&quot;</code><br/>
<code>#include &quot;sql_update.h&quot;</code><br/>
<code>#include &quot;sql_db.h&quot;</code><br/>
<code>#include &quot;sql_acl.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="sql__cursor_8h_source.html">sql_cursor.h</a>&quot;</code><br/>
<code>#include &quot;sp_head.h&quot;</code><br/>
<code>#include &quot;sp.h&quot;</code><br/>
<code>#include &quot;sp_cache.h&quot;</code><br/>
<code>#include &quot;sql_handler.h&quot;</code><br/>
<code>#include &quot;probes_mysql.h&quot;</code><br/>
<code>#include &lt;mysql_com.h&gt;</code><br/>
<code>#include &quot;lock.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="opt__trace_8h_source.html">opt_trace.h</a>&quot;</code><br/>
<code>#include &quot;sql_analyse.h&quot;</code><br/>
<code>#include &quot;sql_rewrite.h&quot;</code><br/>
<code>#include &quot;transaction.h&quot;</code><br/>
<code>#include &quot;sql_audit.h&quot;</code><br/>
<code>#include &lt;algorithm&gt;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSelect__fetch__protocol__binary.html">Select_fetch_protocol_binary</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPrepared__statement.html">Prepared_statement</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classExecute__sql__statement.html">Execute_sql_statement</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classProtocol__local.html">Protocol_local</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a894d8d107ee67c66ceafdf94c8c4d633"></a><!-- doxytag: member="sql_prepare.cc::is_param_null" ref="a894d8d107ee67c66ceafdf94c8c4d633" args="(const uchar *pos, ulong param_no)" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><b>is_param_null</b> (const uchar *pos, ulong param_no)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#a0df8e5865ec6b3e5bae4e284e40a1fbb">is_param_long_data_type</a> (<a class="el" href="classItem__param.html">Item_param</a> *param)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#a626dc0ff3952d0fd850852643008fb8a">mysqld_stmt_prepare</a> (THD *thd, const char *packet, uint packet_length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#afb51d4335dea1c2ec4f9ceb80469b235">mysql_sql_stmt_prepare</a> (THD *thd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#ac923efcc818c95eeb45ebc9ac085f081">reinit_stmt_before_use</a> (THD *thd, LEX *lex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#a8a1c9021a769d0a0b46f0cb5b6e2cf0f">mysqld_stmt_execute</a> (THD *thd, char *packet_arg, uint packet_length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#a7a00244c38838cd10623212a4eb67bc4">mysql_sql_stmt_execute</a> (THD *thd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#abfd89c8723f8e2681d45e2b3acfe9846">mysqld_stmt_fetch</a> (THD *thd, char *packet, uint packet_length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#ad1c2e50d2f19d1ec1ae5dffd7524d6a2">mysqld_stmt_reset</a> (THD *thd, char *packet, uint packet_length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#a4109d85bbb494c4c7be6ae0c3fee2209">mysqld_stmt_close</a> (THD *thd, char *packet, uint packet_length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#a02971e8a15a4e21d5291eb5c3d67fab9">mysql_sql_stmt_close</a> (THD *thd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__prepare_8cc.html#a77201c58cbf240c6316dd9d0d6bf7f14">mysql_stmt_get_longdata</a> (THD *thd, char *packet, ulong packet_length)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This file contains the implementation of prepared statements.</p>
<p>When one prepares a statement:</p>
<ul>
<li>Server gets the query from client with command 'COM_STMT_PREPARE'; in the following format: [COM_STMT_PREPARE:1] [query]</li>
<li>Parse the query and recognize any parameter markers '?' and store its information list in lex-&gt;param_list</li>
<li>Allocate a new statement for this prepare; and keep this in 'thd-&gt;stmt_map'.</li>
<li>Without executing the query, return back to client the total number of parameters along with result-set metadata information (if any) in the following format: <div class="fragment"><pre class="fragment">
    [STMT_ID:4]
    [Column_count:2]
    [Param_count:2]
    [Params meta info (stubs only for now)]  (if Param_count &gt; 0)
    [Columns meta info] (if Column_count &gt; 0)
    </pre></div></li>
</ul>
<p>During prepare the tables used in a statement are opened, but no locks are acquired. Table opening will block any DDL during the operation, and we do not need any locks as we neither read nor modify any data during prepare. Tables are closed after prepare finishes.</p>
<p>When one executes a statement:</p>
<ul>
<li>Server gets the command 'COM_STMT_EXECUTE' to execute the previously prepared query. If there are any parameter markers, then the client will send the data in the following format: <div class="fragment"><pre class="fragment">
    [COM_STMT_EXECUTE:1]
    [STMT_ID:4]
    [NULL_BITS:(param_count+7)/8)]
    [TYPES_SUPPLIED_BY_CLIENT(0/1):1]
    [[length]data]
    [[length]data] .. [[length]data].
    </pre></div> (Note: Except for string/binary types; all other types will not be supplied with length field)</li>
<li>If it is a first execute or types of parameters were altered by client, then setup the conversion routines.</li>
<li>Assign parameter items from the supplied data.</li>
<li>Execute the query without re-parsing and send back the results to client</li>
</ul>
<p>During execution of prepared statement tables are opened and locked the same way they would for normal (non-prepared) statement execution. Tables are unlocked and closed after the execution.</p>
<p>When one supplies long data for a placeholder:</p>
<ul>
<li>Server gets the long data in pieces with command type 'COM_STMT_SEND_LONG_DATA'.</li>
<li>The packet recieved will have the format as: [COM_STMT_SEND_LONG_DATA:1][STMT_ID:4][parameter_number:2][data]</li>
<li>data from the packet is appended to the long data value buffer for this placeholder.</li>
<li>It's up to the client to stop supplying data chunks at any point. The server doesn't care; also, the server doesn't notify the client whether it got the data or not; if there is any error, then it will be returned at statement execute. </li>
</ul>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a0df8e5865ec6b3e5bae4e284e40a1fbb"></a><!-- doxytag: member="sql_prepare.cc::is_param_long_data_type" ref="a0df8e5865ec6b3e5bae4e284e40a1fbb" args="(Item_param *param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="sql__prepare_8cc.html#a0df8e5865ec6b3e5bae4e284e40a1fbb">is_param_long_data_type</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classItem__param.html">Item_param</a> *&#160;</td>
          <td class="paramname"><em>param</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check whether this parameter data type is compatible with long data. Used to detect whether a long data stream has been supplied to a incompatible data type. </p>

</div>
</div>
<a class="anchor" id="a02971e8a15a4e21d5291eb5c3d67fab9"></a><!-- doxytag: member="sql_prepare.cc::mysql_sql_stmt_close" ref="a02971e8a15a4e21d5291eb5c3d67fab9" args="(THD *thd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#a02971e8a15a4e21d5291eb5c3d67fab9">mysql_sql_stmt_close</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>SQLCOM_DEALLOCATE implementation.</p>
<p>Close an SQL prepared statement. As this can be called from Dynamic SQL, we should be careful to not close a statement that is currently being executed.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>none: OK packet is sent in case of success, otherwise an error message is set in THD </dd></dl>

</div>
</div>
<a class="anchor" id="a7a00244c38838cd10623212a4eb67bc4"></a><!-- doxytag: member="sql_prepare.cc::mysql_sql_stmt_execute" ref="a7a00244c38838cd10623212a4eb67bc4" args="(THD *thd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#a7a00244c38838cd10623212a4eb67bc4">mysql_sql_stmt_execute</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>SQLCOM_EXECUTE implementation.</p>
<p>Execute prepared statement using parameter values from lex-&gt;prepared_stmt_params and send result to the client using text protocol. This is called from mysql_execute_command and therefore should behave like an ordinary query (e.g. not change global THD data, such as warning count, server status, etc). This function uses text protocol to send a possible result set.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>thread handle</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>none: in case of success, OK (or result set) packet is sent to the client, otherwise an error is set in THD </dd></dl>

</div>
</div>
<a class="anchor" id="afb51d4335dea1c2ec4f9ceb80469b235"></a><!-- doxytag: member="sql_prepare.cc::mysql_sql_stmt_prepare" ref="afb51d4335dea1c2ec4f9ceb80469b235" args="(THD *thd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#afb51d4335dea1c2ec4f9ceb80469b235">mysql_sql_stmt_prepare</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>SQLCOM_PREPARE implementation.</p>
<p>Prepare an SQL prepared statement. This is called from mysql_execute_command and should therefore behave like an ordinary query (e.g. should not reset any global THD data).</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>thread handle</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>none: in case of success, OK packet is sent to the client, otherwise an error message is set in THD </dd></dl>

</div>
</div>
<a class="anchor" id="a77201c58cbf240c6316dd9d0d6bf7f14"></a><!-- doxytag: member="sql_prepare.cc::mysql_stmt_get_longdata" ref="a77201c58cbf240c6316dd9d0d6bf7f14" args="(THD *thd, char *packet, ulong packet_length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#a77201c58cbf240c6316dd9d0d6bf7f14">mysql_stmt_get_longdata</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulong&#160;</td>
          <td class="paramname"><em>packet_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle long data in pieces from client.</p>
<p>Get a part of a long data. To make the protocol efficient, we are not sending any return packets here. If something goes wrong, then we will send the error on 'execute' We assume that the client takes care of checking that all parts are sent to the server. (No checking that we get a 'end of column' in the server is performed).</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread handle </td></tr>
    <tr><td class="paramname">packet</td><td><a class="el" href="classString.html">String</a> to append </td></tr>
    <tr><td class="paramname">packet_length</td><td>Length of string (including end \0) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a4109d85bbb494c4c7be6ae0c3fee2209"></a><!-- doxytag: member="sql_prepare.cc::mysqld_stmt_close" ref="a4109d85bbb494c4c7be6ae0c3fee2209" args="(THD *thd, char *packet, uint packet_length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#a4109d85bbb494c4c7be6ae0c3fee2209">mysqld_stmt_close</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>packet_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Delete a prepared statement from memory.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>we don't send any reply to this command. </dd></dl>

</div>
</div>
<a class="anchor" id="a8a1c9021a769d0a0b46f0cb5b6e2cf0f"></a><!-- doxytag: member="sql_prepare.cc::mysqld_stmt_execute" ref="a8a1c9021a769d0a0b46f0cb5b6e2cf0f" args="(THD *thd, char *packet_arg, uint packet_length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#a8a1c9021a769d0a0b46f0cb5b6e2cf0f">mysqld_stmt_execute</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>packet_arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>packet_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>COM_STMT_EXECUTE handler: execute a previously prepared statement.</p>
<p>If there are any parameters, then replace parameter markers with the data supplied from the client, and then execute the statement. This function uses binary protocol to send a possible result set to the client.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>current thread </td></tr>
    <tr><td class="paramname">packet_arg</td><td>parameter types and data, if any </td></tr>
    <tr><td class="paramname">packet_length</td><td>packet length, including the terminator character.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>none: in case of success OK packet or a result set is sent to the client, otherwise an error message is set in THD. </dd></dl>

</div>
</div>
<a class="anchor" id="abfd89c8723f8e2681d45e2b3acfe9846"></a><!-- doxytag: member="sql_prepare.cc::mysqld_stmt_fetch" ref="abfd89c8723f8e2681d45e2b3acfe9846" args="(THD *thd, char *packet, uint packet_length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#abfd89c8723f8e2681d45e2b3acfe9846">mysqld_stmt_fetch</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>packet_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>COM_STMT_FETCH handler: fetches requested amount of rows from cursor.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread handle </td></tr>
    <tr><td class="paramname">packet</td><td>Packet from client (with stmt_id &amp; num_rows) </td></tr>
    <tr><td class="paramname">packet_length</td><td>Length of packet </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a626dc0ff3952d0fd850852643008fb8a"></a><!-- doxytag: member="sql_prepare.cc::mysqld_stmt_prepare" ref="a626dc0ff3952d0fd850852643008fb8a" args="(THD *thd, const char *packet, uint packet_length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#a626dc0ff3952d0fd850852643008fb8a">mysqld_stmt_prepare</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>packet_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>COM_STMT_PREPARE handler.</p>
<p>Given a query string with parameter markers, create a prepared statement from it and send PS info back to the client.</p>
<p>If parameter markers are found in the query, then store the information using <a class="el" href="classItem__param.html">Item_param</a> along with maintaining a list in lex-&gt;param_array, so that a fast and direct retrieval can be made without going through all field items.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">packet</td><td>query to be prepared </td></tr>
    <tr><td class="paramname">packet_length</td><td>query string length, including ignored trailing NULL or quote char.</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function parses the query and sends the total number of parameters and resultset metadata information back to client (if any), without executing the query i.e. without any log/disk writes. This allows the queries to be re-executed without re-parsing during execute.</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>none: in case of success a new statement id and metadata is sent to the client, otherwise an error message is set in THD. </dd></dl>

</div>
</div>
<a class="anchor" id="ad1c2e50d2f19d1ec1ae5dffd7524d6a2"></a><!-- doxytag: member="sql_prepare.cc::mysqld_stmt_reset" ref="ad1c2e50d2f19d1ec1ae5dffd7524d6a2" args="(THD *thd, char *packet, uint packet_length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#ad1c2e50d2f19d1ec1ae5dffd7524d6a2">mysqld_stmt_reset</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>packet_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reset a prepared statement in case there was a recoverable error.</p>
<p>This function resets statement to the state it was right after prepare. It can be used to:</p>
<ul>
<li>clear an error happened during mysqld_stmt_send_long_data</li>
<li>cancel long data stream for all placeholders without having to call mysqld_stmt_execute.</li>
<li>close an open cursor Sends 'OK' packet in case of success (statement was reset) or 'ERROR' packet (unrecoverable error/statement not found/etc).</li>
</ul>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread handle </td></tr>
    <tr><td class="paramname">packet</td><td>Packet with stmt id </td></tr>
    <tr><td class="paramname">packet_length</td><td>length of data in packet </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac923efcc818c95eeb45ebc9ac085f081"></a><!-- doxytag: member="sql_prepare.cc::reinit_stmt_before_use" ref="ac923efcc818c95eeb45ebc9ac085f081" args="(THD *thd, LEX *lex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sql__prepare_8cc.html#ac923efcc818c95eeb45ebc9ac085f081">reinit_stmt_before_use</a> </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LEX *&#160;</td>
          <td class="paramname"><em>lex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reinit prepared statement/stored procedure before execution.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000091">Todo:</a></b></dt><dd>When the new table structure is ready, then have a status bit to indicate the table is altered, and re-do the setup_* and open the tables back. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 16 2015 12:34:46 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
