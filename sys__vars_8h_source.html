<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: sys_vars.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">sys_vars.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sys__vars_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Copyright (c) 2002, 2014, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00004"></a>00004 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00005"></a>00005 <span class="comment">   the Free Software Foundation; version 2 of the License.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00008"></a>00008 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00009"></a>00009 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00010"></a>00010 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00013"></a>00013 <span class="comment">   along with this program; if not, write to the Free Software</span>
<a name="l00014"></a>00014 <span class="comment">   Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */</span>
<a name="l00015"></a>00015 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="sys__vars__shared_8h.html">sys_vars_shared.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;my_getopt.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;my_bit.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;my_dir.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;keycaches.h&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;strfunc.h&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;tztime.h&quot;</span>     <span class="comment">// my_tz_find, my_tz_SYSTEM, struct Time_zone</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;rpl_gtid.h&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/*</span>
<a name="l00035"></a>00035 <span class="comment">  a set of mostly trivial (as in f(X)=X) defines below to make system variable</span>
<a name="l00036"></a>00036 <span class="comment">  declarations more readable</span>
<a name="l00037"></a>00037 <span class="comment">*/</span>
<a name="l00038"></a>00038 <span class="preprocessor">#define VALID_RANGE(X,Y) X,Y</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT(X) X</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#define BLOCK_SIZE(X) X</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#define GLOBAL_VAR(X) sys_var::GLOBAL, (((char*)&amp;(X))-(char*)&amp;global_system_variables), sizeof(X)</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#define SESSION_VAR(X) sys_var::SESSION, offsetof(SV, X), sizeof(((SV *)0)-&gt;X)</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#define SESSION_ONLY(X) sys_var::ONLY_SESSION, offsetof(SV, X), sizeof(((SV *)0)-&gt;X)</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define NO_CMD_LINE CMD_LINE(NO_ARG, -1)</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00046"></a>00046 <span class="comment">  the define below means that there&#39;s no *second* mutex guard,</span>
<a name="l00047"></a>00047 <span class="comment">  LOCK_global_system_variables always guards all system variables</span>
<a name="l00048"></a>00048 <span class="comment">*/</span>
<a name="l00049"></a>00049 <span class="preprocessor">#define NO_MUTEX_GUARD ((PolyLock*)0)</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#define IN_BINLOG sys_var::SESSION_VARIABLE_IN_BINLOG</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#define NOT_IN_BINLOG sys_var::VARIABLE_NOT_IN_BINLOG</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#define ON_READ(X) X</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#define ON_CHECK(X) X</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#define ON_UPDATE(X) X</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#define READ_ONLY sys_var::READONLY+</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#define NOT_VISIBLE sys_var::INVISIBLE+</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="comment">// this means that Sys_var_charptr initial value was malloc()ed</span>
<a name="l00058"></a>00058 <span class="preprocessor">#define PREALLOCATED sys_var::ALLOCATED+</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00060"></a>00060 <span class="comment">  Sys_var_bit meaning is reversed, like in</span>
<a name="l00061"></a>00061 <span class="comment">  @@foreign_key_checks &lt;-&gt; OPTION_NO_FOREIGN_KEY_CHECKS</span>
<a name="l00062"></a>00062 <span class="comment">*/</span>
<a name="l00063"></a>00063 <span class="preprocessor">#define REVERSE(X) ~(X)</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#define DEPRECATED(X) X</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00066"></a>00066 <span class="preprocessor">#define session_var(THD, TYPE) (*(TYPE*)session_var_ptr(THD))</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#define global_var(TYPE) (*(TYPE*)global_var_ptr())</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>
<a name="l00069"></a>00069 <span class="preprocessor">#if SIZEOF_OFF_T &gt; 4 &amp;&amp; defined(BIG_TABLES)</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#define GET_HA_ROWS GET_ULL</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#define GET_HA_ROWS GET_ULONG</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>
<a name="l00075"></a>00075 <span class="keyword">enum</span> charset_enum {IN_SYSTEM_CHARSET, IN_FS_CHARSET};
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *bool_values[3]= {<span class="stringliteral">&quot;OFF&quot;</span>, <span class="stringliteral">&quot;ON&quot;</span>, 0};
<a name="l00078"></a>00078 
<a name="l00084"></a><a class="code" href="structCMD__LINE.html">00084</a> <span class="keyword">struct </span><a class="code" href="structCMD__LINE.html">CMD_LINE</a>
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086   <span class="keywordtype">int</span> id;
<a name="l00087"></a>00087   <span class="keyword">enum</span> get_opt_arg_type arg_type;
<a name="l00088"></a>00088   <a class="code" href="structCMD__LINE.html">CMD_LINE</a>(<span class="keyword">enum</span> get_opt_arg_type getopt_arg_type, <span class="keywordtype">int</span> getopt_id=0)
<a name="l00089"></a>00089     : id(getopt_id), arg_type(getopt_arg_type) {}
<a name="l00090"></a>00090 };
<a name="l00091"></a>00091 
<a name="l00105"></a>00105 <span class="keyword">template</span>
<a name="l00106"></a>00106   &lt;<span class="keyword">typename</span> T, ulong ARGT, <span class="keyword">enum</span> enum_mysql_show_type SHOWT, <span class="keywordtype">bool</span> SIGNED&gt;
<a name="l00107"></a><a class="code" href="classSys__var__integer.html">00107</a> <span class="keyword">class </span><a class="code" href="classSys__var__integer.html">Sys_var_integer</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l00108"></a>00108 {
<a name="l00109"></a>00109 <span class="keyword">public</span>:
<a name="l00110"></a>00110   <a class="code" href="classSys__var__integer.html">Sys_var_integer</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00111"></a>00111           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00112"></a>00112           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00113"></a>00113           T min_val, T max_val, T def_val, uint block_size, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00114"></a>00114           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00115"></a>00115           on_check_function on_check_func=0,
<a name="l00116"></a>00116           on_update_function on_update_func=0,
<a name="l00117"></a>00117           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l00118"></a>00118           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l00119"></a>00119     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l00120"></a>00120               getopt.arg_type, SHOWT, def_val, lock, binlog_status_arg,
<a name="l00121"></a>00121               on_check_func, on_update_func,
<a name="l00122"></a>00122               substitute, parse_flag)
<a name="l00123"></a>00123   {
<a name="l00124"></a>00124     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= ARGT;
<a name="l00125"></a>00125     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.min_value= min_val;
<a name="l00126"></a>00126     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.max_value= max_val;
<a name="l00127"></a>00127     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.block_size= block_size;
<a name="l00128"></a>00128     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.u_max_value= (uchar**)max_var_ptr();
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (max_var_ptr())
<a name="l00130"></a>00130       *max_var_ptr()= max_val;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">// Do not set global_var for Sys_var_keycache objects</span>
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (<a class="code" href="classsys__var.html#a78e5103c51e7bc209b9811e2c785ff99" title="offset to the value from global_system_variables">offset</a> &gt;= 0)
<a name="l00134"></a>00134       global_var(T)= def_val;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(T));
<a name="l00137"></a>00137     DBUG_ASSERT(min_val &lt; max_val);
<a name="l00138"></a>00138     DBUG_ASSERT(min_val &lt;= def_val);
<a name="l00139"></a>00139     DBUG_ASSERT(max_val &gt;= def_val);
<a name="l00140"></a>00140     DBUG_ASSERT(block_size &gt; 0);
<a name="l00141"></a>00141     DBUG_ASSERT(def_val % block_size == 0);
<a name="l00142"></a>00142   }
<a name="l00143"></a>00143   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00144"></a>00144   {
<a name="l00145"></a>00145     my_bool fixed= FALSE;
<a name="l00146"></a>00146     longlong v;
<a name="l00147"></a>00147     ulonglong uv;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     v= var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_int();
<a name="l00150"></a>00150     <span class="keywordflow">if</span> (SIGNED) <span class="comment">/* target variable has signed type */</span>
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;unsigned_flag)
<a name="l00153"></a>00153       {
<a name="l00154"></a>00154         <span class="comment">/*</span>
<a name="l00155"></a>00155 <span class="comment">          Input value is such a large positive number that MySQL used an</span>
<a name="l00156"></a>00156 <span class="comment">          unsigned item to hold it. When cast to a signed longlong, if the</span>
<a name="l00157"></a>00157 <span class="comment">          result is negative there is &quot;cycling&quot; and this is incorrect (large</span>
<a name="l00158"></a>00158 <span class="comment">          positive input value should not end up as a large negative value in</span>
<a name="l00159"></a>00159 <span class="comment">          the session signed variable to be set); instead, we need to pick the</span>
<a name="l00160"></a>00160 <span class="comment">          allowed number closest to the positive input value, i.e. pick the</span>
<a name="l00161"></a>00161 <span class="comment">          biggest allowed positive integer.</span>
<a name="l00162"></a>00162 <span class="comment">        */</span>
<a name="l00163"></a>00163         <span class="keywordflow">if</span> (v &lt; 0)
<a name="l00164"></a>00164           uv= max_of_int_range(ARGT);
<a name="l00165"></a>00165         <span class="keywordflow">else</span> <span class="comment">/* no cycling, longlong can hold true value */</span>
<a name="l00166"></a>00166           uv= (ulonglong) v;
<a name="l00167"></a>00167       }
<a name="l00168"></a>00168       <span class="keywordflow">else</span>
<a name="l00169"></a>00169         uv= v;
<a name="l00170"></a>00170       <span class="comment">/* This will further restrict with VALID_RANGE, BLOCK_SIZE */</span>
<a name="l00171"></a>00171       var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>=
<a name="l00172"></a>00172         getopt_ll_limit_value(uv, &amp;<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>, &amp;fixed);
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174     <span class="keywordflow">else</span>
<a name="l00175"></a>00175     {
<a name="l00176"></a>00176       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;unsigned_flag)
<a name="l00177"></a>00177       {
<a name="l00178"></a>00178         <span class="comment">/* Guaranteed positive input value, ulonglong can hold it */</span>
<a name="l00179"></a>00179         uv= (ulonglong) v;
<a name="l00180"></a>00180       }
<a name="l00181"></a>00181       <span class="keywordflow">else</span>
<a name="l00182"></a>00182       {
<a name="l00183"></a>00183         <span class="comment">/*</span>
<a name="l00184"></a>00184 <span class="comment">          Maybe negative input value; in this case, cast to ulonglong makes it</span>
<a name="l00185"></a>00185 <span class="comment">          positive, which is wrong. Pick the closest allowed value i.e. 0.</span>
<a name="l00186"></a>00186 <span class="comment">        */</span>
<a name="l00187"></a>00187         uv= (ulonglong) (v &lt; 0 ? 0 : v);
<a name="l00188"></a>00188       }
<a name="l00189"></a>00189       var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>=
<a name="l00190"></a>00190         getopt_ull_limit_value(uv, &amp;<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>, &amp;fixed);
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (max_var_ptr())
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195       <span class="comment">/* check constraint set with --maximum-...=X */</span>
<a name="l00196"></a>00196       <span class="keywordflow">if</span> (SIGNED)
<a name="l00197"></a>00197       {
<a name="l00198"></a>00198         longlong max_val= *max_var_ptr();
<a name="l00199"></a>00199         <span class="keywordflow">if</span> (((longlong)(var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>)) &gt; max_val)
<a name="l00200"></a>00200           var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= max_val;
<a name="l00201"></a>00201         <span class="comment">/*</span>
<a name="l00202"></a>00202 <span class="comment">          Signed variable probably has some kind of symmetry. Then it&#39;s good</span>
<a name="l00203"></a>00203 <span class="comment">          to limit negative values just as we limit positive values.</span>
<a name="l00204"></a>00204 <span class="comment">        */</span>
<a name="l00205"></a>00205         max_val= -max_val;
<a name="l00206"></a>00206         <span class="keywordflow">if</span> (((longlong)(var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>)) &lt; max_val)
<a name="l00207"></a>00207           var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= max_val;
<a name="l00208"></a>00208       }
<a name="l00209"></a>00209       <span class="keywordflow">else</span>
<a name="l00210"></a>00210       {
<a name="l00211"></a>00211         ulonglong max_val= *max_var_ptr();
<a name="l00212"></a>00212         <span class="keywordflow">if</span> (var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a> &gt; max_val)
<a name="l00213"></a>00213           var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= max_val;
<a name="l00214"></a>00214       }
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="keywordflow">return</span> throw_bounds_warning(thd, name.str,
<a name="l00218"></a>00218                                 var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a> !=
<a name="l00219"></a>00219                                 (ulonglong)v,
<a name="l00220"></a>00220                                 var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;unsigned_flag, v);
<a name="l00221"></a>00221   }
<a name="l00222"></a>00222   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00223"></a>00223   {
<a name="l00224"></a>00224     session_var(thd, T)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l00225"></a>00225     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00226"></a>00226   }
<a name="l00227"></a>00227   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00228"></a>00228   {
<a name="l00229"></a>00229     global_var(T)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l00230"></a>00230     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00231"></a>00231   }
<a name="l00232"></a>00232   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l00233"></a>00233   { <span class="keywordflow">return</span> type != INT_RESULT; }
<a name="l00234"></a><a class="code" href="classSys__var__integer.html#aed46d5a98789b087a079ff51f1d6a9a7">00234</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__integer.html#aed46d5a98789b087a079ff51f1d6a9a7">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00235"></a>00235   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= (ulonglong)*(T*)global_value_ptr(thd, 0); }
<a name="l00236"></a><a class="code" href="classSys__var__integer.html#a59952c5211c10659bc16a0f5f5706e9f">00236</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__integer.html#a59952c5211c10659bc16a0f5f5706e9f">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00237"></a>00237   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value; }
<a name="l00238"></a>00238   <span class="keyword">private</span>:
<a name="l00239"></a>00239   T *max_var_ptr()
<a name="l00240"></a>00240   {
<a name="l00241"></a>00241     <span class="keywordflow">return</span> scope() == SESSION ? (T*)(((uchar*)&amp;max_system_variables) + <a class="code" href="classsys__var.html#a78e5103c51e7bc209b9811e2c785ff99" title="offset to the value from global_system_variables">offset</a>)
<a name="l00242"></a>00242                               : 0;
<a name="l00243"></a>00243   }
<a name="l00244"></a>00244 };
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="keyword">typedef</span> <a class="code" href="classSys__var__integer.html">Sys_var_integer&lt;int32, GET_UINT, SHOW_INT, FALSE&gt;</a> <a class="code" href="classSys__var__integer.html">Sys_var_int32</a>;
<a name="l00247"></a>00247 <span class="keyword">typedef</span> <a class="code" href="classSys__var__integer.html">Sys_var_integer&lt;uint, GET_UINT, SHOW_INT, FALSE&gt;</a> <a class="code" href="classSys__var__integer.html">Sys_var_uint</a>;
<a name="l00248"></a>00248 <span class="keyword">typedef</span> <a class="code" href="classSys__var__integer.html">Sys_var_integer&lt;ulong, GET_ULONG, SHOW_LONG, FALSE&gt;</a> <a class="code" href="classSys__var__integer.html">Sys_var_ulong</a>;
<a name="l00249"></a>00249 <span class="keyword">typedef</span> <a class="code" href="classSys__var__integer.html">Sys_var_integer&lt;ha_rows, GET_HA_ROWS, SHOW_HA_ROWS, FALSE&gt;</a>
<a name="l00250"></a>00250   <a class="code" href="classSys__var__integer.html">Sys_var_harows</a>;
<a name="l00251"></a>00251 <span class="keyword">typedef</span> <a class="code" href="classSys__var__integer.html">Sys_var_integer&lt;ulonglong, GET_ULL, SHOW_LONGLONG, FALSE&gt;</a>
<a name="l00252"></a>00252   <a class="code" href="classSys__var__integer.html">Sys_var_ulonglong</a>;
<a name="l00253"></a>00253 <span class="keyword">typedef</span> <a class="code" href="classSys__var__integer.html">Sys_var_integer&lt;long, GET_LONG, SHOW_SIGNED_LONG, TRUE&gt;</a> <a class="code" href="classSys__var__integer.html">Sys_var_long</a>;
<a name="l00254"></a>00254 
<a name="l00258"></a><a class="code" href="classSys__var__typelib.html">00258</a> <span class="keyword">class </span><a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260 <span class="keyword">protected</span>:
<a name="l00261"></a>00261   TYPELIB typelib;
<a name="l00262"></a>00262 <span class="keyword">public</span>:
<a name="l00263"></a>00263   <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00264"></a>00264           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off,
<a name="l00265"></a>00265           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00266"></a>00266           SHOW_TYPE show_val_type_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *values[],
<a name="l00267"></a>00267           ulonglong def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock,
<a name="l00268"></a>00268           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg,
<a name="l00269"></a>00269           on_check_function on_check_func, on_update_function on_update_func,
<a name="l00270"></a>00270           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute, <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l00271"></a>00271     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l00272"></a>00272               getopt.arg_type, show_val_type_arg, def_val, lock,
<a name="l00273"></a>00273               binlog_status_arg, on_check_func,
<a name="l00274"></a>00274               on_update_func, substitute, parse_flag)
<a name="l00275"></a>00275   {
<a name="l00276"></a>00276     <span class="keywordflow">for</span> (typelib.count= 0; values[typelib.count]; typelib.count++) <span class="comment">/*no-op */</span>;
<a name="l00277"></a>00277     typelib.name=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00278"></a>00278     typelib.type_names= values;
<a name="l00279"></a>00279     typelib.type_lengths= 0;    <span class="comment">// only used by Fields_enum and Field_set</span>
<a name="l00280"></a>00280     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.typelib= &amp;typelib;
<a name="l00281"></a>00281   }
<a name="l00282"></a>00282   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var) <span class="comment">// works for enums and my_bool</span>
<a name="l00283"></a>00283   {
<a name="l00284"></a>00284     <span class="keywordtype">char</span> buff[STRING_BUFFER_USUAL_SIZE];
<a name="l00285"></a>00285     <a class="code" href="classString.html">String</a> str(buff, <span class="keyword">sizeof</span>(buff), system_charset_info), *res;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;result_type() == STRING_RESULT)
<a name="l00288"></a>00288     {
<a name="l00289"></a>00289       <span class="keywordflow">if</span> (!(res=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str)))
<a name="l00290"></a>00290         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00291"></a>00291       <span class="keywordflow">else</span>
<a name="l00292"></a>00292       <span class="keywordflow">if</span> (!(var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>=
<a name="l00293"></a>00293             find_type(&amp;typelib, res-&gt;ptr(), res-&gt;length(), <span class="keyword">false</span>)))
<a name="l00294"></a>00294         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00295"></a>00295       <span class="keywordflow">else</span>
<a name="l00296"></a>00296         var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>--;
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298     <span class="keywordflow">else</span>
<a name="l00299"></a>00299     {
<a name="l00300"></a>00300       longlong tmp=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_int();
<a name="l00301"></a>00301       <span class="keywordflow">if</span> (tmp &lt; 0 || tmp &gt;= typelib.count)
<a name="l00302"></a>00302         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00303"></a>00303       <span class="keywordflow">else</span>
<a name="l00304"></a>00304         var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= tmp;
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00308"></a>00308   }
<a name="l00309"></a>00309   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l00310"></a>00310   { <span class="keywordflow">return</span> type != INT_RESULT &amp;&amp; type != STRING_RESULT; }
<a name="l00311"></a>00311 };
<a name="l00312"></a>00312 
<a name="l00327"></a><a class="code" href="classSys__var__enum.html">00327</a> <span class="keyword">class </span><a class="code" href="classSys__var__enum.html">Sys_var_enum</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>
<a name="l00328"></a>00328 {
<a name="l00329"></a>00329 <span class="keyword">public</span>:
<a name="l00330"></a>00330   <a class="code" href="classSys__var__enum.html">Sys_var_enum</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00331"></a>00331           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00332"></a>00332           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00333"></a>00333           <span class="keyword">const</span> <span class="keywordtype">char</span> *values[], uint def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00334"></a>00334           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00335"></a>00335           on_check_function on_check_func=0,
<a name="l00336"></a>00336           on_update_function on_update_func=0,
<a name="l00337"></a>00337           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l00338"></a>00338     : <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>(name_arg, comment, flag_args, off, getopt,
<a name="l00339"></a>00339                       SHOW_CHAR, values, def_val, lock,
<a name="l00340"></a>00340                       binlog_status_arg, on_check_func, on_update_func,
<a name="l00341"></a>00341                       substitute)
<a name="l00342"></a>00342   {
<a name="l00343"></a>00343     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_ENUM;
<a name="l00344"></a>00344     global_var(ulong)= def_val;
<a name="l00345"></a>00345     DBUG_ASSERT(def_val &lt; typelib.count);
<a name="l00346"></a>00346     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(ulong));
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00349"></a>00349   {
<a name="l00350"></a>00350     session_var(thd, ulong)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l00351"></a>00351     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00352"></a>00352   }
<a name="l00353"></a>00353   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00354"></a>00354   {
<a name="l00355"></a>00355     global_var(ulong)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l00356"></a>00356     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00357"></a>00357   }
<a name="l00358"></a><a class="code" href="classSys__var__enum.html#a6105ba8d79f076e7ad271449c3e44d2f">00358</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__enum.html#a6105ba8d79f076e7ad271449c3e44d2f">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00359"></a>00359   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= global_var(ulong); }
<a name="l00360"></a><a class="code" href="classSys__var__enum.html#a92bd0f6a0c19af8b437fa2ee81c92c72">00360</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__enum.html#a92bd0f6a0c19af8b437fa2ee81c92c72">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00361"></a>00361   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value; }
<a name="l00362"></a><a class="code" href="classSys__var__enum.html#ae66ae24c99b0378f4ae2d8f942b0b833">00362</a>   uchar *<a class="code" href="classSys__var__enum.html#ae66ae24c99b0378f4ae2d8f942b0b833">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l00363"></a>00363   { <span class="keywordflow">return</span> (uchar*)typelib.type_names[session_var(thd, ulong)]; }
<a name="l00364"></a>00364   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l00365"></a>00365   { <span class="keywordflow">return</span> (uchar*)typelib.type_names[global_var(ulong)]; }
<a name="l00366"></a>00366 };
<a name="l00367"></a>00367 
<a name="l00374"></a><a class="code" href="classSys__var__mybool.html">00374</a> <span class="keyword">class </span><a class="code" href="classSys__var__mybool.html">Sys_var_mybool</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376 <span class="keyword">public</span>:
<a name="l00377"></a>00377   <a class="code" href="classSys__var__mybool.html">Sys_var_mybool</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00378"></a>00378           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00379"></a>00379           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00380"></a>00380           my_bool def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00381"></a>00381           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00382"></a>00382           on_check_function on_check_func=0,
<a name="l00383"></a>00383           on_update_function on_update_func=0,
<a name="l00384"></a>00384           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l00385"></a>00385           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l00386"></a>00386     : <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>(name_arg, comment, flag_args, off, getopt,
<a name="l00387"></a>00387                       SHOW_MY_BOOL, bool_values, def_val, lock,
<a name="l00388"></a>00388                       binlog_status_arg, on_check_func, on_update_func,
<a name="l00389"></a>00389                       substitute, parse_flag)
<a name="l00390"></a>00390   {
<a name="l00391"></a>00391     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_BOOL;
<a name="l00392"></a>00392     global_var(my_bool)= def_val;
<a name="l00393"></a>00393     DBUG_ASSERT(def_val &lt; 2);
<a name="l00394"></a>00394     DBUG_ASSERT(getopt.arg_type == OPT_ARG || getopt.id == -1);
<a name="l00395"></a>00395     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(my_bool));
<a name="l00396"></a>00396   }
<a name="l00397"></a>00397   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00398"></a>00398   {
<a name="l00399"></a>00399     session_var(thd, my_bool)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l00400"></a>00400     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00401"></a>00401   }
<a name="l00402"></a>00402   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00403"></a>00403   {
<a name="l00404"></a>00404     global_var(my_bool)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l00405"></a>00405     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00406"></a>00406   }
<a name="l00407"></a><a class="code" href="classSys__var__mybool.html#a7c0f82c4951aa5a3b41921a62197473d">00407</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__mybool.html#a7c0f82c4951aa5a3b41921a62197473d">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00408"></a>00408   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= (ulonglong)*(my_bool *)global_value_ptr(thd, 0); }
<a name="l00409"></a><a class="code" href="classSys__var__mybool.html#aecba009ba09790acfb4201c2d1bb1f84">00409</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__mybool.html#aecba009ba09790acfb4201c2d1bb1f84">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00410"></a>00410   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value; }
<a name="l00411"></a>00411 };
<a name="l00412"></a>00412 
<a name="l00429"></a><a class="code" href="classSys__var__charptr.html">00429</a> <span class="keyword">class </span><a class="code" href="classSys__var__charptr.html">Sys_var_charptr</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431 <span class="keyword">public</span>:
<a name="l00432"></a>00432   <a class="code" href="classSys__var__charptr.html">Sys_var_charptr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00433"></a>00433           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00434"></a>00434           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00435"></a>00435           <span class="keyword">enum</span> charset_enum is_os_charset_arg,
<a name="l00436"></a>00436           <span class="keyword">const</span> <span class="keywordtype">char</span> *def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00437"></a>00437           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00438"></a>00438           on_check_function on_check_func=0,
<a name="l00439"></a>00439           on_update_function on_update_func=0,
<a name="l00440"></a>00440           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l00441"></a>00441           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l00442"></a>00442     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l00443"></a>00443               getopt.arg_type, SHOW_CHAR_PTR, (intptr)def_val,
<a name="l00444"></a>00444               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l00445"></a>00445               substitute, parse_flag)
<a name="l00446"></a>00446   {
<a name="l00447"></a>00447     <a class="code" href="classsys__var.html#a725101611b3ee5d79fb9cf374c4460c7" title="true if the value is in character_set_filesystem">is_os_charset</a>= is_os_charset_arg == IN_FS_CHARSET;
<a name="l00448"></a>00448     <span class="comment">/*</span>
<a name="l00449"></a>00449 <span class="comment">     use GET_STR_ALLOC - if ALLOCATED it must be *always* allocated,</span>
<a name="l00450"></a>00450 <span class="comment">     otherwise (GET_STR) you&#39;ll never know whether to free it or not.</span>
<a name="l00451"></a>00451 <span class="comment">     (think of an exit because of an error right after my_getopt)</span>
<a name="l00452"></a>00452 <span class="comment">    */</span>
<a name="l00453"></a>00453     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= (<a class="code" href="classsys__var.html#ab8847ce287d6d685e06049859ffa243c" title="or&#39;ed flag_enum values">flags</a> &amp; ALLOCATED) ? GET_STR_ALLOC : GET_STR;
<a name="l00454"></a>00454     global_var(<span class="keyword">const</span> <span class="keywordtype">char</span>*)= def_val;
<a name="l00455"></a>00455     DBUG_ASSERT(scope() == GLOBAL);
<a name="l00456"></a>00456     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));
<a name="l00457"></a>00457   }
<a name="l00458"></a><a class="code" href="classSys__var__charptr.html#a7cb7fcaf1b60752b38bfcff61e92b2ca">00458</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__charptr.html#a7cb7fcaf1b60752b38bfcff61e92b2ca">cleanup</a>()
<a name="l00459"></a>00459   {
<a name="l00460"></a>00460     <span class="keywordflow">if</span> (<a class="code" href="classsys__var.html#ab8847ce287d6d685e06049859ffa243c" title="or&#39;ed flag_enum values">flags</a> &amp; ALLOCATED)
<a name="l00461"></a>00461       my_free(global_var(<span class="keywordtype">char</span>*));
<a name="l00462"></a>00462     <a class="code" href="classsys__var.html#ab8847ce287d6d685e06049859ffa243c" title="or&#39;ed flag_enum values">flags</a>&amp;= ~ALLOCATED;
<a name="l00463"></a>00463   }
<a name="l00464"></a>00464   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00465"></a>00465   {
<a name="l00466"></a>00466     <span class="keywordtype">char</span> buff[STRING_BUFFER_USUAL_SIZE], buff2[STRING_BUFFER_USUAL_SIZE];
<a name="l00467"></a>00467     <a class="code" href="classString.html">String</a> str(buff, <span class="keyword">sizeof</span>(buff), charset(thd));
<a name="l00468"></a>00468     <a class="code" href="classString.html">String</a> str2(buff2, <span class="keyword">sizeof</span>(buff2), charset(thd)), *res;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     <span class="keywordflow">if</span> (!(res=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str)))
<a name="l00471"></a>00471       var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= 0;
<a name="l00472"></a>00472     <span class="keywordflow">else</span>
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474       uint32 unused;
<a name="l00475"></a>00475       <span class="keywordflow">if</span> (String::needs_conversion(res-&gt;length(), res-&gt;charset(),
<a name="l00476"></a>00476                                    charset(thd), &amp;unused))
<a name="l00477"></a>00477       {
<a name="l00478"></a>00478         uint errors;
<a name="l00479"></a>00479         str2.copy(res-&gt;ptr(), res-&gt;length(), res-&gt;charset(), charset(thd),
<a name="l00480"></a>00480                   &amp;errors);
<a name="l00481"></a>00481         res=&amp;str2;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       }
<a name="l00484"></a>00484       var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= thd-&gt;strmake(res-&gt;ptr(), res-&gt;length());
<a name="l00485"></a>00485       var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length= res-&gt;length();
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00489"></a>00489   }
<a name="l00490"></a>00490   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00491"></a>00491   {
<a name="l00492"></a>00492     DBUG_ASSERT(FALSE);
<a name="l00493"></a>00493     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00494"></a>00494   }
<a name="l00495"></a>00495   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00496"></a>00496   {
<a name="l00497"></a>00497     <span class="keywordtype">char</span> *new_val, *ptr= var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str;
<a name="l00498"></a>00498     <span class="keywordtype">size_t</span> len=var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length;
<a name="l00499"></a>00499     <span class="keywordflow">if</span> (ptr)
<a name="l00500"></a>00500     {
<a name="l00501"></a>00501       new_val= (<span class="keywordtype">char</span>*)my_memdup(ptr, len+1, MYF(MY_WME));
<a name="l00502"></a>00502       <span class="keywordflow">if</span> (!new_val) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00503"></a>00503       new_val[len]=0;
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505     <span class="keywordflow">else</span>
<a name="l00506"></a>00506       new_val= 0;
<a name="l00507"></a>00507     <span class="keywordflow">if</span> (<a class="code" href="classsys__var.html#ab8847ce287d6d685e06049859ffa243c" title="or&#39;ed flag_enum values">flags</a> &amp; ALLOCATED)
<a name="l00508"></a>00508       my_free(global_var(<span class="keywordtype">char</span>*));
<a name="l00509"></a>00509     <a class="code" href="classsys__var.html#ab8847ce287d6d685e06049859ffa243c" title="or&#39;ed flag_enum values">flags</a>|= ALLOCATED;
<a name="l00510"></a>00510     global_var(<span class="keywordtype">char</span>*)= new_val;
<a name="l00511"></a>00511     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00512"></a>00512   }
<a name="l00513"></a><a class="code" href="classSys__var__charptr.html#a37d10016ddc7bbe7443be35afd3bb823">00513</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__charptr.html#a37d10016ddc7bbe7443be35afd3bb823">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00514"></a>00514   { DBUG_ASSERT(FALSE); }
<a name="l00515"></a><a class="code" href="classSys__var__charptr.html#a9f0eb7d9ac367d2652c5aefe05282dae">00515</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__charptr.html#a9f0eb7d9ac367d2652c5aefe05282dae">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00516"></a>00516   {
<a name="l00517"></a>00517     <span class="keywordtype">char</span> *ptr= (<span class="keywordtype">char</span>*)(intptr)<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value;
<a name="l00518"></a>00518     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= ptr;
<a name="l00519"></a>00519     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length= ptr ? strlen(ptr) : 0;
<a name="l00520"></a>00520   }
<a name="l00521"></a>00521   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l00522"></a>00522   { <span class="keywordflow">return</span> type != STRING_RESULT; }
<a name="l00523"></a>00523 };
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 
<a name="l00526"></a><a class="code" href="classSys__var__proxy__user.html">00526</a> <span class="keyword">class </span><a class="code" href="classSys__var__proxy__user.html">Sys_var_proxy_user</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l00527"></a>00527 {
<a name="l00528"></a>00528 <span class="keyword">public</span>:
<a name="l00529"></a>00529   <a class="code" href="classSys__var__proxy__user.html">Sys_var_proxy_user</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00530"></a>00530           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keyword">enum</span> charset_enum is_os_charset_arg)
<a name="l00531"></a>00531     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment,
<a name="l00532"></a>00532               sys_var::READONLY+sys_var::ONLY_SESSION, 0, -1,
<a name="l00533"></a>00533               NO_ARG, SHOW_CHAR, 0, NULL, VARIABLE_NOT_IN_BINLOG,
<a name="l00534"></a>00534               NULL, NULL, NULL, PARSE_NORMAL)
<a name="l00535"></a>00535   {
<a name="l00536"></a>00536     <a class="code" href="classsys__var.html#a725101611b3ee5d79fb9cf374c4460c7" title="true if the value is in character_set_filesystem">is_os_charset</a>= is_os_charset_arg == IN_FS_CHARSET;
<a name="l00537"></a>00537     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_STR;
<a name="l00538"></a>00538   }
<a name="l00539"></a>00539   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00540"></a>00540   {
<a name="l00541"></a>00541     DBUG_ASSERT(FALSE);
<a name="l00542"></a>00542     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00545"></a>00545   {
<a name="l00546"></a>00546     DBUG_ASSERT(FALSE);
<a name="l00547"></a>00547     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00548"></a>00548   }
<a name="l00549"></a>00549   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00550"></a>00550   {
<a name="l00551"></a>00551     DBUG_ASSERT(FALSE);
<a name="l00552"></a>00552     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00553"></a>00553   }
<a name="l00554"></a><a class="code" href="classSys__var__proxy__user.html#ae35cbb27adc891da688c4428ebc7df7e">00554</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__proxy__user.html#ae35cbb27adc891da688c4428ebc7df7e">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00555"></a>00555   { DBUG_ASSERT(FALSE); }
<a name="l00556"></a><a class="code" href="classSys__var__proxy__user.html#a261981ce30b908f8a6f2cb697576f578">00556</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__proxy__user.html#a261981ce30b908f8a6f2cb697576f578">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00557"></a>00557   { DBUG_ASSERT(FALSE); }
<a name="l00558"></a>00558   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l00559"></a>00559   { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l00560"></a>00560 <span class="keyword">protected</span>:
<a name="l00561"></a><a class="code" href="classSys__var__proxy__user.html#a60e9c87a4029697a4065ada1a91f5c0b">00561</a>   <span class="keyword">virtual</span> uchar *<a class="code" href="classSys__var__proxy__user.html#a60e9c87a4029697a4065ada1a91f5c0b">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l00562"></a>00562   {
<a name="l00563"></a>00563     <span class="keywordflow">return</span> thd-&gt;security_ctx-&gt;proxy_user[0] ?
<a name="l00564"></a>00564       (uchar *) &amp;(thd-&gt;security_ctx-&gt;proxy_user[0]) : NULL;
<a name="l00565"></a>00565   }
<a name="l00566"></a>00566 };
<a name="l00567"></a>00567 
<a name="l00568"></a><a class="code" href="classSys__var__external__user.html">00568</a> <span class="keyword">class </span><a class="code" href="classSys__var__external__user.html">Sys_var_external_user</a> : <span class="keyword">public</span> <a class="code" href="classSys__var__proxy__user.html">Sys_var_proxy_user</a>
<a name="l00569"></a>00569 {
<a name="l00570"></a>00570 <span class="keyword">public</span>:
<a name="l00571"></a>00571   <a class="code" href="classSys__var__external__user.html">Sys_var_external_user</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *comment_arg,
<a name="l00572"></a>00572           <span class="keyword">enum</span> charset_enum is_os_charset_arg)
<a name="l00573"></a>00573     : <a class="code" href="classSys__var__proxy__user.html">Sys_var_proxy_user</a> (name_arg, comment_arg, is_os_charset_arg)
<a name="l00574"></a>00574   {}
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 <span class="keyword">protected</span>:
<a name="l00577"></a><a class="code" href="classSys__var__external__user.html#a23382478c26c54a64247f75cdbe971c8">00577</a>   <span class="keyword">virtual</span> uchar *<a class="code" href="classSys__var__external__user.html#a23382478c26c54a64247f75cdbe971c8">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l00578"></a>00578   {
<a name="l00579"></a>00579     <span class="keywordflow">return</span> thd-&gt;security_ctx-&gt;proxy_user[0] ?
<a name="l00580"></a>00580       (uchar *) &amp;(thd-&gt;security_ctx-&gt;proxy_user[0]) : NULL;
<a name="l00581"></a>00581   }
<a name="l00582"></a>00582 };
<a name="l00583"></a>00583 
<a name="l00596"></a><a class="code" href="classSys__var__lexstring.html">00596</a> <span class="keyword">class </span><a class="code" href="classSys__var__lexstring.html">Sys_var_lexstring</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__charptr.html">Sys_var_charptr</a>
<a name="l00597"></a>00597 {
<a name="l00598"></a>00598 <span class="keyword">public</span>:
<a name="l00599"></a>00599   <a class="code" href="classSys__var__lexstring.html">Sys_var_lexstring</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00600"></a>00600           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00601"></a>00601           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00602"></a>00602           <span class="keyword">enum</span> charset_enum is_os_charset_arg,
<a name="l00603"></a>00603           <span class="keyword">const</span> <span class="keywordtype">char</span> *def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00604"></a>00604           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00605"></a>00605           on_check_function on_check_func=0,
<a name="l00606"></a>00606           on_update_function on_update_func=0,
<a name="l00607"></a>00607           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l00608"></a>00608     : <a class="code" href="classSys__var__charptr.html">Sys_var_charptr</a>(name_arg, comment, flag_args, off, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*),
<a name="l00609"></a>00609               getopt, is_os_charset_arg, def_val, lock, binlog_status_arg,
<a name="l00610"></a>00610               on_check_func, on_update_func, substitute)
<a name="l00611"></a>00611   {
<a name="l00612"></a>00612     global_var(LEX_STRING).length= strlen(def_val);
<a name="l00613"></a>00613     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(LEX_STRING));
<a name="l00614"></a>00614     *<span class="keyword">const_cast&lt;</span>SHOW_TYPE*<span class="keyword">&gt;</span>(&amp;<a class="code" href="classsys__var.html#ab6628d06f7becbd0231835a3f440ee9f" title="what value_ptr() returns for sql_show.cc">show_val_type</a>)= SHOW_LEX_STRING;
<a name="l00615"></a>00615   }
<a name="l00616"></a>00616   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00617"></a>00617   {
<a name="l00618"></a>00618     <span class="keywordflow">if</span> (Sys_var_charptr::global_update(thd, var))
<a name="l00619"></a>00619       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00620"></a>00620     global_var(LEX_STRING).length= var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length;
<a name="l00621"></a>00621     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00622"></a>00622   }
<a name="l00623"></a>00623 };
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 <span class="preprocessor">#ifndef DBUG_OFF</span>
<a name="l00626"></a>00626 <span class="preprocessor"></span>
<a name="l00637"></a><a class="code" href="classSys__var__dbug.html">00637</a> <span class="keyword">class </span><a class="code" href="classSys__var__dbug.html">Sys_var_dbug</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l00638"></a>00638 {
<a name="l00639"></a>00639 <span class="keyword">public</span>:
<a name="l00640"></a>00640   <a class="code" href="classSys__var__dbug.html">Sys_var_dbug</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00641"></a>00641                <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args,
<a name="l00642"></a>00642                <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00643"></a>00643                <span class="keyword">const</span> <span class="keywordtype">char</span> *def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00644"></a>00644                <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00645"></a>00645                on_check_function on_check_func=0,
<a name="l00646"></a>00646                on_update_function on_update_func=0,
<a name="l00647"></a>00647                <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l00648"></a>00648                <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l00649"></a>00649     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, 0, getopt.id,
<a name="l00650"></a>00650               getopt.arg_type, SHOW_CHAR, (intptr)def_val,
<a name="l00651"></a>00651               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l00652"></a>00652               substitute, parse_flag)
<a name="l00653"></a>00653   { <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_NO_ARG; }
<a name="l00654"></a>00654   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00655"></a>00655   {
<a name="l00656"></a>00656     <span class="keywordtype">char</span> buff[STRING_BUFFER_USUAL_SIZE];
<a name="l00657"></a>00657     <a class="code" href="classString.html">String</a> str(buff, <span class="keyword">sizeof</span>(buff), system_charset_info), *res;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     <span class="keywordflow">if</span> (!(res=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str)))
<a name="l00660"></a>00660       var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00661"></a>00661     <span class="keywordflow">else</span>
<a name="l00662"></a>00662       var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= thd-&gt;strmake(res-&gt;ptr(), res-&gt;length());
<a name="l00663"></a>00663     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00664"></a>00664   }
<a name="l00665"></a>00665   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00666"></a>00666   {
<a name="l00667"></a>00667     <span class="keyword">const</span> <span class="keywordtype">char</span> *val= var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str;
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (!var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>)
<a name="l00669"></a>00669       DBUG_POP();
<a name="l00670"></a>00670     <span class="keywordflow">else</span>
<a name="l00671"></a>00671       DBUG_SET(val);
<a name="l00672"></a>00672     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00673"></a>00673   }
<a name="l00674"></a>00674   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00675"></a>00675   {
<a name="l00676"></a>00676     <span class="keyword">const</span> <span class="keywordtype">char</span> *val= var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str;
<a name="l00677"></a>00677     DBUG_SET_INITIAL(val);
<a name="l00678"></a>00678     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00679"></a>00679   }
<a name="l00680"></a><a class="code" href="classSys__var__dbug.html#a6a5b393d2e8fd791ca0d567de63cf995">00680</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__dbug.html#a6a5b393d2e8fd791ca0d567de63cf995">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00681"></a>00681   { }
<a name="l00682"></a><a class="code" href="classSys__var__dbug.html#a022ff27659567b4ed8b73f797f0d51bb">00682</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__dbug.html#a022ff27659567b4ed8b73f797f0d51bb">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00683"></a>00683   {
<a name="l00684"></a>00684     <span class="keywordtype">char</span> *ptr= (<span class="keywordtype">char</span>*)(intptr)<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value;
<a name="l00685"></a>00685     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= ptr;
<a name="l00686"></a>00686   }
<a name="l00687"></a><a class="code" href="classSys__var__dbug.html#ad14fd20c13dd226dd099c9f44b2b286c">00687</a>   uchar *<a class="code" href="classSys__var__dbug.html#ad14fd20c13dd226dd099c9f44b2b286c">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l00688"></a>00688   {
<a name="l00689"></a>00689     <span class="keywordtype">char</span> buf[256];
<a name="l00690"></a>00690     DBUG_EXPLAIN(buf, <span class="keyword">sizeof</span>(buf));
<a name="l00691"></a>00691     <span class="keywordflow">return</span> (uchar*) thd-&gt;strdup(buf);
<a name="l00692"></a>00692   }
<a name="l00693"></a>00693   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l00694"></a>00694   {
<a name="l00695"></a>00695     <span class="keywordtype">char</span> buf[256];
<a name="l00696"></a>00696     DBUG_EXPLAIN_INITIAL(buf, <span class="keyword">sizeof</span>(buf));
<a name="l00697"></a>00697     <span class="keywordflow">return</span> (uchar*) thd-&gt;strdup(buf);
<a name="l00698"></a>00698   }
<a name="l00699"></a>00699   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l00700"></a>00700   { <span class="keywordflow">return</span> type != STRING_RESULT; }
<a name="l00701"></a>00701 };
<a name="l00702"></a>00702 <span class="preprocessor">#endif</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span>
<a name="l00704"></a>00704 <span class="preprocessor">#define KEYCACHE_VAR(X) sys_var::GLOBAL,offsetof(KEY_CACHE, X), sizeof(((KEY_CACHE *)0)-&gt;X)</span>
<a name="l00705"></a>00705 <span class="preprocessor"></span><span class="preprocessor">#define keycache_var_ptr(KC, OFF) (((uchar*)(KC))+(OFF))</span>
<a name="l00706"></a>00706 <span class="preprocessor"></span><span class="preprocessor">#define keycache_var(KC, OFF) (*(ulonglong*)keycache_var_ptr(KC, OFF))</span>
<a name="l00707"></a>00707 <span class="preprocessor"></span><span class="keyword">typedef</span> bool (*keycache_update_function)(THD *, KEY_CACHE *, ptrdiff_t, ulonglong);
<a name="l00708"></a>00708 
<a name="l00720"></a><a class="code" href="classSys__var__keycache.html">00720</a> <span class="keyword">class </span><a class="code" href="classSys__var__keycache.html">Sys_var_keycache</a>: <span class="keyword">public</span> Sys_var_ulonglong
<a name="l00721"></a>00721 {
<a name="l00722"></a>00722   keycache_update_function keycache_update;
<a name="l00723"></a>00723 <span class="keyword">public</span>:
<a name="l00724"></a>00724   <a class="code" href="classSys__var__keycache.html">Sys_var_keycache</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00725"></a>00725           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00726"></a>00726           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00727"></a>00727           ulonglong min_val, ulonglong max_val, ulonglong def_val,
<a name="l00728"></a>00728           ulonglong block_size, <a class="code" href="classPolyLock.html">PolyLock</a> *lock,
<a name="l00729"></a>00729           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg,
<a name="l00730"></a>00730           on_check_function on_check_func,
<a name="l00731"></a>00731           keycache_update_function on_update_func,
<a name="l00732"></a>00732           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l00733"></a>00733     : Sys_var_ulonglong(name_arg, comment, flag_args,
<a name="l00734"></a>00734                         -1,     <span class="comment">/* offset, see base class CTOR */</span>
<a name="l00735"></a>00735                         size,
<a name="l00736"></a>00736                         getopt, min_val, max_val, def_val,
<a name="l00737"></a>00737                         block_size, lock, binlog_status_arg, on_check_func, 0,
<a name="l00738"></a>00738                         substitute),
<a name="l00739"></a>00739     keycache_update(on_update_func)
<a name="l00740"></a>00740   {
<a name="l00741"></a>00741     <a class="code" href="classsys__var.html#a78e5103c51e7bc209b9811e2c785ff99" title="offset to the value from global_system_variables">offset</a>= off; <span class="comment">/* Remember offset in KEY_CACHE */</span>
<a name="l00742"></a>00742     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type|= GET_ASK_ADDR;
<a name="l00743"></a>00743     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.value= (uchar**)1; <span class="comment">// crash me, please</span>
<a name="l00744"></a>00744     keycache_var(dflt_key_cache, off)= def_val;
<a name="l00745"></a>00745     DBUG_ASSERT(scope() == GLOBAL);
<a name="l00746"></a>00746   }
<a name="l00747"></a><a class="code" href="classSys__var__keycache.html#a7775f6e9ee55bb58461d6556f053075f">00747</a>   <span class="keywordtype">bool</span> <a class="code" href="classSys__var__keycache.html#a7775f6e9ee55bb58461d6556f053075f">global_update</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00748"></a>00748   {
<a name="l00749"></a>00749     ulonglong new_value= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l00750"></a>00750     LEX_STRING *base_name= &amp;var-&gt;<a class="code" href="classset__var.html#a8eeb18aa84a3652c4df76ce222e2a14c">base</a>;
<a name="l00751"></a>00751     KEY_CACHE *key_cache;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="comment">/* If no basename, assume it&#39;s for the key cache named &#39;default&#39; */</span>
<a name="l00754"></a>00754     <span class="keywordflow">if</span> (!base_name-&gt;length)
<a name="l00755"></a>00755       base_name= &amp;default_key_cache_base;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757     key_cache= get_key_cache(base_name);
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     <span class="keywordflow">if</span> (!key_cache)
<a name="l00760"></a>00760     {                                           <span class="comment">// Key cache didn&#39;t exists */</span>
<a name="l00761"></a>00761       <span class="keywordflow">if</span> (!new_value)                           <span class="comment">// Tried to delete cache</span>
<a name="l00762"></a>00762         <span class="keywordflow">return</span> <span class="keyword">false</span>;                           <span class="comment">// Ok, nothing to do</span>
<a name="l00763"></a>00763       <span class="keywordflow">if</span> (!(key_cache= create_key_cache(base_name-&gt;str, base_name-&gt;length)))
<a name="l00764"></a>00764         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766 
<a name="l00772"></a>00772     <span class="keywordflow">if</span> (key_cache-&gt;in_init)
<a name="l00773"></a>00773       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <span class="keywordflow">return</span> keycache_update(thd, key_cache, <a class="code" href="classsys__var.html#a78e5103c51e7bc209b9811e2c785ff99" title="offset to the value from global_system_variables">offset</a>, new_value);
<a name="l00776"></a>00776   }
<a name="l00777"></a>00777   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l00778"></a>00778   {
<a name="l00779"></a>00779     KEY_CACHE *key_cache= get_key_cache(base);
<a name="l00780"></a>00780     <span class="keywordflow">if</span> (!key_cache)
<a name="l00781"></a>00781       key_cache= &amp;zero_key_cache;
<a name="l00782"></a>00782     <span class="keywordflow">return</span> keycache_var_ptr(key_cache, <a class="code" href="classsys__var.html#a78e5103c51e7bc209b9811e2c785ff99" title="offset to the value from global_system_variables">offset</a>);
<a name="l00783"></a>00783   }
<a name="l00784"></a>00784 };
<a name="l00785"></a>00785 
<a name="l00793"></a><a class="code" href="classSys__var__double.html">00793</a> <span class="keyword">class </span><a class="code" href="classSys__var__double.html">Sys_var_double</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l00794"></a>00794 {
<a name="l00795"></a>00795 <span class="keyword">public</span>:
<a name="l00796"></a>00796   <a class="code" href="classSys__var__double.html">Sys_var_double</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00797"></a>00797           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00798"></a>00798           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00799"></a>00799           <span class="keywordtype">double</span> min_val, <span class="keywordtype">double</span> max_val, <span class="keywordtype">double</span> def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00800"></a>00800           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00801"></a>00801           on_check_function on_check_func=0,
<a name="l00802"></a>00802           on_update_function on_update_func=0,
<a name="l00803"></a>00803           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l00804"></a>00804           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l00805"></a>00805     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l00806"></a>00806               getopt.arg_type, SHOW_DOUBLE,
<a name="l00807"></a>00807               (longlong) getopt_double2ulonglong(def_val),
<a name="l00808"></a>00808               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l00809"></a>00809               substitute, parse_flag)
<a name="l00810"></a>00810   {
<a name="l00811"></a>00811     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_DOUBLE;
<a name="l00812"></a>00812     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.min_value= (longlong) getopt_double2ulonglong(min_val);
<a name="l00813"></a>00813     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.max_value= (longlong) getopt_double2ulonglong(max_val);
<a name="l00814"></a>00814     global_var(<span class="keywordtype">double</span>)= (double)<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value;
<a name="l00815"></a>00815     DBUG_ASSERT(min_val &lt;= max_val);
<a name="l00816"></a>00816     DBUG_ASSERT(min_val &lt;= def_val);
<a name="l00817"></a>00817     DBUG_ASSERT(max_val &gt;= def_val);
<a name="l00818"></a>00818     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00819"></a>00819   }
<a name="l00820"></a>00820   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00821"></a>00821   {
<a name="l00822"></a>00822     my_bool fixed;
<a name="l00823"></a>00823     <span class="keywordtype">double</span> v= var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_real();
<a name="l00824"></a>00824     var-&gt;save_result.<a class="code" href="classset__var.html#af84f10f97ad46414f06ebef7dfe16aff" title="for Sys_var_double">double_value</a>= getopt_double_limit_value(v, &amp;<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>, &amp;fixed);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826     <span class="keywordflow">return</span> throw_bounds_warning(thd, name.str, fixed, v);
<a name="l00827"></a>00827   }
<a name="l00828"></a>00828   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00829"></a>00829   {
<a name="l00830"></a>00830     session_var(thd, <span class="keywordtype">double</span>)= var-&gt;save_result.<a class="code" href="classset__var.html#af84f10f97ad46414f06ebef7dfe16aff" title="for Sys_var_double">double_value</a>;
<a name="l00831"></a>00831     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00832"></a>00832   }
<a name="l00833"></a>00833   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00834"></a>00834   {
<a name="l00835"></a>00835     global_var(<span class="keywordtype">double</span>)= var-&gt;save_result.<a class="code" href="classset__var.html#af84f10f97ad46414f06ebef7dfe16aff" title="for Sys_var_double">double_value</a>;
<a name="l00836"></a>00836     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00837"></a>00837   }
<a name="l00838"></a>00838   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l00839"></a>00839   {
<a name="l00840"></a>00840     <span class="keywordflow">return</span> type != INT_RESULT &amp;&amp; type != REAL_RESULT &amp;&amp; type != DECIMAL_RESULT;
<a name="l00841"></a>00841   }
<a name="l00842"></a><a class="code" href="classSys__var__double.html#a11ba42d3f6f65a0bf3dcaf4e2d8d1d22">00842</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__double.html#a11ba42d3f6f65a0bf3dcaf4e2d8d1d22">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00843"></a>00843   { var-&gt;save_result.<a class="code" href="classset__var.html#af84f10f97ad46414f06ebef7dfe16aff" title="for Sys_var_double">double_value</a>= global_var(<span class="keywordtype">double</span>); }
<a name="l00844"></a><a class="code" href="classSys__var__double.html#a4c08f551e54b822ef9fccdc9b8c75517">00844</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__double.html#a4c08f551e54b822ef9fccdc9b8c75517">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00845"></a>00845   { var-&gt;save_result.<a class="code" href="classset__var.html#af84f10f97ad46414f06ebef7dfe16aff" title="for Sys_var_double">double_value</a>= getopt_ulonglong2double(<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value); }
<a name="l00846"></a>00846 };
<a name="l00847"></a>00847 
<a name="l00858"></a><a class="code" href="classSys__var__test__flag.html">00858</a> <span class="keyword">class </span><a class="code" href="classSys__var__test__flag.html">Sys_var_test_flag</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__mybool.html">Sys_var_mybool</a>
<a name="l00859"></a>00859 {
<a name="l00860"></a>00860 <span class="keyword">private</span>:
<a name="l00861"></a>00861   my_bool test_flag_value;
<a name="l00862"></a>00862   uint    test_flag_mask;
<a name="l00863"></a>00863 <span class="keyword">public</span>:
<a name="l00864"></a>00864   <a class="code" href="classSys__var__test__flag.html">Sys_var_test_flag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, uint mask)
<a name="l00865"></a>00865   : <a class="code" href="classSys__var__mybool.html">Sys_var_mybool</a>(name_arg, comment, READ_ONLY GLOBAL_VAR(test_flag_value),
<a name="l00866"></a>00866           NO_CMD_LINE, DEFAULT(FALSE))
<a name="l00867"></a>00867   {
<a name="l00868"></a>00868     test_flag_mask= mask;
<a name="l00869"></a>00869   }
<a name="l00870"></a>00870   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l00871"></a>00871   {
<a name="l00872"></a>00872     test_flag_value= ((test_flags &amp; test_flag_mask) &gt; 0);
<a name="l00873"></a>00873     <span class="keywordflow">return</span> (uchar*) &amp;test_flag_value;
<a name="l00874"></a>00874   }
<a name="l00875"></a>00875 };
<a name="l00876"></a>00876 
<a name="l00887"></a><a class="code" href="classSys__var__max__user__conn.html">00887</a> <span class="keyword">class </span><a class="code" href="classSys__var__max__user__conn.html">Sys_var_max_user_conn</a>: <span class="keyword">public</span> Sys_var_uint
<a name="l00888"></a>00888 {
<a name="l00889"></a>00889 <span class="keyword">public</span>:
<a name="l00890"></a>00890   <a class="code" href="classSys__var__max__user__conn.html">Sys_var_max_user_conn</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00891"></a>00891           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00892"></a>00892           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00893"></a>00893           uint min_val, uint max_val, uint def_val,
<a name="l00894"></a>00894           uint block_size, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00895"></a>00895           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00896"></a>00896           on_check_function on_check_func=0,
<a name="l00897"></a>00897           on_update_function on_update_func=0,
<a name="l00898"></a>00898           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l00899"></a>00899     : Sys_var_uint(name_arg, comment, SESSION, off, size, getopt,
<a name="l00900"></a>00900               min_val, max_val, def_val, block_size,
<a name="l00901"></a>00901               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l00902"></a>00902               substitute)
<a name="l00903"></a>00903   { }
<a name="l00904"></a><a class="code" href="classSys__var__max__user__conn.html#ae351b9ecdf9b6d966b8eead2ba6a2cc3">00904</a>   uchar *<a class="code" href="classSys__var__max__user__conn.html#ae351b9ecdf9b6d966b8eead2ba6a2cc3">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l00905"></a>00905   {
<a name="l00906"></a>00906     <span class="keyword">const</span> <a class="code" href="structuser__conn.html">USER_CONN</a> *uc= thd-&gt;get_user_connect();
<a name="l00907"></a>00907     <span class="keywordflow">if</span> (uc &amp;&amp; uc-&gt;user_resources.user_conn)
<a name="l00908"></a>00908       <span class="keywordflow">return</span> (uchar*) &amp;(uc-&gt;user_resources.user_conn);
<a name="l00909"></a>00909     <span class="keywordflow">return</span> global_value_ptr(thd, base);
<a name="l00910"></a>00910   }
<a name="l00911"></a>00911 };
<a name="l00912"></a>00912 
<a name="l00913"></a>00913 <span class="comment">// overflow-safe (1 &lt;&lt; X)-1</span>
<a name="l00914"></a>00914 <span class="preprocessor">#define MAX_SET(X) ((((1UL &lt;&lt; ((X)-1))-1) &lt;&lt; 1) | 1)</span>
<a name="l00915"></a>00915 <span class="preprocessor"></span>
<a name="l00930"></a><a class="code" href="classSys__var__flagset.html">00930</a> <span class="keyword">class </span><a class="code" href="classSys__var__flagset.html">Sys_var_flagset</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>
<a name="l00931"></a>00931 {
<a name="l00932"></a>00932 <span class="keyword">public</span>:
<a name="l00933"></a>00933   <a class="code" href="classSys__var__flagset.html">Sys_var_flagset</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l00934"></a>00934           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l00935"></a>00935           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l00936"></a>00936           <span class="keyword">const</span> <span class="keywordtype">char</span> *values[], ulonglong def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l00937"></a>00937           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l00938"></a>00938           on_check_function on_check_func=0,
<a name="l00939"></a>00939           on_update_function on_update_func=0,
<a name="l00940"></a>00940           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l00941"></a>00941     : <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>(name_arg, comment, flag_args, off, getopt,
<a name="l00942"></a>00942                       SHOW_CHAR, values, def_val, lock,
<a name="l00943"></a>00943                       binlog_status_arg, on_check_func, on_update_func,
<a name="l00944"></a>00944                       substitute)
<a name="l00945"></a>00945   {
<a name="l00946"></a>00946     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_FLAGSET;
<a name="l00947"></a>00947     global_var(ulonglong)= def_val;
<a name="l00948"></a>00948     DBUG_ASSERT(typelib.count &gt; 1);
<a name="l00949"></a>00949     DBUG_ASSERT(typelib.count &lt;= 65);
<a name="l00950"></a>00950     DBUG_ASSERT(def_val &lt; MAX_SET(typelib.count));
<a name="l00951"></a>00951     DBUG_ASSERT(strcmp(values[typelib.count-1], <span class="stringliteral">&quot;default&quot;</span>) == 0);
<a name="l00952"></a>00952     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(ulonglong));
<a name="l00953"></a>00953   }
<a name="l00954"></a>00954   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l00955"></a>00955   {
<a name="l00956"></a>00956     <span class="keywordtype">char</span> buff[STRING_BUFFER_USUAL_SIZE];
<a name="l00957"></a>00957     <a class="code" href="classString.html">String</a> str(buff, <span class="keyword">sizeof</span>(buff), system_charset_info), *res;
<a name="l00958"></a>00958     ulonglong default_value, current_value;
<a name="l00959"></a>00959     <span class="keywordflow">if</span> (var-&gt;type == OPT_GLOBAL)
<a name="l00960"></a>00960     {
<a name="l00961"></a>00961       default_value= <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value;
<a name="l00962"></a>00962       current_value= global_var(ulonglong);
<a name="l00963"></a>00963     }
<a name="l00964"></a>00964     <span class="keywordflow">else</span>
<a name="l00965"></a>00965     {
<a name="l00966"></a>00966       default_value= global_var(ulonglong);
<a name="l00967"></a>00967       current_value= session_var(thd, ulonglong);
<a name="l00968"></a>00968     }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;result_type() == STRING_RESULT)
<a name="l00971"></a>00971     {
<a name="l00972"></a>00972       <span class="keywordflow">if</span> (!(res=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str)))
<a name="l00973"></a>00973         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00974"></a>00974       <span class="keywordflow">else</span>
<a name="l00975"></a>00975       {
<a name="l00976"></a>00976         <span class="keywordtype">char</span> *error;
<a name="l00977"></a>00977         uint error_len;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979         var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>=
<a name="l00980"></a>00980               find_set_from_flags(&amp;typelib,
<a name="l00981"></a>00981                                   typelib.count,
<a name="l00982"></a>00982                                   current_value,
<a name="l00983"></a>00983                                   default_value,
<a name="l00984"></a>00984                                   res-&gt;ptr(), res-&gt;length(),
<a name="l00985"></a>00985                                   &amp;error, &amp;error_len);
<a name="l00986"></a>00986         <span class="keywordflow">if</span> (error)
<a name="l00987"></a>00987         {
<a name="l00988"></a>00988           <a class="code" href="classErrConvString.html">ErrConvString</a> err(error, error_len, res-&gt;charset());
<a name="l00989"></a>00989           my_error(ER_WRONG_VALUE_FOR_VAR, MYF(0), name.str, err.ptr());
<a name="l00990"></a>00990           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00991"></a>00991         }
<a name="l00992"></a>00992       }
<a name="l00993"></a>00993     }
<a name="l00994"></a>00994     <span class="keywordflow">else</span>
<a name="l00995"></a>00995     {
<a name="l00996"></a>00996       longlong tmp=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_int();
<a name="l00997"></a>00997       <span class="keywordflow">if</span> ((tmp &lt; 0 &amp;&amp; ! var-&gt;value-&gt;unsigned_flag)
<a name="l00998"></a>00998           || (ulonglong)tmp &gt; MAX_SET(typelib.count))
<a name="l00999"></a>00999         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01000"></a>01000       <span class="keywordflow">else</span>
<a name="l01001"></a>01001         var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= tmp;
<a name="l01002"></a>01002     }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01005"></a>01005   }
<a name="l01006"></a>01006   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01007"></a>01007   {
<a name="l01008"></a>01008     session_var(thd, ulonglong)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l01009"></a>01009     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01010"></a>01010   }
<a name="l01011"></a>01011   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01012"></a>01012   {
<a name="l01013"></a>01013     global_var(ulonglong)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l01014"></a>01014     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01015"></a>01015   }
<a name="l01016"></a><a class="code" href="classSys__var__flagset.html#aeaad3a960202b38720fe10cbc76cf6d6">01016</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__flagset.html#aeaad3a960202b38720fe10cbc76cf6d6">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01017"></a>01017   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= global_var(ulonglong); }
<a name="l01018"></a><a class="code" href="classSys__var__flagset.html#a4c691624d5e68bde8e46b18fa45eee42">01018</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__flagset.html#a4c691624d5e68bde8e46b18fa45eee42">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01019"></a>01019   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value; }
<a name="l01020"></a><a class="code" href="classSys__var__flagset.html#a08ec7944811f519c7885b8cedadc2b13">01020</a>   uchar *<a class="code" href="classSys__var__flagset.html#a08ec7944811f519c7885b8cedadc2b13">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01021"></a>01021   {
<a name="l01022"></a>01022     <span class="keywordflow">return</span> (uchar*)flagset_to_string(thd, 0, session_var(thd, ulonglong),
<a name="l01023"></a>01023                                      typelib.type_names);
<a name="l01024"></a>01024   }
<a name="l01025"></a>01025   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01026"></a>01026   {
<a name="l01027"></a>01027     <span class="keywordflow">return</span> (uchar*)flagset_to_string(thd, 0, global_var(ulonglong),
<a name="l01028"></a>01028                                      typelib.type_names);
<a name="l01029"></a>01029   }
<a name="l01030"></a>01030 };
<a name="l01031"></a>01031 
<a name="l01041"></a><a class="code" href="classSys__var__set.html">01041</a> <span class="keyword">class </span><a class="code" href="classSys__var__set.html">Sys_var_set</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>
<a name="l01042"></a>01042 {
<a name="l01043"></a>01043 <span class="keyword">public</span>:
<a name="l01044"></a>01044   <a class="code" href="classSys__var__set.html">Sys_var_set</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01045"></a>01045           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01046"></a>01046           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01047"></a>01047           <span class="keyword">const</span> <span class="keywordtype">char</span> *values[], ulonglong def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l01048"></a>01048           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01049"></a>01049           on_check_function on_check_func=0,
<a name="l01050"></a>01050           on_update_function on_update_func=0,
<a name="l01051"></a>01051           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l01052"></a>01052     : <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>(name_arg, comment, flag_args, off, getopt,
<a name="l01053"></a>01053                       SHOW_CHAR, values, def_val, lock,
<a name="l01054"></a>01054                       binlog_status_arg, on_check_func, on_update_func,
<a name="l01055"></a>01055                       substitute)
<a name="l01056"></a>01056   {
<a name="l01057"></a>01057     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_SET;
<a name="l01058"></a>01058     global_var(ulonglong)= def_val;
<a name="l01059"></a>01059     DBUG_ASSERT(typelib.count &gt; 0);
<a name="l01060"></a>01060     DBUG_ASSERT(typelib.count &lt;= 64);
<a name="l01061"></a>01061     DBUG_ASSERT(def_val &lt; MAX_SET(typelib.count));
<a name="l01062"></a>01062     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(ulonglong));
<a name="l01063"></a>01063   }
<a name="l01064"></a>01064   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01065"></a>01065   {
<a name="l01066"></a>01066     <span class="keywordtype">char</span> buff[STRING_BUFFER_USUAL_SIZE];
<a name="l01067"></a>01067     <a class="code" href="classString.html">String</a> str(buff, <span class="keyword">sizeof</span>(buff), system_charset_info), *res;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069     <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;result_type() == STRING_RESULT)
<a name="l01070"></a>01070     {
<a name="l01071"></a>01071       <span class="keywordflow">if</span> (!(res=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str)))
<a name="l01072"></a>01072         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01073"></a>01073       <span class="keywordflow">else</span>
<a name="l01074"></a>01074       {
<a name="l01075"></a>01075         <span class="keywordtype">char</span> *error;
<a name="l01076"></a>01076         uint error_len;
<a name="l01077"></a>01077         <span class="keywordtype">bool</span> not_used;
<a name="l01078"></a>01078 
<a name="l01079"></a>01079         var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>=
<a name="l01080"></a>01080               find_set(&amp;typelib, res-&gt;ptr(), res-&gt;length(), NULL,
<a name="l01081"></a>01081                       &amp;error, &amp;error_len, &amp;not_used);
<a name="l01082"></a>01082         <span class="comment">/*</span>
<a name="l01083"></a>01083 <span class="comment">          note, we only issue an error if error_len &gt; 0.</span>
<a name="l01084"></a>01084 <span class="comment">          That is even while empty (zero-length) values are considered</span>
<a name="l01085"></a>01085 <span class="comment">          errors by find_set(), these errors are ignored here</span>
<a name="l01086"></a>01086 <span class="comment">        */</span>
<a name="l01087"></a>01087         <span class="keywordflow">if</span> (error_len)
<a name="l01088"></a>01088         {
<a name="l01089"></a>01089           <a class="code" href="classErrConvString.html">ErrConvString</a> err(error, error_len, res-&gt;charset());
<a name="l01090"></a>01090           my_error(ER_WRONG_VALUE_FOR_VAR, MYF(0), name.str, err.ptr());
<a name="l01091"></a>01091           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01092"></a>01092         }
<a name="l01093"></a>01093       }
<a name="l01094"></a>01094     }
<a name="l01095"></a>01095     <span class="keywordflow">else</span>
<a name="l01096"></a>01096     {
<a name="l01097"></a>01097       longlong tmp=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_int();
<a name="l01098"></a>01098       <span class="keywordflow">if</span> ((tmp &lt; 0 &amp;&amp; ! var-&gt;value-&gt;unsigned_flag)
<a name="l01099"></a>01099           || (ulonglong)tmp &gt; MAX_SET(typelib.count))
<a name="l01100"></a>01100         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01101"></a>01101       <span class="keywordflow">else</span>
<a name="l01102"></a>01102         var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= tmp;
<a name="l01103"></a>01103     }
<a name="l01104"></a>01104 
<a name="l01105"></a>01105     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01106"></a>01106   }
<a name="l01107"></a>01107   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01108"></a>01108   {
<a name="l01109"></a>01109     session_var(thd, ulonglong)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l01110"></a>01110     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01111"></a>01111   }
<a name="l01112"></a>01112   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01113"></a>01113   {
<a name="l01114"></a>01114     global_var(ulonglong)= var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>;
<a name="l01115"></a>01115     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01116"></a>01116   }
<a name="l01117"></a><a class="code" href="classSys__var__set.html#a810f24aa8b5a4b114b1ad71fceaebbd1">01117</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__set.html#a810f24aa8b5a4b114b1ad71fceaebbd1">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01118"></a>01118   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= global_var(ulonglong); }
<a name="l01119"></a><a class="code" href="classSys__var__set.html#a4992f46b91be120dd3a574950870d1fb">01119</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__set.html#a4992f46b91be120dd3a574950870d1fb">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01120"></a>01120   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value; }
<a name="l01121"></a><a class="code" href="classSys__var__set.html#a9df6f1dbcce01eaea773aeab583e29f0">01121</a>   uchar *<a class="code" href="classSys__var__set.html#a9df6f1dbcce01eaea773aeab583e29f0">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01122"></a>01122   {
<a name="l01123"></a>01123     <span class="keywordflow">return</span> (uchar*)set_to_string(thd, 0, session_var(thd, ulonglong),
<a name="l01124"></a>01124                                  typelib.type_names);
<a name="l01125"></a>01125   }
<a name="l01126"></a>01126   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01127"></a>01127   {
<a name="l01128"></a>01128     <span class="keywordflow">return</span> (uchar*)set_to_string(thd, 0, global_var(ulonglong),
<a name="l01129"></a>01129                                  typelib.type_names);
<a name="l01130"></a>01130   }
<a name="l01131"></a>01131 };
<a name="l01132"></a>01132 
<a name="l01146"></a><a class="code" href="classSys__var__plugin.html">01146</a> <span class="keyword">class </span><a class="code" href="classSys__var__plugin.html">Sys_var_plugin</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148   <span class="keywordtype">int</span> plugin_type;
<a name="l01149"></a>01149 <span class="keyword">public</span>:
<a name="l01150"></a>01150   <a class="code" href="classSys__var__plugin.html">Sys_var_plugin</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01151"></a>01151           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01152"></a>01152           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01153"></a>01153           <span class="keywordtype">int</span> plugin_type_arg, <span class="keywordtype">char</span> **def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l01154"></a>01154           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01155"></a>01155           on_check_function on_check_func=0,
<a name="l01156"></a>01156           on_update_function on_update_func=0,
<a name="l01157"></a>01157           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l01158"></a>01158           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l01159"></a>01159     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l01160"></a>01160               getopt.arg_type, SHOW_CHAR, (intptr)def_val,
<a name="l01161"></a>01161               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l01162"></a>01162               substitute, parse_flag),
<a name="l01163"></a>01163     plugin_type(plugin_type_arg)
<a name="l01164"></a>01164   {
<a name="l01165"></a>01165     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_STR;
<a name="l01166"></a>01166     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(<a class="code" href="structst__plugin__int.html">plugin_ref</a>));
<a name="l01167"></a>01167     DBUG_ASSERT(getopt.id == -1); <span class="comment">// force NO_CMD_LINE</span>
<a name="l01168"></a>01168   }
<a name="l01169"></a>01169   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01170"></a>01170   {
<a name="l01171"></a>01171     <span class="keywordtype">char</span> buff[STRING_BUFFER_USUAL_SIZE];
<a name="l01172"></a>01172     <a class="code" href="classString.html">String</a> str(buff,<span class="keyword">sizeof</span>(buff), system_charset_info), *res;
<a name="l01173"></a>01173     <span class="keywordflow">if</span> (!(res=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str)))
<a name="l01174"></a>01174       var-&gt;save_result.<a class="code" href="classset__var.html#aed7461aa3c341175e4e5d53c837eaffb" title="for Sys_var_plugin">plugin</a>= NULL;
<a name="l01175"></a>01175     <span class="keywordflow">else</span>
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177       <span class="keyword">const</span> LEX_STRING pname= { <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(res-&gt;ptr()), res-&gt;length() };
<a name="l01178"></a>01178       <a class="code" href="structst__plugin__int.html">plugin_ref</a> plugin;
<a name="l01179"></a>01179 
<a name="l01180"></a>01180       <span class="comment">// special code for storage engines (e.g. to handle historical aliases)</span>
<a name="l01181"></a>01181       <span class="keywordflow">if</span> (plugin_type == MYSQL_STORAGE_ENGINE_PLUGIN)
<a name="l01182"></a>01182         plugin= <a class="code" href="handler_8cc.html#acd39f1826bca8434f79a47fda2af9f48" title="Return the storage engine handlerton for the supplied name.">ha_resolve_by_name</a>(thd, &amp;pname, FALSE);
<a name="l01183"></a>01183       <span class="keywordflow">else</span>
<a name="l01184"></a>01184         plugin= my_plugin_lock_by_name(thd, &amp;pname, plugin_type);
<a name="l01185"></a>01185       <span class="keywordflow">if</span> (!plugin)
<a name="l01186"></a>01186       {
<a name="l01187"></a>01187         <span class="comment">// historically different error code</span>
<a name="l01188"></a>01188         <span class="keywordflow">if</span> (plugin_type == MYSQL_STORAGE_ENGINE_PLUGIN)
<a name="l01189"></a>01189         {
<a name="l01190"></a>01190           <a class="code" href="classErrConvString.html">ErrConvString</a> err(res);
<a name="l01191"></a>01191           my_error(ER_UNKNOWN_STORAGE_ENGINE, MYF(0), err.ptr());
<a name="l01192"></a>01192         }
<a name="l01193"></a>01193         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01194"></a>01194       }
<a name="l01195"></a>01195       var-&gt;save_result.<a class="code" href="classset__var.html#aed7461aa3c341175e4e5d53c837eaffb" title="for Sys_var_plugin">plugin</a>= plugin;
<a name="l01196"></a>01196     }
<a name="l01197"></a>01197     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01198"></a>01198   }
<a name="l01199"></a>01199   <span class="keywordtype">void</span> do_update(<a class="code" href="structst__plugin__int.html">plugin_ref</a> *valptr, <a class="code" href="structst__plugin__int.html">plugin_ref</a> newval)
<a name="l01200"></a>01200   {
<a name="l01201"></a>01201     <a class="code" href="structst__plugin__int.html">plugin_ref</a> oldval= *valptr;
<a name="l01202"></a>01202     <span class="keywordflow">if</span> (oldval != newval)
<a name="l01203"></a>01203     {
<a name="l01204"></a>01204       *valptr= my_plugin_lock(NULL, &amp;newval);
<a name="l01205"></a>01205       plugin_unlock(NULL, oldval);
<a name="l01206"></a>01206     }
<a name="l01207"></a>01207   }
<a name="l01208"></a>01208   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01209"></a>01209   {
<a name="l01210"></a>01210     do_update((<a class="code" href="structst__plugin__int.html">plugin_ref</a>*)<a class="code" href="classsys__var.html#a82feda269f429be092a7f67b8150e94d">session_var_ptr</a>(thd),
<a name="l01211"></a>01211               var-&gt;save_result.<a class="code" href="classset__var.html#aed7461aa3c341175e4e5d53c837eaffb" title="for Sys_var_plugin">plugin</a>);
<a name="l01212"></a>01212     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01213"></a>01213   }
<a name="l01214"></a>01214   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01215"></a>01215   {
<a name="l01216"></a>01216     do_update((<a class="code" href="structst__plugin__int.html">plugin_ref</a>*)global_var_ptr(),
<a name="l01217"></a>01217               var-&gt;save_result.<a class="code" href="classset__var.html#aed7461aa3c341175e4e5d53c837eaffb" title="for Sys_var_plugin">plugin</a>);
<a name="l01218"></a>01218     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01219"></a>01219   }
<a name="l01220"></a><a class="code" href="classSys__var__plugin.html#af959987c1a741e2b421be3924efe8eb0">01220</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__plugin.html#af959987c1a741e2b421be3924efe8eb0">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01221"></a>01221   {
<a name="l01222"></a>01222     <a class="code" href="structst__plugin__int.html">plugin_ref</a> plugin= global_var(<a class="code" href="structst__plugin__int.html">plugin_ref</a>);
<a name="l01223"></a>01223     var-&gt;save_result.<a class="code" href="classset__var.html#aed7461aa3c341175e4e5d53c837eaffb" title="for Sys_var_plugin">plugin</a>= my_plugin_lock(thd, &amp;plugin);
<a name="l01224"></a>01224   }
<a name="l01225"></a><a class="code" href="classSys__var__plugin.html#a2fe5cff792b4ad3cb2dd62408e6e741d">01225</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__plugin.html#a2fe5cff792b4ad3cb2dd62408e6e741d">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01226"></a>01226   {
<a name="l01227"></a>01227     LEX_STRING pname;
<a name="l01228"></a>01228     <span class="keywordtype">char</span> **default_value= <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>**<span class="keyword">&gt;</span>(<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value);
<a name="l01229"></a>01229     pname.str= *default_value;
<a name="l01230"></a>01230     pname.length= strlen(pname.str);
<a name="l01231"></a>01231 
<a name="l01232"></a>01232     <a class="code" href="structst__plugin__int.html">plugin_ref</a> plugin;
<a name="l01233"></a>01233     <span class="keywordflow">if</span> (plugin_type == MYSQL_STORAGE_ENGINE_PLUGIN)
<a name="l01234"></a>01234       plugin= <a class="code" href="handler_8cc.html#acd39f1826bca8434f79a47fda2af9f48" title="Return the storage engine handlerton for the supplied name.">ha_resolve_by_name</a>(thd, &amp;pname, FALSE);
<a name="l01235"></a>01235     <span class="keywordflow">else</span>
<a name="l01236"></a>01236       plugin= my_plugin_lock_by_name(thd, &amp;pname, plugin_type);
<a name="l01237"></a>01237     DBUG_ASSERT(plugin);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239     var-&gt;save_result.<a class="code" href="classset__var.html#aed7461aa3c341175e4e5d53c837eaffb" title="for Sys_var_plugin">plugin</a>= my_plugin_lock(thd, &amp;plugin);
<a name="l01240"></a>01240   }
<a name="l01241"></a>01241   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l01242"></a>01242   { <span class="keywordflow">return</span> type != STRING_RESULT; }
<a name="l01243"></a><a class="code" href="classSys__var__plugin.html#a41fbfdc5a333458a5709164dd5afec7e">01243</a>   uchar *<a class="code" href="classSys__var__plugin.html#a41fbfdc5a333458a5709164dd5afec7e">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01244"></a>01244   {
<a name="l01245"></a>01245     <a class="code" href="structst__plugin__int.html">plugin_ref</a> plugin= session_var(thd, <a class="code" href="structst__plugin__int.html">plugin_ref</a>);
<a name="l01246"></a>01246     <span class="keywordflow">return</span> (uchar*)(plugin ? thd-&gt;strmake(plugin_name(plugin)-&gt;str,
<a name="l01247"></a>01247                                           plugin_name(plugin)-&gt;length) : 0);
<a name="l01248"></a>01248   }
<a name="l01249"></a>01249   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01250"></a>01250   {
<a name="l01251"></a>01251     <a class="code" href="structst__plugin__int.html">plugin_ref</a> plugin= global_var(<a class="code" href="structst__plugin__int.html">plugin_ref</a>);
<a name="l01252"></a>01252     <span class="keywordflow">return</span> (uchar*)(plugin ? thd-&gt;strmake(plugin_name(plugin)-&gt;str,
<a name="l01253"></a>01253                                           plugin_name(plugin)-&gt;length) : 0);
<a name="l01254"></a>01254   }
<a name="l01255"></a>01255 };
<a name="l01256"></a>01256 
<a name="l01257"></a>01257 <span class="preprocessor">#if defined(ENABLED_DEBUG_SYNC)</span>
<a name="l01258"></a>01258 <span class="preprocessor"></span>
<a name="l01261"></a>01261 <span class="keyword">class </span>Sys_var_debug_sync :<span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l01262"></a>01262 {
<a name="l01263"></a>01263 <span class="keyword">public</span>:
<a name="l01264"></a>01264   Sys_var_debug_sync(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01265"></a>01265                <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args,
<a name="l01266"></a>01266                <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01267"></a>01267                <span class="keyword">const</span> <span class="keywordtype">char</span> *def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l01268"></a>01268                <span class="keyword">enum</span> binlog_status_enum binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01269"></a>01269                on_check_function on_check_func=0,
<a name="l01270"></a>01270                on_update_function on_update_func=0,
<a name="l01271"></a>01271                <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l01272"></a>01272                <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l01273"></a>01273     : <a class="code" href="classsys__var.html">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, 0, getopt.id,
<a name="l01274"></a>01274               getopt.arg_type, SHOW_CHAR, (intptr)def_val,
<a name="l01275"></a>01275               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l01276"></a>01276               substitute, parse_flag)
<a name="l01277"></a>01277   {
<a name="l01278"></a>01278     DBUG_ASSERT(scope() == ONLY_SESSION);
<a name="l01279"></a>01279     option.var_type= GET_NO_ARG;
<a name="l01280"></a>01280   }
<a name="l01281"></a>01281   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01282"></a>01282   {
<a name="l01283"></a>01283     <span class="keywordtype">char</span> buff[STRING_BUFFER_USUAL_SIZE];
<a name="l01284"></a>01284     <a class="code" href="classString.html">String</a> str(buff, <span class="keyword">sizeof</span>(buff), system_charset_info), *res;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286     <span class="keywordflow">if</span> (!(res=var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str)))
<a name="l01287"></a>01287       var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l01288"></a>01288     <span class="keywordflow">else</span>
<a name="l01289"></a>01289       var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= thd-&gt;strmake(res-&gt;ptr(), res-&gt;length());
<a name="l01290"></a>01290     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01291"></a>01291   }
<a name="l01292"></a>01292   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01293"></a>01293   {
<a name="l01294"></a>01294     <span class="keyword">extern</span> <span class="keywordtype">bool</span> debug_sync_update(THD *thd, <span class="keywordtype">char</span> *val_str);
<a name="l01295"></a>01295     <span class="keywordflow">return</span> debug_sync_update(thd, var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str);
<a name="l01296"></a>01296   }
<a name="l01297"></a>01297   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01298"></a>01298   {
<a name="l01299"></a>01299     DBUG_ASSERT(FALSE);
<a name="l01300"></a>01300     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01301"></a>01301   }
<a name="l01302"></a>01302   <span class="keywordtype">void</span> session_save_default(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01303"></a>01303   {
<a name="l01304"></a>01304     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l01305"></a>01305     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length= 0;
<a name="l01306"></a>01306   }
<a name="l01307"></a>01307   <span class="keywordtype">void</span> global_save_default(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01308"></a>01308   {
<a name="l01309"></a>01309     DBUG_ASSERT(FALSE);
<a name="l01310"></a>01310   }
<a name="l01311"></a>01311   uchar *<a class="code" href="classsys__var.html#a99882f8f4d80165aa37eac6ef661d43c">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01312"></a>01312   {
<a name="l01313"></a>01313     <span class="keyword">extern</span> uchar *debug_sync_value_ptr(THD *thd);
<a name="l01314"></a>01314     <span class="keywordflow">return</span> debug_sync_value_ptr(thd);
<a name="l01315"></a>01315   }
<a name="l01316"></a>01316   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01317"></a>01317   {
<a name="l01318"></a>01318     DBUG_ASSERT(FALSE);
<a name="l01319"></a>01319     <span class="keywordflow">return</span> 0;
<a name="l01320"></a>01320   }
<a name="l01321"></a>01321   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l01322"></a>01322   { <span class="keywordflow">return</span> type != STRING_RESULT; }
<a name="l01323"></a>01323 };
<a name="l01324"></a>01324 <span class="preprocessor">#endif </span><span class="comment">/* defined(ENABLED_DEBUG_SYNC) */</span>
<a name="l01325"></a>01325 
<a name="l01345"></a><a class="code" href="classSys__var__bit.html">01345</a> <span class="keyword">class </span><a class="code" href="classSys__var__bit.html">Sys_var_bit</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>
<a name="l01346"></a>01346 {
<a name="l01347"></a>01347   ulonglong bitmask;
<a name="l01348"></a>01348   <span class="keywordtype">bool</span> reverse_semantics;
<a name="l01349"></a>01349   <span class="keywordtype">void</span> <span class="keyword">set</span>(uchar *ptr, ulonglong value)
<a name="l01350"></a>01350   {
<a name="l01351"></a>01351     <span class="keywordflow">if</span> ((value != 0) ^ reverse_semantics)
<a name="l01352"></a>01352       (*(ulonglong *)ptr)|= bitmask;
<a name="l01353"></a>01353     <span class="keywordflow">else</span>
<a name="l01354"></a>01354       (*(ulonglong *)ptr)&amp;= ~bitmask;
<a name="l01355"></a>01355   }
<a name="l01356"></a>01356 <span class="keyword">public</span>:
<a name="l01357"></a>01357   <a class="code" href="classSys__var__bit.html">Sys_var_bit</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01358"></a>01358           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01359"></a>01359           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01360"></a>01360           ulonglong bitmask_arg, my_bool def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l01361"></a>01361           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01362"></a>01362           on_check_function on_check_func=0,
<a name="l01363"></a>01363           on_update_function on_update_func=0,
<a name="l01364"></a>01364           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l01365"></a>01365     : <a class="code" href="classSys__var__typelib.html">Sys_var_typelib</a>(name_arg, comment, flag_args, off, getopt,
<a name="l01366"></a>01366                       SHOW_MY_BOOL, bool_values, def_val, lock,
<a name="l01367"></a>01367                       binlog_status_arg, on_check_func, on_update_func,
<a name="l01368"></a>01368                       substitute)
<a name="l01369"></a>01369   {
<a name="l01370"></a>01370     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_BOOL;
<a name="l01371"></a>01371     reverse_semantics= my_count_bits(bitmask_arg) &gt; 1;
<a name="l01372"></a>01372     bitmask= reverse_semantics ? ~bitmask_arg : bitmask_arg;
<a name="l01373"></a>01373     <span class="keyword">set</span>(global_var_ptr(), def_val);
<a name="l01374"></a>01374     DBUG_ASSERT(def_val &lt; 2);
<a name="l01375"></a>01375     DBUG_ASSERT(getopt.id == -1); <span class="comment">// force NO_CMD_LINE</span>
<a name="l01376"></a>01376     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(ulonglong));
<a name="l01377"></a>01377   }
<a name="l01378"></a>01378   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01379"></a>01379   {
<a name="l01380"></a>01380     <span class="keyword">set</span>(<a class="code" href="classsys__var.html#a82feda269f429be092a7f67b8150e94d">session_var_ptr</a>(thd), var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>);
<a name="l01381"></a>01381     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01382"></a>01382   }
<a name="l01383"></a>01383   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01384"></a>01384   {
<a name="l01385"></a>01385     <span class="keyword">set</span>(global_var_ptr(), var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>);
<a name="l01386"></a>01386     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01387"></a>01387   }
<a name="l01388"></a><a class="code" href="classSys__var__bit.html#a9611a980dc87e18859904f481f51a164">01388</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__bit.html#a9611a980dc87e18859904f481f51a164">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01389"></a>01389   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= global_var(ulonglong) &amp; bitmask; }
<a name="l01390"></a><a class="code" href="classSys__var__bit.html#a44c80cb8e9522287ac4788dfc65ad5c0">01390</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__bit.html#a44c80cb8e9522287ac4788dfc65ad5c0">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01391"></a>01391   { var-&gt;save_result.<a class="code" href="classset__var.html#a17e98a0d6265ac6fb52bfa48f656947e" title="for all integer, set, enum sysvars">ulonglong_value</a>= <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value; }
<a name="l01392"></a><a class="code" href="classSys__var__bit.html#ad0ff4a72ad783af11d53e618b9cfef5a">01392</a>   uchar *<a class="code" href="classSys__var__bit.html#ad0ff4a72ad783af11d53e618b9cfef5a">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01393"></a>01393   {
<a name="l01394"></a>01394     thd-&gt;sys_var_tmp.my_bool_value= reverse_semantics ^
<a name="l01395"></a>01395       ((session_var(thd, ulonglong) &amp; bitmask) != 0);
<a name="l01396"></a>01396     <span class="keywordflow">return</span> (uchar*) &amp;thd-&gt;sys_var_tmp.my_bool_value;
<a name="l01397"></a>01397   }
<a name="l01398"></a>01398   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01399"></a>01399   {
<a name="l01400"></a>01400     thd-&gt;sys_var_tmp.my_bool_value= reverse_semantics ^
<a name="l01401"></a>01401       ((global_var(ulonglong) &amp; bitmask) != 0);
<a name="l01402"></a>01402     <span class="keywordflow">return</span> (uchar*) &amp;thd-&gt;sys_var_tmp.my_bool_value;
<a name="l01403"></a>01403   }
<a name="l01404"></a>01404 };
<a name="l01405"></a>01405 
<a name="l01421"></a><a class="code" href="classSys__var__session__special.html">01421</a> <span class="keyword">class </span><a class="code" href="classSys__var__session__special.html">Sys_var_session_special</a>: <span class="keyword">public</span> Sys_var_ulonglong
<a name="l01422"></a>01422 {
<a name="l01423"></a>01423   <span class="keyword">typedef</span> bool (*session_special_update_function)(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var);
<a name="l01424"></a>01424   <span class="keyword">typedef</span> ulonglong (*session_special_read_function)(THD *thd);
<a name="l01425"></a>01425 
<a name="l01426"></a>01426   session_special_read_function read_func;
<a name="l01427"></a>01427   session_special_update_function update_func;
<a name="l01428"></a>01428 <span class="keyword">public</span>:
<a name="l01429"></a>01429   <a class="code" href="classSys__var__session__special.html">Sys_var_session_special</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01430"></a>01430                <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args,
<a name="l01431"></a>01431                <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01432"></a>01432                ulonglong min_val, ulonglong max_val, ulonglong block_size,
<a name="l01433"></a>01433                <a class="code" href="classPolyLock.html">PolyLock</a> *lock, <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg,
<a name="l01434"></a>01434                on_check_function on_check_func,
<a name="l01435"></a>01435                session_special_update_function update_func_arg,
<a name="l01436"></a>01436                session_special_read_function read_func_arg,
<a name="l01437"></a>01437                <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l01438"></a>01438     : Sys_var_ulonglong(name_arg, comment, flag_args, 0,
<a name="l01439"></a>01439               <span class="keyword">sizeof</span>(ulonglong), getopt, min_val,
<a name="l01440"></a>01440               max_val, 0, block_size, lock, binlog_status_arg, on_check_func, 0,
<a name="l01441"></a>01441               substitute),
<a name="l01442"></a>01442       read_func(read_func_arg), update_func(update_func_arg)
<a name="l01443"></a>01443   {
<a name="l01444"></a>01444     DBUG_ASSERT(scope() == ONLY_SESSION);
<a name="l01445"></a>01445     DBUG_ASSERT(getopt.id == -1); <span class="comment">// NO_CMD_LINE, because the offset is fake</span>
<a name="l01446"></a>01446   }
<a name="l01447"></a>01447   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01448"></a>01448   { <span class="keywordflow">return</span> update_func(thd, var); }
<a name="l01449"></a>01449   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01450"></a>01450   {
<a name="l01451"></a>01451     DBUG_ASSERT(FALSE);
<a name="l01452"></a>01452     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01453"></a>01453   }
<a name="l01454"></a><a class="code" href="classSys__var__session__special.html#a1a685de0cd05c6161889034e899178b2">01454</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__session__special.html#a1a685de0cd05c6161889034e899178b2">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01455"></a>01455   { var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>= 0; }
<a name="l01456"></a><a class="code" href="classSys__var__session__special.html#aae482b58f68b85585c41527fcb71c7d9">01456</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__session__special.html#aae482b58f68b85585c41527fcb71c7d9">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01457"></a>01457   { DBUG_ASSERT(FALSE); }
<a name="l01458"></a><a class="code" href="classSys__var__session__special.html#a67fceb104c6f2e630e579a8c1e8ef9ea">01458</a>   uchar *<a class="code" href="classSys__var__session__special.html#a67fceb104c6f2e630e579a8c1e8ef9ea">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01459"></a>01459   {
<a name="l01460"></a>01460     thd-&gt;sys_var_tmp.ulonglong_value= read_func(thd);
<a name="l01461"></a>01461     <span class="keywordflow">return</span> (uchar*) &amp;thd-&gt;sys_var_tmp.ulonglong_value;
<a name="l01462"></a>01462   }
<a name="l01463"></a>01463   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01464"></a>01464   {
<a name="l01465"></a>01465     DBUG_ASSERT(FALSE);
<a name="l01466"></a>01466     <span class="keywordflow">return</span> 0;
<a name="l01467"></a>01467   }
<a name="l01468"></a>01468 };
<a name="l01469"></a>01469 
<a name="l01470"></a>01470 
<a name="l01474"></a><a class="code" href="classSys__var__session__special__double.html">01474</a> <span class="keyword">class </span><a class="code" href="classSys__var__session__special__double.html">Sys_var_session_special_double</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__double.html">Sys_var_double</a>
<a name="l01475"></a>01475 {
<a name="l01476"></a>01476   <span class="keyword">typedef</span> bool (*session_special_update_function)(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var);
<a name="l01477"></a>01477   <span class="keyword">typedef</span> double (*session_special_read_double_function)(THD *thd);
<a name="l01478"></a>01478 
<a name="l01479"></a>01479   session_special_read_double_function read_func;
<a name="l01480"></a>01480   session_special_update_function update_func;
<a name="l01481"></a>01481 <span class="keyword">public</span>:
<a name="l01482"></a>01482   <a class="code" href="classSys__var__session__special__double.html">Sys_var_session_special_double</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01483"></a>01483                <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args,
<a name="l01484"></a>01484                <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01485"></a>01485                ulonglong min_val, ulonglong max_val, ulonglong block_size,
<a name="l01486"></a>01486                <a class="code" href="classPolyLock.html">PolyLock</a> *lock, <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg,
<a name="l01487"></a>01487                on_check_function on_check_func,
<a name="l01488"></a>01488                session_special_update_function update_func_arg,
<a name="l01489"></a>01489                session_special_read_double_function read_func_arg,
<a name="l01490"></a>01490                <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0)
<a name="l01491"></a>01491     : <a class="code" href="classSys__var__double.html">Sys_var_double</a>(name_arg, comment, flag_args, 0,
<a name="l01492"></a>01492               <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), getopt,
<a name="l01493"></a>01493               min_val, max_val, 0,
<a name="l01494"></a>01494               lock, binlog_status_arg, on_check_func, 0,
<a name="l01495"></a>01495               substitute),
<a name="l01496"></a>01496       read_func(read_func_arg), update_func(update_func_arg)
<a name="l01497"></a>01497   {
<a name="l01498"></a>01498     DBUG_ASSERT(scope() == ONLY_SESSION);
<a name="l01499"></a>01499     DBUG_ASSERT(getopt.id == -1); <span class="comment">// NO_CMD_LINE, because the offset is fake</span>
<a name="l01500"></a>01500   }
<a name="l01501"></a>01501   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01502"></a>01502   { <span class="keywordflow">return</span> update_func(thd, var); }
<a name="l01503"></a>01503   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01504"></a>01504   {
<a name="l01505"></a>01505     DBUG_ASSERT(FALSE);
<a name="l01506"></a>01506     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01507"></a>01507   }
<a name="l01508"></a><a class="code" href="classSys__var__session__special__double.html#ae1b1d7ae1d78d24bf79e90477f6ee703">01508</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__session__special__double.html#ae1b1d7ae1d78d24bf79e90477f6ee703">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01509"></a>01509   { var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>= 0; }
<a name="l01510"></a><a class="code" href="classSys__var__session__special__double.html#a51caca194ef88ed7c473afa332c43b1a">01510</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__session__special__double.html#a51caca194ef88ed7c473afa332c43b1a">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01511"></a>01511   { DBUG_ASSERT(FALSE); }
<a name="l01512"></a><a class="code" href="classSys__var__session__special__double.html#a3b65eba7b2b09ee13fce23a62f371b4b">01512</a>   uchar *<a class="code" href="classSys__var__session__special__double.html#a3b65eba7b2b09ee13fce23a62f371b4b">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01513"></a>01513   {
<a name="l01514"></a>01514     thd-&gt;sys_var_tmp.double_value= read_func(thd);
<a name="l01515"></a>01515     <span class="keywordflow">return</span> (uchar *) &amp;thd-&gt;sys_var_tmp.double_value;
<a name="l01516"></a>01516   }
<a name="l01517"></a>01517   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01518"></a>01518   {
<a name="l01519"></a>01519     DBUG_ASSERT(FALSE);
<a name="l01520"></a>01520     <span class="keywordflow">return</span> 0;
<a name="l01521"></a>01521   }
<a name="l01522"></a>01522 };
<a name="l01523"></a>01523 
<a name="l01524"></a>01524 
<a name="l01535"></a><a class="code" href="classSys__var__have.html">01535</a> <span class="keyword">class </span><a class="code" href="classSys__var__have.html">Sys_var_have</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l01536"></a>01536 {
<a name="l01537"></a>01537 <span class="keyword">public</span>:
<a name="l01538"></a>01538   <a class="code" href="classSys__var__have.html">Sys_var_have</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01539"></a>01539                <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01540"></a>01540                <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01541"></a>01541                <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l01542"></a>01542                <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01543"></a>01543                on_check_function on_check_func=0,
<a name="l01544"></a>01544                on_update_function on_update_func=0,
<a name="l01545"></a>01545                <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l01546"></a>01546                <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l01547"></a>01547     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l01548"></a>01548               getopt.arg_type, SHOW_CHAR, 0,
<a name="l01549"></a>01549               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l01550"></a>01550               substitute, parse_flag)
<a name="l01551"></a>01551   {
<a name="l01552"></a>01552     DBUG_ASSERT(scope() == GLOBAL);
<a name="l01553"></a>01553     DBUG_ASSERT(getopt.id == -1);
<a name="l01554"></a>01554     DBUG_ASSERT(lock == 0);
<a name="l01555"></a>01555     DBUG_ASSERT(binlog_status_arg == VARIABLE_NOT_IN_BINLOG);
<a name="l01556"></a>01556     DBUG_ASSERT(is_readonly());
<a name="l01557"></a>01557     DBUG_ASSERT(on_update == 0);
<a name="l01558"></a>01558     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(<span class="keyword">enum</span> SHOW_COMP_OPTION));
<a name="l01559"></a>01559   }
<a name="l01560"></a>01560   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var) {
<a name="l01561"></a>01561     DBUG_ASSERT(FALSE);
<a name="l01562"></a>01562     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01563"></a>01563   }
<a name="l01564"></a>01564   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01565"></a>01565   {
<a name="l01566"></a>01566     DBUG_ASSERT(FALSE);
<a name="l01567"></a>01567     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01568"></a>01568   }
<a name="l01569"></a>01569   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01570"></a>01570   {
<a name="l01571"></a>01571     DBUG_ASSERT(FALSE);
<a name="l01572"></a>01572     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01573"></a>01573   }
<a name="l01574"></a><a class="code" href="classSys__var__have.html#a9440d30a06f06a6b5dd8ca3aa436ce94">01574</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__have.html#a9440d30a06f06a6b5dd8ca3aa436ce94">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var) { }
<a name="l01575"></a><a class="code" href="classSys__var__have.html#aeaccee0596984bf2f934b7b57a8e2bd1">01575</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__have.html#aeaccee0596984bf2f934b7b57a8e2bd1">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var) { }
<a name="l01576"></a><a class="code" href="classSys__var__have.html#ab5900c6a7b84e5f731998c84a904f616">01576</a>   uchar *<a class="code" href="classSys__var__have.html#ab5900c6a7b84e5f731998c84a904f616">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01577"></a>01577   {
<a name="l01578"></a>01578     DBUG_ASSERT(FALSE);
<a name="l01579"></a>01579     <span class="keywordflow">return</span> 0;
<a name="l01580"></a>01580   }
<a name="l01581"></a>01581   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01582"></a>01582   {
<a name="l01583"></a>01583     <span class="keywordflow">return</span> (uchar*)show_comp_option_name[global_var(<span class="keyword">enum</span> SHOW_COMP_OPTION)];
<a name="l01584"></a>01584   }
<a name="l01585"></a>01585   <span class="keywordtype">bool</span> check_update_type(Item_result type) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l01586"></a>01586 };
<a name="l01587"></a>01587 
<a name="l01603"></a><a class="code" href="classSys__var__struct.html">01603</a> <span class="keyword">class </span><a class="code" href="classSys__var__struct.html">Sys_var_struct</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l01604"></a>01604 {
<a name="l01605"></a>01605   ptrdiff_t name_offset; <span class="comment">// offset to the &#39;name&#39; property in the structure</span>
<a name="l01606"></a>01606 <span class="keyword">public</span>:
<a name="l01607"></a>01607   <a class="code" href="classSys__var__struct.html">Sys_var_struct</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01608"></a>01608           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01609"></a>01609           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01610"></a>01610           ptrdiff_t name_off, <span class="keywordtype">void</span> *def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l01611"></a>01611           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01612"></a>01612           on_check_function on_check_func=0,
<a name="l01613"></a>01613           on_update_function on_update_func=0,
<a name="l01614"></a>01614           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l01615"></a>01615           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l01616"></a>01616     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l01617"></a>01617               getopt.arg_type, SHOW_CHAR, (intptr)def_val,
<a name="l01618"></a>01618               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l01619"></a>01619               substitute, parse_flag),
<a name="l01620"></a>01620       name_offset(name_off)
<a name="l01621"></a>01621   {
<a name="l01622"></a>01622     <a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.var_type= GET_STR;
<a name="l01623"></a>01623     <span class="comment">/*</span>
<a name="l01624"></a>01624 <span class="comment">      struct variables are special on the command line - often (e.g. for</span>
<a name="l01625"></a>01625 <span class="comment">      charsets) the name cannot be immediately resolved, but only after all</span>
<a name="l01626"></a>01626 <span class="comment">      options (in particular, basedir) are parsed.</span>
<a name="l01627"></a>01627 <span class="comment"></span>
<a name="l01628"></a>01628 <span class="comment">      thus all struct command-line options should be added manually</span>
<a name="l01629"></a>01629 <span class="comment">      to my_long_options in mysqld.cc</span>
<a name="l01630"></a>01630 <span class="comment">    */</span>
<a name="l01631"></a>01631     DBUG_ASSERT(getopt.id == -1);
<a name="l01632"></a>01632     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));
<a name="l01633"></a>01633   }
<a name="l01634"></a>01634   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01635"></a>01635   { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l01636"></a>01636   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01637"></a>01637   {
<a name="l01638"></a>01638     session_var(thd, <span class="keyword">const</span> <span class="keywordtype">void</span>*)= var-&gt;save_result.<a class="code" href="classset__var.html#af62fe29177dec7226a820559e3ca2fd4" title="for Sys_var_struct">ptr</a>;
<a name="l01639"></a>01639     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01640"></a>01640   }
<a name="l01641"></a>01641   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01642"></a>01642   {
<a name="l01643"></a>01643     global_var(<span class="keyword">const</span> <span class="keywordtype">void</span>*)= var-&gt;save_result.<a class="code" href="classset__var.html#af62fe29177dec7226a820559e3ca2fd4" title="for Sys_var_struct">ptr</a>;
<a name="l01644"></a>01644     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01645"></a>01645   }
<a name="l01646"></a><a class="code" href="classSys__var__struct.html#a60a7f923174571ad48a593694267b7c7">01646</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__struct.html#a60a7f923174571ad48a593694267b7c7">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01647"></a>01647   { var-&gt;save_result.<a class="code" href="classset__var.html#af62fe29177dec7226a820559e3ca2fd4" title="for Sys_var_struct">ptr</a>= global_var(<span class="keywordtype">void</span>*); }
<a name="l01648"></a><a class="code" href="classSys__var__struct.html#a38f274d135a2d5f17fbec6237149a5fe">01648</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__struct.html#a38f274d135a2d5f17fbec6237149a5fe">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01649"></a>01649   {
<a name="l01650"></a>01650     <span class="keywordtype">void</span> **default_value= <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>**<span class="keyword">&gt;</span>(<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value);
<a name="l01651"></a>01651     var-&gt;save_result.<a class="code" href="classset__var.html#af62fe29177dec7226a820559e3ca2fd4" title="for Sys_var_struct">ptr</a>= *default_value;
<a name="l01652"></a>01652   }
<a name="l01653"></a>01653   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l01654"></a>01654   { <span class="keywordflow">return</span> type != INT_RESULT &amp;&amp; type != STRING_RESULT; }
<a name="l01655"></a><a class="code" href="classSys__var__struct.html#a4f3b906289d55f47130ceb1d0c20b58b">01655</a>   uchar *<a class="code" href="classSys__var__struct.html#a4f3b906289d55f47130ceb1d0c20b58b">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01656"></a>01656   {
<a name="l01657"></a>01657     uchar *ptr= session_var(thd, uchar*);
<a name="l01658"></a>01658     <span class="keywordflow">return</span> ptr ? *(uchar**)(ptr+name_offset) : 0;
<a name="l01659"></a>01659   }
<a name="l01660"></a>01660   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01661"></a>01661   {
<a name="l01662"></a>01662     uchar *ptr= global_var(uchar*);
<a name="l01663"></a>01663     <span class="keywordflow">return</span> ptr ? *(uchar**)(ptr+name_offset) : 0;
<a name="l01664"></a>01664   }
<a name="l01665"></a>01665 };
<a name="l01666"></a>01666 
<a name="l01677"></a><a class="code" href="classSys__var__tz.html">01677</a> <span class="keyword">class </span><a class="code" href="classSys__var__tz.html">Sys_var_tz</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l01678"></a>01678 {
<a name="l01679"></a>01679 <span class="keyword">public</span>:
<a name="l01680"></a>01680   <a class="code" href="classSys__var__tz.html">Sys_var_tz</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01681"></a>01681              <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01682"></a>01682              <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01683"></a>01683              <a class="code" href="classTime__zone.html">Time_zone</a> **def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock=0,
<a name="l01684"></a>01684              <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01685"></a>01685              on_check_function on_check_func=0,
<a name="l01686"></a>01686              on_update_function on_update_func=0,
<a name="l01687"></a>01687              <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l01688"></a>01688              <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l01689"></a>01689     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l01690"></a>01690               getopt.arg_type, SHOW_CHAR, (intptr)def_val,
<a name="l01691"></a>01691               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l01692"></a>01692               substitute, parse_flag)
<a name="l01693"></a>01693   {
<a name="l01694"></a>01694     DBUG_ASSERT(getopt.id == -1);
<a name="l01695"></a>01695     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(<a class="code" href="classTime__zone.html">Time_zone</a> *));
<a name="l01696"></a>01696   }
<a name="l01697"></a>01697   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01698"></a>01698   {
<a name="l01699"></a>01699     <span class="keywordtype">char</span> buff[<a class="code" href="sql__const_8h.html#ab30ba4bdc434ebd6c7af89ca2a05a193">MAX_TIME_ZONE_NAME_LENGTH</a>];
<a name="l01700"></a>01700     <a class="code" href="classString.html">String</a> str(buff, <span class="keyword">sizeof</span>(buff), &amp;my_charset_latin1);
<a name="l01701"></a>01701     <a class="code" href="classString.html">String</a> *res= var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str);
<a name="l01702"></a>01702 
<a name="l01703"></a>01703     <span class="keywordflow">if</span> (!res)
<a name="l01704"></a>01704       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01705"></a>01705 
<a name="l01706"></a>01706     <span class="keywordflow">if</span> (!(var-&gt;save_result.<a class="code" href="classset__var.html#a94fd170b341a605b9486b650f85d95b5" title="for Sys_var_tz">time_zone</a>= my_tz_find(thd, res)))
<a name="l01707"></a>01707     {
<a name="l01708"></a>01708       <a class="code" href="classErrConvString.html">ErrConvString</a> err(res);
<a name="l01709"></a>01709       my_error(ER_UNKNOWN_TIME_ZONE, MYF(0), err.ptr());
<a name="l01710"></a>01710       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01711"></a>01711     }
<a name="l01712"></a>01712     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01713"></a>01713   }
<a name="l01714"></a>01714   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01715"></a>01715   {
<a name="l01716"></a>01716     session_var(thd, <a class="code" href="classTime__zone.html">Time_zone</a>*)= var-&gt;save_result.<a class="code" href="classset__var.html#a94fd170b341a605b9486b650f85d95b5" title="for Sys_var_tz">time_zone</a>;
<a name="l01717"></a>01717     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01718"></a>01718   }
<a name="l01719"></a>01719   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01720"></a>01720   {
<a name="l01721"></a>01721     global_var(<a class="code" href="classTime__zone.html">Time_zone</a>*)= var-&gt;save_result.<a class="code" href="classset__var.html#a94fd170b341a605b9486b650f85d95b5" title="for Sys_var_tz">time_zone</a>;
<a name="l01722"></a>01722     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01723"></a>01723   }
<a name="l01724"></a><a class="code" href="classSys__var__tz.html#a8cbe07b66a7cd2098251817f06cb465c">01724</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__tz.html#a8cbe07b66a7cd2098251817f06cb465c">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01725"></a>01725   {
<a name="l01726"></a>01726     var-&gt;save_result.<a class="code" href="classset__var.html#a94fd170b341a605b9486b650f85d95b5" title="for Sys_var_tz">time_zone</a>= global_var(<a class="code" href="classTime__zone.html">Time_zone</a>*);
<a name="l01727"></a>01727   }
<a name="l01728"></a><a class="code" href="classSys__var__tz.html#ac1b0b8a24189b13a4b5d3798ac8aed1a">01728</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__tz.html#ac1b0b8a24189b13a4b5d3798ac8aed1a">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01729"></a>01729   {
<a name="l01730"></a>01730     var-&gt;save_result.<a class="code" href="classset__var.html#a94fd170b341a605b9486b650f85d95b5" title="for Sys_var_tz">time_zone</a>=
<a name="l01731"></a>01731       *(<a class="code" href="classTime__zone.html">Time_zone</a>**)(intptr)<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value;
<a name="l01732"></a>01732   }
<a name="l01733"></a><a class="code" href="classSys__var__tz.html#af2cf83ddd80f3d6b62b4d9484817e057">01733</a>   uchar *<a class="code" href="classSys__var__tz.html#af2cf83ddd80f3d6b62b4d9484817e057">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01734"></a>01734   {
<a name="l01735"></a>01735     <span class="comment">/*</span>
<a name="l01736"></a>01736 <span class="comment">      This is an ugly fix for replication: we don&#39;t replicate properly queries</span>
<a name="l01737"></a>01737 <span class="comment">      invoking system variables&#39; values to update tables; but</span>
<a name="l01738"></a>01738 <span class="comment">      CONVERT_TZ(,,@@session.time_zone) is so popular that we make it</span>
<a name="l01739"></a>01739 <span class="comment">      replicable (i.e. we tell the binlog code to store the session</span>
<a name="l01740"></a>01740 <span class="comment">      timezone). If it&#39;s the global value which was used we can&#39;t replicate</span>
<a name="l01741"></a>01741 <span class="comment">      (binlog code stores session value only).</span>
<a name="l01742"></a>01742 <span class="comment">    */</span>
<a name="l01743"></a>01743     thd-&gt;time_zone_used= 1;
<a name="l01744"></a>01744     <span class="keywordflow">return</span> (uchar *)(session_var(thd, <a class="code" href="classTime__zone.html">Time_zone</a>*)-&gt;get_name()-&gt;ptr());
<a name="l01745"></a>01745   }
<a name="l01746"></a>01746   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01747"></a>01747   {
<a name="l01748"></a>01748     <span class="keywordflow">return</span> (uchar *)(global_var(<a class="code" href="classTime__zone.html">Time_zone</a>*)-&gt;get_name()-&gt;ptr());
<a name="l01749"></a>01749   }
<a name="l01750"></a>01750   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l01751"></a>01751   { <span class="keywordflow">return</span> type != STRING_RESULT; }
<a name="l01752"></a>01752 };
<a name="l01753"></a>01753 
<a name="l01754"></a>01754 
<a name="l01755"></a><a class="code" href="classSys__var__tx__isolation.html">01755</a> <span class="keyword">class </span><a class="code" href="classSys__var__tx__isolation.html">Sys_var_tx_isolation</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__enum.html">Sys_var_enum</a>
<a name="l01756"></a>01756 {
<a name="l01757"></a>01757 <span class="keyword">public</span>:
<a name="l01758"></a>01758   <a class="code" href="classSys__var__tx__isolation.html">Sys_var_tx_isolation</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01759"></a>01759           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01760"></a>01760           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01761"></a>01761           <span class="keyword">const</span> <span class="keywordtype">char</span> *values[], uint def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock,
<a name="l01762"></a>01762           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg,
<a name="l01763"></a>01763           on_check_function on_check_func)
<a name="l01764"></a>01764     :<a class="code" href="classSys__var__enum.html">Sys_var_enum</a>(name_arg, comment, flag_args, off, size, getopt,
<a name="l01765"></a>01765                   values, def_val, lock, binlog_status_arg, on_check_func)
<a name="l01766"></a>01766   {}
<a name="l01767"></a>01767   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var);
<a name="l01768"></a>01768 };
<a name="l01769"></a>01769 
<a name="l01770"></a>01770 
<a name="l01780"></a><a class="code" href="classSys__var__tx__read__only.html">01780</a> <span class="keyword">class </span><a class="code" href="classSys__var__tx__read__only.html">Sys_var_tx_read_only</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__mybool.html">Sys_var_mybool</a>
<a name="l01781"></a>01781 {
<a name="l01782"></a>01782 <span class="keyword">public</span>:
<a name="l01783"></a>01783   <a class="code" href="classSys__var__tx__read__only.html">Sys_var_tx_read_only</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args,
<a name="l01784"></a>01784                        ptrdiff_t off, <span class="keywordtype">size_t</span> size, <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01785"></a>01785                        my_bool def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock,
<a name="l01786"></a>01786                        <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg,
<a name="l01787"></a>01787                        on_check_function on_check_func)
<a name="l01788"></a>01788     :<a class="code" href="classSys__var__mybool.html">Sys_var_mybool</a>(name_arg, comment, flag_args, off, size, getopt,
<a name="l01789"></a>01789                     def_val, lock, binlog_status_arg, on_check_func)
<a name="l01790"></a>01790   {}
<a name="l01791"></a>01791   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var);
<a name="l01792"></a>01792 };
<a name="l01793"></a>01793 
<a name="l01794"></a>01794 
<a name="l01799"></a><a class="code" href="classSys__var__enum__binlog__checksum.html">01799</a> <span class="keyword">class </span><a class="code" href="classSys__var__enum__binlog__checksum.html">Sys_var_enum_binlog_checksum</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__enum.html">Sys_var_enum</a>
<a name="l01800"></a>01800 {
<a name="l01801"></a>01801 <span class="keyword">public</span>:
<a name="l01802"></a>01802   <a class="code" href="classSys__var__enum__binlog__checksum.html">Sys_var_enum_binlog_checksum</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01803"></a>01803           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01804"></a>01804           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01805"></a>01805           <span class="keyword">const</span> <span class="keywordtype">char</span> *values[], uint def_val, <a class="code" href="classPolyLock.html">PolyLock</a> *lock,
<a name="l01806"></a>01806           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg)
<a name="l01807"></a>01807     :<a class="code" href="classSys__var__enum.html">Sys_var_enum</a>(name_arg, comment, flag_args, off, size, getopt,
<a name="l01808"></a>01808                   values, def_val, lock, binlog_status_arg, NULL)
<a name="l01809"></a>01809   {}
<a name="l01810"></a>01810   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var);
<a name="l01811"></a>01811 };
<a name="l01812"></a>01812 
<a name="l01813"></a>01813 
<a name="l01817"></a><a class="code" href="classSys__var__gtid__specification.html">01817</a> <span class="keyword">class </span><a class="code" href="classSys__var__gtid__specification.html">Sys_var_gtid_specification</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l01818"></a>01818 {
<a name="l01819"></a>01819 <span class="keyword">public</span>:
<a name="l01820"></a>01820   <a class="code" href="classSys__var__gtid__specification.html">Sys_var_gtid_specification</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01821"></a>01821           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01822"></a>01822           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01823"></a>01823           <span class="keyword">const</span> <span class="keywordtype">char</span> *def_val,
<a name="l01824"></a>01824           <a class="code" href="classPolyLock.html">PolyLock</a> *lock= 0,
<a name="l01825"></a>01825           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01826"></a>01826           on_check_function on_check_func=0,
<a name="l01827"></a>01827           on_update_function on_update_func=0,
<a name="l01828"></a>01828           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l01829"></a>01829           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l01830"></a>01830     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l01831"></a>01831               getopt.arg_type, SHOW_CHAR, (intptr)def_val,
<a name="l01832"></a>01832               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l01833"></a>01833               substitute, parse_flag)
<a name="l01834"></a>01834   {
<a name="l01835"></a>01835     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(<a class="code" href="structGtid__specification.html">Gtid_specification</a>));
<a name="l01836"></a>01836   }
<a name="l01837"></a>01837   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01838"></a>01838   {
<a name="l01839"></a>01839     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid::session_update&quot;</span>);
<a name="l01840"></a>01840     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4ad513078fb56a8124851230698302de" title="Acquire the read lock.">rdlock</a>();
<a name="l01841"></a>01841     <span class="keywordtype">bool</span> ret= (((<a class="code" href="structGtid__specification.html">Gtid_specification</a> *)<a class="code" href="classsys__var.html#a82feda269f429be092a7f67b8150e94d">session_var_ptr</a>(thd))-&gt;
<a name="l01842"></a>01842                parse(global_sid_map,
<a name="l01843"></a>01843                      var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str) != 0);
<a name="l01844"></a>01844     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l01845"></a>01845     DBUG_RETURN(ret);
<a name="l01846"></a>01846   }
<a name="l01847"></a>01847   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01848"></a>01848   { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l01849"></a><a class="code" href="classSys__var__gtid__specification.html#a94ff3157253d4e01dff447fd43c596f2">01849</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__gtid__specification.html#a94ff3157253d4e01dff447fd43c596f2">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01850"></a>01850   {
<a name="l01851"></a>01851     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid::session_save_default&quot;</span>);
<a name="l01852"></a>01852     <span class="keywordtype">char</span> *ptr= (<span class="keywordtype">char</span>*)(intptr)<a class="code" href="classsys__var.html#a0b1ff282ca0e7b88a2827d8afd363119" title="min, max, default values are stored here">option</a>.def_value;
<a name="l01853"></a>01853     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= ptr;
<a name="l01854"></a>01854     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length= ptr ? strlen(ptr) : 0;
<a name="l01855"></a>01855     DBUG_VOID_RETURN;
<a name="l01856"></a>01856   }
<a name="l01857"></a><a class="code" href="classSys__var__gtid__specification.html#a48f3aa8538c41f60c5e61e5453db2966">01857</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__gtid__specification.html#a48f3aa8538c41f60c5e61e5453db2966">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01858"></a>01858   { DBUG_ASSERT(FALSE); }
<a name="l01859"></a>01859   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01860"></a>01860   {
<a name="l01861"></a>01861     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid::do_check&quot;</span>);
<a name="l01862"></a>01862     <span class="keywordtype">char</span> buf[Gtid_specification::MAX_TEXT_LENGTH + 1];
<a name="l01863"></a>01863     <a class="code" href="classString.html">String</a> str(buf, <span class="keyword">sizeof</span>(buf), &amp;my_charset_latin1);
<a name="l01864"></a>01864     <a class="code" href="classString.html">String</a> *res= var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str);
<a name="l01865"></a>01865     <span class="keywordflow">if</span> (!res)
<a name="l01866"></a>01866       DBUG_RETURN(<span class="keyword">true</span>);
<a name="l01867"></a>01867     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= thd-&gt;strmake(res-&gt;c_ptr_safe(), res-&gt;length());
<a name="l01868"></a>01868     <span class="keywordflow">if</span> (!var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str)
<a name="l01869"></a>01869     {
<a name="l01870"></a>01870       my_error(ER_OUT_OF_RESOURCES, MYF(0)); <span class="comment">// thd-&gt;strmake failed</span>
<a name="l01871"></a>01871       DBUG_RETURN(<span class="keyword">true</span>);
<a name="l01872"></a>01872     }
<a name="l01873"></a>01873     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length= res-&gt;length();
<a name="l01874"></a>01874     <span class="keywordtype">bool</span> ret= <a class="code" href="structGtid__specification.html#a002da0d9e72d056ed6bb4d99f58e51c9" title="Returns true if the given string is a valid Gtid_specification.">Gtid_specification::is_valid</a>(res-&gt;c_ptr_safe()) ? <span class="keyword">false</span> : <span class="keyword">true</span>;
<a name="l01875"></a>01875     DBUG_PRINT(<span class="stringliteral">&quot;info&quot;</span>, (<span class="stringliteral">&quot;ret=%d&quot;</span>, ret));
<a name="l01876"></a>01876     DBUG_RETURN(ret);
<a name="l01877"></a>01877   }
<a name="l01878"></a>01878   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l01879"></a>01879   { <span class="keywordflow">return</span> type != STRING_RESULT; }
<a name="l01880"></a><a class="code" href="classSys__var__gtid__specification.html#adbcb6e9d13318609043cf045533f52ca">01880</a>   uchar *<a class="code" href="classSys__var__gtid__specification.html#adbcb6e9d13318609043cf045533f52ca">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01881"></a>01881   {
<a name="l01882"></a>01882     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid::session_value_ptr&quot;</span>);
<a name="l01883"></a>01883     <span class="keywordtype">char</span> buf[Gtid_specification::MAX_TEXT_LENGTH + 1];
<a name="l01884"></a>01884     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4ad513078fb56a8124851230698302de" title="Acquire the read lock.">rdlock</a>();
<a name="l01885"></a>01885     ((<a class="code" href="structGtid__specification.html">Gtid_specification</a> *)<a class="code" href="classsys__var.html#a82feda269f429be092a7f67b8150e94d">session_var_ptr</a>(thd))-&gt;
<a name="l01886"></a>01886       to_string(global_sid_map, buf);
<a name="l01887"></a>01887     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l01888"></a>01888     <span class="keywordtype">char</span> *ret= thd-&gt;strdup(buf);
<a name="l01889"></a>01889     DBUG_RETURN((uchar *)ret);
<a name="l01890"></a>01890   }
<a name="l01891"></a>01891   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l01892"></a>01892   { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> NULL; }
<a name="l01893"></a>01893 };
<a name="l01894"></a>01894 
<a name="l01895"></a>01895 <span class="preprocessor">#ifdef HAVE_GTID_NEXT_LIST</span>
<a name="l01896"></a>01896 <span class="preprocessor"></span>
<a name="l01903"></a>01903 <span class="keyword">class </span>Sys_var_gtid_set: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l01904"></a>01904 {
<a name="l01905"></a>01905 <span class="keyword">public</span>:
<a name="l01906"></a>01906   Sys_var_gtid_set(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l01907"></a>01907           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l01908"></a>01908           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l01909"></a>01909           <span class="keyword">const</span> <span class="keywordtype">char</span> *def_val,
<a name="l01910"></a>01910           <a class="code" href="classPolyLock.html">PolyLock</a> *lock= 0,
<a name="l01911"></a>01911           <span class="keyword">enum</span> binlog_status_enum binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l01912"></a>01912           on_check_function on_check_func=0,
<a name="l01913"></a>01913           on_update_function on_update_func=0,
<a name="l01914"></a>01914           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l01915"></a>01915           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l01916"></a>01916     : <a class="code" href="classsys__var.html">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l01917"></a>01917               getopt.arg_type, SHOW_CHAR, (intptr)def_val,
<a name="l01918"></a>01918               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l01919"></a>01919               substitute, parse_flag)
<a name="l01920"></a>01920   {
<a name="l01921"></a>01921     DBUG_ASSERT(size == <span class="keyword">sizeof</span>(<a class="code" href="structGtid__set__or__null.html">Gtid_set_or_null</a>));
<a name="l01922"></a>01922   }
<a name="l01923"></a>01923   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01924"></a>01924   {
<a name="l01925"></a>01925     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_set::session_update&quot;</span>);
<a name="l01926"></a>01926     <a class="code" href="structGtid__set__or__null.html">Gtid_set_or_null</a> *gsn=
<a name="l01927"></a>01927       (<a class="code" href="structGtid__set__or__null.html">Gtid_set_or_null</a> *)<a class="code" href="classsys__var.html#a82feda269f429be092a7f67b8150e94d">session_var_ptr</a>(thd);
<a name="l01928"></a>01928     <span class="keywordtype">char</span> *value= var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str;
<a name="l01929"></a>01929     <span class="keywordflow">if</span> (value == NULL)
<a name="l01930"></a>01930       gsn-&gt;<a class="code" href="structGtid__set__or__null.html#ac47966d9a50008b0d6cf067f48d224ab" title="Set this Gtid_set to NULL.">set_null</a>();
<a name="l01931"></a>01931     <span class="keywordflow">else</span>
<a name="l01932"></a>01932     {
<a name="l01933"></a>01933       <a class="code" href="classGtid__set.html">Gtid_set</a> *gs= gsn-&gt;<a class="code" href="structGtid__set__or__null.html#a3a7015e462a30aad90c33e58c99a68c4">set_non_null</a>(global_sid_map);
<a name="l01934"></a>01934       <span class="keywordflow">if</span> (gs == NULL)
<a name="l01935"></a>01935       {
<a name="l01936"></a>01936         my_error(ER_OUT_OF_RESOURCES, MYF(0)); <span class="comment">// allocation failed</span>
<a name="l01937"></a>01937         DBUG_RETURN(<span class="keyword">true</span>);
<a name="l01938"></a>01938       }
<a name="l01939"></a>01939       <span class="comment">/*</span>
<a name="l01940"></a>01940 <span class="comment">        If string begins with &#39;+&#39;, add to the existing set, otherwise</span>
<a name="l01941"></a>01941 <span class="comment">        replace existing set.</span>
<a name="l01942"></a>01942 <span class="comment">      */</span>
<a name="l01943"></a>01943       <span class="keywordflow">while</span> (isspace(*value))
<a name="l01944"></a>01944         value++;
<a name="l01945"></a>01945       <span class="keywordflow">if</span> (*value == <span class="charliteral">&#39;+&#39;</span>)
<a name="l01946"></a>01946         value++;
<a name="l01947"></a>01947       <span class="keywordflow">else</span>
<a name="l01948"></a>01948         gs-&gt;<a class="code" href="classGtid__set.html#a8d8130a7559cfd7b940f42e66c9b171a">clear</a>();
<a name="l01949"></a>01949       <span class="comment">// Add specified set of groups to Gtid_set.</span>
<a name="l01950"></a>01950       global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4ad513078fb56a8124851230698302de" title="Acquire the read lock.">rdlock</a>();
<a name="l01951"></a>01951       enum_return_status ret= gs-&gt;<a class="code" href="classGtid__set.html#ae854e77cbadfd86cf28b61d5a8e228b9">add_gtid_text</a>(value);
<a name="l01952"></a>01952       global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l01953"></a>01953       <span class="keywordflow">if</span> (ret != RETURN_STATUS_OK)
<a name="l01954"></a>01954       {
<a name="l01955"></a>01955         gsn-&gt;<a class="code" href="structGtid__set__or__null.html#ac47966d9a50008b0d6cf067f48d224ab" title="Set this Gtid_set to NULL.">set_null</a>();
<a name="l01956"></a>01956         DBUG_RETURN(<span class="keyword">true</span>);
<a name="l01957"></a>01957       }
<a name="l01958"></a>01958     }
<a name="l01959"></a>01959     DBUG_RETURN(<span class="keyword">false</span>);
<a name="l01960"></a>01960   }
<a name="l01961"></a>01961   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01962"></a>01962   { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l01963"></a>01963   <span class="keywordtype">void</span> session_save_default(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01964"></a>01964   {
<a name="l01965"></a>01965     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_set::session_save_default&quot;</span>);
<a name="l01966"></a>01966     <span class="keywordtype">char</span> *ptr= (<span class="keywordtype">char</span>*)(intptr)option.def_value;
<a name="l01967"></a>01967     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= ptr;
<a name="l01968"></a>01968     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length= ptr ? strlen(ptr) : 0;
<a name="l01969"></a>01969     DBUG_VOID_RETURN;
<a name="l01970"></a>01970   }
<a name="l01971"></a>01971   <span class="keywordtype">void</span> global_save_default(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01972"></a>01972   { DBUG_ASSERT(FALSE); }
<a name="l01973"></a>01973   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l01974"></a>01974   {
<a name="l01975"></a>01975     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_set::do_check&quot;</span>);
<a name="l01976"></a>01976     <a class="code" href="classString.html">String</a> str;
<a name="l01977"></a>01977     <a class="code" href="classString.html">String</a> *res= var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str);
<a name="l01978"></a>01978     <span class="keywordflow">if</span> (res == NULL)
<a name="l01979"></a>01979     {
<a name="l01980"></a>01980       var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= NULL;
<a name="l01981"></a>01981       DBUG_RETURN(FALSE);
<a name="l01982"></a>01982     }
<a name="l01983"></a>01983     DBUG_ASSERT(res-&gt;ptr() != NULL);
<a name="l01984"></a>01984     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= thd-&gt;strmake(res-&gt;ptr(), res-&gt;length());
<a name="l01985"></a>01985     <span class="keywordflow">if</span> (var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str == NULL)
<a name="l01986"></a>01986     {
<a name="l01987"></a>01987       my_error(ER_OUT_OF_RESOURCES, MYF(0)); <span class="comment">// thd-&gt;strmake failed</span>
<a name="l01988"></a>01988       DBUG_RETURN(1);
<a name="l01989"></a>01989     }
<a name="l01990"></a>01990     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length= res-&gt;length();
<a name="l01991"></a>01991     <span class="keywordtype">bool</span> ret= !<a class="code" href="classGtid__set.html#a8a10c1dfb57ac995cbf14b51f83f8e68">Gtid_set::is_valid</a>(res-&gt;ptr());
<a name="l01992"></a>01992     DBUG_RETURN(ret);
<a name="l01993"></a>01993   }
<a name="l01994"></a>01994   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l01995"></a>01995   { <span class="keywordflow">return</span> type != STRING_RESULT; }
<a name="l01996"></a>01996   uchar *<a class="code" href="classsys__var.html#a99882f8f4d80165aa37eac6ef661d43c">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l01997"></a>01997   {
<a name="l01998"></a>01998     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_set::session_value_ptr&quot;</span>);
<a name="l01999"></a>01999     <a class="code" href="structGtid__set__or__null.html">Gtid_set_or_null</a> *gsn= (<a class="code" href="structGtid__set__or__null.html">Gtid_set_or_null</a> *)<a class="code" href="classsys__var.html#a82feda269f429be092a7f67b8150e94d">session_var_ptr</a>(thd);
<a name="l02000"></a>02000     <a class="code" href="classGtid__set.html">Gtid_set</a> *gs= gsn-&gt;<a class="code" href="structGtid__set__or__null.html#a826d70460e2db3c68df9193bf8e71563" title="Return NULL if this is NULL, otherwise return the Gtid_set.">get_gtid_set</a>();
<a name="l02001"></a>02001     <span class="keywordflow">if</span> (gs == NULL)
<a name="l02002"></a>02002       DBUG_RETURN(NULL);
<a name="l02003"></a>02003     <span class="keywordtype">char</span> *buf;
<a name="l02004"></a>02004     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4ad513078fb56a8124851230698302de" title="Acquire the read lock.">rdlock</a>();
<a name="l02005"></a>02005     buf= (<span class="keywordtype">char</span> *)thd-&gt;alloc(gs-&gt;<a class="code" href="classGtid__set.html#aaf41f6a15633a2076cc90b96dfbe7bb2">get_string_length</a>() + 1);
<a name="l02006"></a>02006     <span class="keywordflow">if</span> (buf)
<a name="l02007"></a>02007       gs-&gt;<a class="code" href="classGtid__set.html#a7f93abbbf6942fc5f854a1b1504d94e0">to_string</a>(buf);
<a name="l02008"></a>02008     <span class="keywordflow">else</span>
<a name="l02009"></a>02009       my_error(ER_OUT_OF_RESOURCES, MYF(0)); <span class="comment">// thd-&gt;alloc faile</span>
<a name="l02010"></a>02010     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02011"></a>02011     DBUG_RETURN((uchar *)buf);
<a name="l02012"></a>02012   }
<a name="l02013"></a>02013   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l02014"></a>02014   { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> NULL; }
<a name="l02015"></a>02015 };
<a name="l02016"></a>02016 <span class="preprocessor">#endif</span>
<a name="l02017"></a>02017 <span class="preprocessor"></span>
<a name="l02018"></a>02018 
<a name="l02025"></a><a class="code" href="classSys__var__charptr__func.html">02025</a> <span class="keyword">class </span><a class="code" href="classSys__var__charptr__func.html">Sys_var_charptr_func</a>: <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l02026"></a>02026 {
<a name="l02027"></a>02027 <span class="keyword">public</span>:
<a name="l02028"></a>02028   <a class="code" href="classSys__var__charptr__func.html">Sys_var_charptr_func</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *comment,
<a name="l02029"></a>02029                        flag_enum flag_arg)
<a name="l02030"></a>02030     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, READ_ONLY flag_arg,
<a name="l02031"></a>02031               0<span class="comment">/*off*/</span>, NO_CMD_LINE.id, NO_CMD_LINE.arg_type,
<a name="l02032"></a>02032               SHOW_CHAR, (intptr)0<span class="comment">/*def_val*/</span>,
<a name="l02033"></a>02033               NULL<span class="comment">/*polylock*/</span>, VARIABLE_NOT_IN_BINLOG,
<a name="l02034"></a>02034               NULL<span class="comment">/*on_check_func*/</span>, NULL<span class="comment">/*on_update_func*/</span>,
<a name="l02035"></a>02035               NULL<span class="comment">/*substitute*/</span>, PARSE_NORMAL<span class="comment">/*parse_flag*/</span>)
<a name="l02036"></a>02036   {
<a name="l02037"></a>02037     DBUG_ASSERT(flag_arg == sys_var::GLOBAL || flag_arg == sys_var::SESSION ||
<a name="l02038"></a>02038                 flag_arg == sys_var::ONLY_SESSION);
<a name="l02039"></a>02039   }
<a name="l02040"></a>02040   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l02041"></a>02041   { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l02042"></a>02042   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l02043"></a>02043   { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l02044"></a><a class="code" href="classSys__var__charptr__func.html#a38ee2df3e1f0168c9ff033738f3b32dc">02044</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__charptr__func.html#a38ee2df3e1f0168c9ff033738f3b32dc">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var) { DBUG_ASSERT(FALSE); }
<a name="l02045"></a><a class="code" href="classSys__var__charptr__func.html#abdfe65908bebe29b4345427a6da67213">02045</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__charptr__func.html#abdfe65908bebe29b4345427a6da67213">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var) { DBUG_ASSERT(FALSE); }
<a name="l02046"></a>02046   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var) { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l02047"></a>02047   <span class="keywordtype">bool</span> check_update_type(Item_result type) { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l02048"></a><a class="code" href="classSys__var__charptr__func.html#a7b16820d42970289c776bada72c21b5b">02048</a>   <span class="keyword">virtual</span> uchar *<a class="code" href="classSys__var__charptr__func.html#a7b16820d42970289c776bada72c21b5b">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l02049"></a>02049   { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> NULL; }
<a name="l02050"></a>02050   <span class="keyword">virtual</span> uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l02051"></a>02051   { DBUG_ASSERT(FALSE); <span class="keywordflow">return</span> NULL; }
<a name="l02052"></a>02052 };
<a name="l02053"></a>02053 
<a name="l02054"></a>02054 
<a name="l02061"></a><a class="code" href="classSys__var__gtid__set__func.html">02061</a> <span class="keyword">class </span><a class="code" href="classSys__var__gtid__set__func.html">Sys_var_gtid_set_func</a>: <span class="keyword">public</span> <a class="code" href="classSys__var__charptr__func.html">Sys_var_charptr_func</a>
<a name="l02062"></a>02062 {
<a name="l02063"></a>02063 <span class="keyword">public</span>:
<a name="l02064"></a>02064   <a class="code" href="classSys__var__gtid__set__func.html">Sys_var_gtid_set_func</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *comment,
<a name="l02065"></a>02065                         flag_enum flag_arg)
<a name="l02066"></a>02066     : <a class="code" href="classSys__var__charptr__func.html">Sys_var_charptr_func</a>(name_arg, comment, flag_arg) {}
<a name="l02067"></a>02067 
<a name="l02068"></a>02068   <span class="keyword">typedef</span> enum_return_status (*Gtid_set_getter)(THD *, <a class="code" href="classGtid__set.html">Gtid_set</a> *);
<a name="l02069"></a>02069 
<a name="l02070"></a>02070   <span class="keyword">static</span> uchar *get_string_from_gtid_set(THD *thd,
<a name="l02071"></a>02071                                          Gtid_set_getter get_gtid_set)
<a name="l02072"></a>02072   {
<a name="l02073"></a>02073     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_ended_groups::session_value_ptr&quot;</span>);
<a name="l02074"></a>02074     <a class="code" href="classGtid__set.html">Gtid_set</a> gs(global_sid_map);
<a name="l02075"></a>02075     <span class="keywordtype">char</span> *buf;
<a name="l02076"></a>02076     <span class="comment">// As an optimization, add 10 Intervals that do not need to be</span>
<a name="l02077"></a>02077     <span class="comment">// allocated.</span>
<a name="l02078"></a>02078     <a class="code" href="structGtid__set_1_1Interval.html">Gtid_set::Interval</a> ivs[10];
<a name="l02079"></a>02079     gs.<a class="code" href="classGtid__set.html#a11541c02363dc7a2877a5a0282d679ab">add_interval_memory</a>(10, ivs);
<a name="l02080"></a>02080     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4bd09795d0037c26253c97fdc9d7747b" title="Acquire the write lock.">wrlock</a>();
<a name="l02081"></a>02081     <span class="keywordflow">if</span> (get_gtid_set(thd, &amp;gs) != RETURN_STATUS_OK)
<a name="l02082"></a>02082       <span class="keywordflow">goto</span> error;
<a name="l02083"></a>02083     <span class="comment">// allocate string and print to it</span>
<a name="l02084"></a>02084     buf= (<span class="keywordtype">char</span> *)thd-&gt;alloc(gs.<a class="code" href="classGtid__set.html#aaf41f6a15633a2076cc90b96dfbe7bb2">get_string_length</a>() + 1);
<a name="l02085"></a>02085     <span class="keywordflow">if</span> (buf == NULL)
<a name="l02086"></a>02086     {
<a name="l02087"></a>02087       my_error(ER_OUT_OF_RESOURCES, MYF(0));
<a name="l02088"></a>02088       <span class="keywordflow">goto</span> error;
<a name="l02089"></a>02089     }
<a name="l02090"></a>02090     gs.<a class="code" href="classGtid__set.html#a7f93abbbf6942fc5f854a1b1504d94e0">to_string</a>(buf);
<a name="l02091"></a>02091     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02092"></a>02092     DBUG_RETURN((uchar *)buf);
<a name="l02093"></a>02093   error:
<a name="l02094"></a>02094     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02095"></a>02095     DBUG_RETURN(NULL);
<a name="l02096"></a>02096   }
<a name="l02097"></a>02097 };
<a name="l02098"></a>02098 
<a name="l02099"></a>02099 
<a name="l02103"></a><a class="code" href="classSys__var__gtid__executed.html">02103</a> <span class="keyword">class </span><a class="code" href="classSys__var__gtid__executed.html">Sys_var_gtid_executed</a> : <a class="code" href="classSys__var__gtid__set__func.html">Sys_var_gtid_set_func</a>
<a name="l02104"></a>02104 {
<a name="l02105"></a>02105 <span class="keyword">public</span>:
<a name="l02106"></a>02106   <a class="code" href="classSys__var__gtid__executed.html">Sys_var_gtid_executed</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *comment_arg)
<a name="l02107"></a>02107     : <a class="code" href="classSys__var__gtid__set__func.html">Sys_var_gtid_set_func</a>(name_arg, comment_arg, SESSION) {}
<a name="l02108"></a>02108 
<a name="l02109"></a>02109   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l02110"></a>02110   {
<a name="l02111"></a>02111     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_executed::global_value_ptr&quot;</span>);
<a name="l02112"></a>02112     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4bd09795d0037c26253c97fdc9d7747b" title="Acquire the write lock.">wrlock</a>();
<a name="l02113"></a>02113     <span class="keyword">const</span> <a class="code" href="classGtid__set.html">Gtid_set</a> *gs= gtid_state-&gt;<a class="code" href="classGtid__state.html#a553fb4be9ed205dd90288fe721a6755c" title="Return a pointer to the Gtid_set that contains the logged groups.">get_logged_gtids</a>();
<a name="l02114"></a>02114     <span class="keywordtype">char</span> *buf= (<span class="keywordtype">char</span> *)thd-&gt;alloc(gs-&gt;<a class="code" href="classGtid__set.html#aaf41f6a15633a2076cc90b96dfbe7bb2">get_string_length</a>() + 1);
<a name="l02115"></a>02115     <span class="keywordflow">if</span> (buf == NULL)
<a name="l02116"></a>02116       my_error(ER_OUT_OF_RESOURCES, MYF(0));
<a name="l02117"></a>02117     <span class="keywordflow">else</span>
<a name="l02118"></a>02118       gs-&gt;<a class="code" href="classGtid__set.html#a7f93abbbf6942fc5f854a1b1504d94e0">to_string</a>(buf);
<a name="l02119"></a>02119     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02120"></a>02120     DBUG_RETURN((uchar *)buf);
<a name="l02121"></a>02121   }
<a name="l02122"></a>02122 
<a name="l02123"></a>02123 <span class="keyword">private</span>:
<a name="l02124"></a>02124   <span class="keyword">static</span> enum_return_status get_groups_from_trx_cache(THD *thd, <a class="code" href="classGtid__set.html">Gtid_set</a> *gs)
<a name="l02125"></a>02125   {
<a name="l02126"></a>02126     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_executed::get_groups_from_trx_cache&quot;</span>);
<a name="l02127"></a>02127     <span class="keywordflow">if</span> (opt_bin_log)
<a name="l02128"></a>02128     {
<a name="l02129"></a>02129       thd-&gt;binlog_setup_trx_data();
<a name="l02130"></a>02130       PROPAGATE_REPORTED_ERROR(thd-&gt;get_group_cache(<span class="keyword">true</span>)-&gt;get_gtids(gs));
<a name="l02131"></a>02131     }
<a name="l02132"></a>02132     RETURN_OK;
<a name="l02133"></a>02133   }
<a name="l02134"></a>02134 
<a name="l02135"></a>02135 <span class="keyword">public</span>:
<a name="l02136"></a><a class="code" href="classSys__var__gtid__executed.html#a1621c7598fa4c4dd05b6615a0d6e7805">02136</a>   uchar *<a class="code" href="classSys__var__gtid__executed.html#a1621c7598fa4c4dd05b6615a0d6e7805">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l02137"></a>02137   {
<a name="l02138"></a>02138     <span class="keywordflow">return</span> get_string_from_gtid_set(thd, get_groups_from_trx_cache);
<a name="l02139"></a>02139   }
<a name="l02140"></a>02140 };
<a name="l02141"></a>02141 
<a name="l02142"></a>02142 
<a name="l02146"></a><a class="code" href="classSys__var__gtid__purged.html">02146</a> <span class="keyword">class </span><a class="code" href="classSys__var__gtid__purged.html">Sys_var_gtid_purged</a> : <span class="keyword">public</span> <a class="code" href="classsys__var.html">sys_var</a>
<a name="l02147"></a>02147 {
<a name="l02148"></a>02148 <span class="keyword">public</span>:
<a name="l02149"></a>02149   <a class="code" href="classSys__var__gtid__purged.html">Sys_var_gtid_purged</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,
<a name="l02150"></a>02150           <span class="keyword">const</span> <span class="keywordtype">char</span> *comment, <span class="keywordtype">int</span> flag_args, ptrdiff_t off, <span class="keywordtype">size_t</span> size,
<a name="l02151"></a>02151           <a class="code" href="structCMD__LINE.html">CMD_LINE</a> getopt,
<a name="l02152"></a>02152           <span class="keyword">const</span> <span class="keywordtype">char</span> *def_val,
<a name="l02153"></a>02153           <a class="code" href="classPolyLock.html">PolyLock</a> *lock= 0,
<a name="l02154"></a>02154           <span class="keyword">enum</span> <a class="code" href="classsys__var.html#a664520ec82191888717c86085bfa83ce">binlog_status_enum</a> binlog_status_arg=VARIABLE_NOT_IN_BINLOG,
<a name="l02155"></a>02155           on_check_function on_check_func=0,
<a name="l02156"></a>02156           on_update_function on_update_func=0,
<a name="l02157"></a>02157           <span class="keyword">const</span> <span class="keywordtype">char</span> *substitute=0,
<a name="l02158"></a>02158           <span class="keywordtype">int</span> parse_flag= PARSE_NORMAL)
<a name="l02159"></a>02159     : <a class="code" href="classsys__var.html#a7a1f7993cd3dc1e34821408fce2c3062">sys_var</a>(&amp;all_sys_vars, name_arg, comment, flag_args, off, getopt.id,
<a name="l02160"></a>02160               getopt.arg_type, SHOW_CHAR, (intptr)def_val,
<a name="l02161"></a>02161               lock, binlog_status_arg, on_check_func, on_update_func,
<a name="l02162"></a>02162               substitute, parse_flag)
<a name="l02163"></a>02163   {}
<a name="l02164"></a>02164 
<a name="l02165"></a>02165   <span class="keywordtype">bool</span> session_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l02166"></a>02166   {
<a name="l02167"></a>02167     DBUG_ASSERT(FALSE);
<a name="l02168"></a>02168     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02169"></a>02169   }
<a name="l02170"></a>02170 
<a name="l02171"></a><a class="code" href="classSys__var__gtid__purged.html#a899e9b452040b2f08438a6bbaef35644">02171</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__gtid__purged.html#a899e9b452040b2f08438a6bbaef35644">session_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l02172"></a>02172   { DBUG_ASSERT(FALSE); }
<a name="l02173"></a>02173 
<a name="l02174"></a>02174   <span class="keywordtype">bool</span> global_update(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l02175"></a>02175   {
<a name="l02176"></a>02176     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_purged::global_update&quot;</span>);
<a name="l02177"></a>02177 <span class="preprocessor">#ifdef HAVE_REPLICATION</span>
<a name="l02178"></a>02178 <span class="preprocessor"></span>    <span class="keywordtype">bool</span> error= <span class="keyword">false</span>;
<a name="l02179"></a>02179     <span class="keywordtype">int</span> rotate_res= 0;
<a name="l02180"></a>02180 
<a name="l02181"></a>02181     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4bd09795d0037c26253c97fdc9d7747b" title="Acquire the write lock.">wrlock</a>();
<a name="l02182"></a>02182     <span class="keywordtype">char</span> *previous_gtid_logged= gtid_state-&gt;<a class="code" href="classGtid__state.html#a553fb4be9ed205dd90288fe721a6755c" title="Return a pointer to the Gtid_set that contains the logged groups.">get_logged_gtids</a>()-&gt;<a class="code" href="classGtid__set.html#a7f93abbbf6942fc5f854a1b1504d94e0">to_string</a>();
<a name="l02183"></a>02183     <span class="keywordtype">char</span> *previous_gtid_lost= gtid_state-&gt;<a class="code" href="classGtid__state.html#a18c6a08e5c49e6803cd0f2df2a79c7f5" title="Return a pointer to the Gtid_set that contains the logged groups.">get_lost_gtids</a>()-&gt;<a class="code" href="classGtid__set.html#a7f93abbbf6942fc5f854a1b1504d94e0">to_string</a>();
<a name="l02184"></a>02184     enum_return_status ret= gtid_state-&gt;<a class="code" href="classGtid__state.html#a95a09a004b7145752d3e732b166fc989">add_lost_gtids</a>(var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str);
<a name="l02185"></a>02185     <span class="keywordtype">char</span> *current_gtid_logged= gtid_state-&gt;<a class="code" href="classGtid__state.html#a553fb4be9ed205dd90288fe721a6755c" title="Return a pointer to the Gtid_set that contains the logged groups.">get_logged_gtids</a>()-&gt;<a class="code" href="classGtid__set.html#a7f93abbbf6942fc5f854a1b1504d94e0">to_string</a>();
<a name="l02186"></a>02186     <span class="keywordtype">char</span> *current_gtid_lost= gtid_state-&gt;<a class="code" href="classGtid__state.html#a18c6a08e5c49e6803cd0f2df2a79c7f5" title="Return a pointer to the Gtid_set that contains the logged groups.">get_lost_gtids</a>()-&gt;<a class="code" href="classGtid__set.html#a7f93abbbf6942fc5f854a1b1504d94e0">to_string</a>();
<a name="l02187"></a>02187     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02188"></a>02188     <span class="keywordflow">if</span> (RETURN_STATUS_OK != ret)
<a name="l02189"></a>02189     {
<a name="l02190"></a>02190       error= <span class="keyword">true</span>;
<a name="l02191"></a>02191       <span class="keywordflow">goto</span> end;
<a name="l02192"></a>02192     }
<a name="l02193"></a>02193 
<a name="l02194"></a>02194     <span class="comment">// Log messages saying that GTID_PURGED and GTID_EXECUTED were changed.</span>
<a name="l02195"></a>02195     sql_print_information(ER(ER_GTID_PURGED_WAS_CHANGED),
<a name="l02196"></a>02196                           previous_gtid_lost, current_gtid_lost);
<a name="l02197"></a>02197     sql_print_information(ER(ER_GTID_EXECUTED_WAS_CHANGED),
<a name="l02198"></a>02198                           previous_gtid_logged, current_gtid_logged);
<a name="l02199"></a>02199 
<a name="l02200"></a>02200     <span class="comment">// Rotate logs to have Previous_gtid_event on last binlog.</span>
<a name="l02201"></a>02201     rotate_res= mysql_bin_log.<a class="code" href="group__Binary__Log.html#ga9f41b228c438fe7b4c710b8fdd780cfb">rotate_and_purge</a>(thd, <span class="keyword">true</span>);
<a name="l02202"></a>02202     <span class="keywordflow">if</span> (rotate_res)
<a name="l02203"></a>02203     {
<a name="l02204"></a>02204       error= <span class="keyword">true</span>;
<a name="l02205"></a>02205       <span class="keywordflow">goto</span> end;
<a name="l02206"></a>02206     }
<a name="l02207"></a>02207 
<a name="l02208"></a>02208 end:
<a name="l02209"></a>02209     my_free(previous_gtid_logged);
<a name="l02210"></a>02210     my_free(previous_gtid_lost);
<a name="l02211"></a>02211     my_free(current_gtid_logged);
<a name="l02212"></a>02212     my_free(current_gtid_lost);
<a name="l02213"></a>02213     DBUG_RETURN(error);
<a name="l02214"></a>02214 <span class="preprocessor">#else</span>
<a name="l02215"></a>02215 <span class="preprocessor"></span>    DBUG_RETURN(<span class="keyword">true</span>);
<a name="l02216"></a>02216 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_REPLICATION */</span>
<a name="l02217"></a>02217   }
<a name="l02218"></a>02218 
<a name="l02219"></a><a class="code" href="classSys__var__gtid__purged.html#a7520649b0e520db8ab51b1e1e0c94b9e">02219</a>   <span class="keywordtype">void</span> <a class="code" href="classSys__var__gtid__purged.html#a7520649b0e520db8ab51b1e1e0c94b9e">global_save_default</a>(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l02220"></a>02220   {
<a name="l02221"></a>02221     <span class="comment">/* gtid_purged does not have default value */</span>
<a name="l02222"></a>02222     my_error(ER_NO_DEFAULT, MYF(0), var-&gt;<a class="code" href="classset__var.html#aba70504fbb23bc6f80b28a57a7fbc99d" title="system variable to be updated">var</a>-&gt;name.str);
<a name="l02223"></a>02223   }
<a name="l02224"></a>02224 
<a name="l02225"></a>02225   <span class="keywordtype">bool</span> do_check(THD *thd, <a class="code" href="classset__var.html">set_var</a> *var)
<a name="l02226"></a>02226   {
<a name="l02227"></a>02227     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_purged::do_check&quot;</span>);
<a name="l02228"></a>02228     <span class="keywordtype">char</span> buf[1024];
<a name="l02229"></a>02229     <a class="code" href="classString.html">String</a> str(buf, <span class="keyword">sizeof</span>(buf), system_charset_info);
<a name="l02230"></a>02230     <a class="code" href="classString.html">String</a> *res= var-&gt;<a class="code" href="classset__var.html#ab1f27659e7ce12be2f8abfa4c5b69458" title="the expression that provides the new value of the variable">value</a>-&gt;val_str(&amp;str);
<a name="l02231"></a>02231     <span class="keywordflow">if</span> (!res)
<a name="l02232"></a>02232       DBUG_RETURN(<span class="keyword">true</span>);
<a name="l02233"></a>02233     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str= thd-&gt;strmake(res-&gt;c_ptr_safe(),
<a name="l02234"></a>02234                                                     res-&gt;length());
<a name="l02235"></a>02235     <span class="keywordflow">if</span> (!var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.str)
<a name="l02236"></a>02236     {
<a name="l02237"></a>02237       my_error(ER_OUT_OF_RESOURCES, MYF(0)); <span class="comment">// thd-&gt;strmake failed</span>
<a name="l02238"></a>02238       DBUG_RETURN(<span class="keyword">true</span>);
<a name="l02239"></a>02239     }
<a name="l02240"></a>02240     var-&gt;save_result.<a class="code" href="classset__var.html#acd8a16b9bf4d235ab59629f5f0f726f2" title="for Sys_var_charptr and others">string_value</a>.length= res-&gt;length();
<a name="l02241"></a>02241     <span class="keywordtype">bool</span> ret= <a class="code" href="classGtid__set.html#a8a10c1dfb57ac995cbf14b51f83f8e68">Gtid_set::is_valid</a>(res-&gt;c_ptr_safe()) ? <span class="keyword">false</span> : <span class="keyword">true</span>;
<a name="l02242"></a>02242     DBUG_PRINT(<span class="stringliteral">&quot;info&quot;</span>, (<span class="stringliteral">&quot;ret=%d&quot;</span>, ret));
<a name="l02243"></a>02243     DBUG_RETURN(ret);
<a name="l02244"></a>02244   }
<a name="l02245"></a>02245 
<a name="l02246"></a>02246   <span class="keywordtype">bool</span> check_update_type(Item_result type)
<a name="l02247"></a>02247   { <span class="keywordflow">return</span> type != STRING_RESULT; }
<a name="l02248"></a>02248 
<a name="l02249"></a>02249   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l02250"></a>02250   {
<a name="l02251"></a>02251     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_purged::global_value_ptr&quot;</span>);
<a name="l02252"></a>02252     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4bd09795d0037c26253c97fdc9d7747b" title="Acquire the write lock.">wrlock</a>();
<a name="l02253"></a>02253     <span class="keyword">const</span> <a class="code" href="classGtid__set.html">Gtid_set</a> *gs= gtid_state-&gt;<a class="code" href="classGtid__state.html#a18c6a08e5c49e6803cd0f2df2a79c7f5" title="Return a pointer to the Gtid_set that contains the logged groups.">get_lost_gtids</a>();
<a name="l02254"></a>02254     <span class="keywordtype">char</span> *buf= (<span class="keywordtype">char</span> *)thd-&gt;alloc(gs-&gt;<a class="code" href="classGtid__set.html#aaf41f6a15633a2076cc90b96dfbe7bb2">get_string_length</a>() + 1);
<a name="l02255"></a>02255     <span class="keywordflow">if</span> (buf == NULL)
<a name="l02256"></a>02256       my_error(ER_OUT_OF_RESOURCES, MYF(0));
<a name="l02257"></a>02257     <span class="keywordflow">else</span>
<a name="l02258"></a>02258       gs-&gt;<a class="code" href="classGtid__set.html#a7f93abbbf6942fc5f854a1b1504d94e0">to_string</a>(buf);
<a name="l02259"></a>02259     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02260"></a>02260     DBUG_RETURN((uchar *)buf);
<a name="l02261"></a>02261   }
<a name="l02262"></a>02262 
<a name="l02263"></a><a class="code" href="classSys__var__gtid__purged.html#a4a6b8d70b94baff7dab1eccccd3cde88">02263</a>   uchar *<a class="code" href="classSys__var__gtid__purged.html#a4a6b8d70b94baff7dab1eccccd3cde88">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l02264"></a>02264   { DBUG_ASSERT(0); <span class="keywordflow">return</span> NULL; }
<a name="l02265"></a>02265 };
<a name="l02266"></a>02266 
<a name="l02267"></a>02267 
<a name="l02268"></a><a class="code" href="classSys__var__gtid__owned.html">02268</a> <span class="keyword">class </span><a class="code" href="classSys__var__gtid__owned.html">Sys_var_gtid_owned</a> : <a class="code" href="classSys__var__gtid__set__func.html">Sys_var_gtid_set_func</a>
<a name="l02269"></a>02269 {
<a name="l02270"></a>02270 <span class="keyword">public</span>:
<a name="l02271"></a>02271   <a class="code" href="classSys__var__gtid__owned.html">Sys_var_gtid_owned</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *comment_arg)
<a name="l02272"></a>02272     : <a class="code" href="classSys__var__gtid__set__func.html">Sys_var_gtid_set_func</a>(name_arg, comment_arg, SESSION) {}
<a name="l02273"></a>02273 
<a name="l02274"></a>02274 <span class="keyword">public</span>:
<a name="l02275"></a><a class="code" href="classSys__var__gtid__owned.html#ab6f54e284cf1284b57d6d14f71a53e89">02275</a>   uchar *<a class="code" href="classSys__var__gtid__owned.html#ab6f54e284cf1284b57d6d14f71a53e89">session_value_ptr</a>(THD *thd, LEX_STRING *base)
<a name="l02276"></a>02276   {
<a name="l02277"></a>02277     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_owned::session_value_ptr&quot;</span>);
<a name="l02278"></a>02278     <span class="keywordtype">char</span> *buf= NULL;
<a name="l02279"></a>02279     <span class="keywordflow">if</span> (thd-&gt;owned_gtid.sidno == 0)
<a name="l02280"></a>02280       DBUG_RETURN((uchar *)thd-&gt;strdup(<span class="stringliteral">&quot;&quot;</span>));
<a name="l02281"></a>02281     <span class="keywordflow">if</span> (thd-&gt;owned_gtid.sidno == -1)
<a name="l02282"></a>02282     {
<a name="l02283"></a>02283 <span class="preprocessor">#ifdef HAVE_GTID_NEXT_LIST</span>
<a name="l02284"></a>02284 <span class="preprocessor"></span>      buf= (<span class="keywordtype">char</span> *)thd-&gt;alloc(thd-&gt;owned_gtid_set.get_string_length() + 1);
<a name="l02285"></a>02285       <span class="keywordflow">if</span> (buf)
<a name="l02286"></a>02286       {
<a name="l02287"></a>02287         global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4ad513078fb56a8124851230698302de" title="Acquire the read lock.">rdlock</a>();
<a name="l02288"></a>02288         thd-&gt;owned_gtid_set.to_string(buf);
<a name="l02289"></a>02289         global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02290"></a>02290       }
<a name="l02291"></a>02291       <span class="keywordflow">else</span>
<a name="l02292"></a>02292         my_error(ER_OUT_OF_RESOURCES, MYF(0));
<a name="l02293"></a>02293 <span class="preprocessor">#else</span>
<a name="l02294"></a>02294 <span class="preprocessor"></span>     DBUG_ASSERT(0); 
<a name="l02295"></a>02295 <span class="preprocessor">#endif</span>
<a name="l02296"></a>02296 <span class="preprocessor"></span>    }
<a name="l02297"></a>02297     <span class="keywordflow">else</span>
<a name="l02298"></a>02298     {
<a name="l02299"></a>02299       buf= (<span class="keywordtype">char</span> *)thd-&gt;alloc(<a class="code" href="structGtid.html#a16358c79f9923fb0a0aaab4d71e86fc0">Gtid::MAX_TEXT_LENGTH</a> + 1);
<a name="l02300"></a>02300       <span class="keywordflow">if</span> (buf)
<a name="l02301"></a>02301       {
<a name="l02302"></a>02302         global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4ad513078fb56a8124851230698302de" title="Acquire the read lock.">rdlock</a>();
<a name="l02303"></a>02303         thd-&gt;owned_gtid.to_string(global_sid_map, buf);
<a name="l02304"></a>02304         global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02305"></a>02305       }
<a name="l02306"></a>02306       <span class="keywordflow">else</span>
<a name="l02307"></a>02307         my_error(ER_OUT_OF_RESOURCES, MYF(0));
<a name="l02308"></a>02308     }
<a name="l02309"></a>02309     DBUG_RETURN((uchar *)buf);
<a name="l02310"></a>02310   }
<a name="l02311"></a>02311 
<a name="l02312"></a>02312   uchar *global_value_ptr(THD *thd, LEX_STRING *base)
<a name="l02313"></a>02313   {
<a name="l02314"></a>02314     DBUG_ENTER(<span class="stringliteral">&quot;Sys_var_gtid_owned::global_value_ptr&quot;</span>);
<a name="l02315"></a>02315     <span class="keyword">const</span> <a class="code" href="classOwned__gtids.html">Owned_gtids</a> *owned_gtids= gtid_state-&gt;<a class="code" href="classGtid__state.html#a4c54aa4cf31696ba5bebe8f3decccfed" title="Return a pointer to the Owned_gtids that contains the owned groups.">get_owned_gtids</a>();
<a name="l02316"></a>02316     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#a4bd09795d0037c26253c97fdc9d7747b" title="Acquire the write lock.">wrlock</a>();
<a name="l02317"></a>02317     <span class="keywordtype">char</span> *buf= (<span class="keywordtype">char</span> *)thd-&gt;alloc(owned_gtids-&gt;<a class="code" href="classOwned__gtids.html#a75c6530093fb5112201a895a8c9f381a">get_max_string_length</a>());
<a name="l02318"></a>02318     <span class="keywordflow">if</span> (buf)
<a name="l02319"></a>02319       owned_gtids-&gt;<a class="code" href="classOwned__gtids.html#a92ecfa316fd01af97babe268cdcadd9d">to_string</a>(buf);
<a name="l02320"></a>02320     <span class="keywordflow">else</span>
<a name="l02321"></a>02321       my_error(ER_OUT_OF_RESOURCES, MYF(0)); <span class="comment">// thd-&gt;alloc faile</span>
<a name="l02322"></a>02322     global_sid_lock-&gt;<a class="code" href="classCheckable__rwlock.html#ad2eb6c44afcc5d29561c39312764235b" title="Release the lock (whether it is a write or read lock).">unlock</a>();
<a name="l02323"></a>02323     DBUG_RETURN((uchar *)buf);
<a name="l02324"></a>02324   }
<a name="l02325"></a>02325 };
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 16 2015 12:34:46 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
